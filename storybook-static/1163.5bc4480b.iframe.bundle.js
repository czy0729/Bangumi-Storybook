(self.webpackChunkweb=self.webpackChunkweb||[]).push([[1163],{"./src/screens/tinygrail/_/item-advance/index.tsx":(e,t,n)=>{n("./node_modules/core-js/modules/es.object.define-property.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.object.assign.js"),n("./node_modules/core-js/modules/es.array.flat.js"),n("./node_modules/core-js/modules/es.parse-int.js"),n("./node_modules/core-js/modules/es.number.to-fixed.js"),n("./node_modules/core-js/modules/es.number.constructor.js");var s=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;s(n("./node_modules/react/index.js"));var r=s(n("./node_modules/react-native-web/dist/exports/View/index.js")),o=n("./node_modules/mobx-react/dist/mobxreact.esm.js"),i=s(n("./node_modules/prop-types/index.js")),a=n("./src/components/index.ts"),c=n("./src/stores/index.ts"),l=n("./src/utils/index.ts"),d=n("./src/utils/app/index.ts"),u=n("./src/utils/fetch/index.ts"),p=n("./src/constants/index.ts"),m=s(n("./src/screens/tinygrail/_/rank/index.tsx")),f=n("./src/screens/tinygrail/_/utils.ts"),y=n("./src/screens/tinygrail/_/item-advance/styles.ts"),j=n("./node_modules/react/jsx-runtime.js");function v(e,t){var n=t.navigation,s=(0,y.memoStyles)(),o=e.event,i=void 0===o?p.EVENT:o,v=e.assets,_=e.index,x=e.id,g=e.name,h=e.icon,b=e.bonus,S=e.level,O=e.amount,T=e.current,A=e.firstAsks,C=e.firstBids,w=e.firstAmount,P=e.rate,R=e.rank,k=e.stars,L=e.mark,I=e.isAuctioning,M=i.id,D=i.data,E=!C&&!A,B=!!C,F=0===_;return(0,j.jsxs)(a.Flex,{style:s.container,align:"start",children:[(0,j.jsx)(r.default,{style:c._.mt.md,children:(0,j.jsx)(a.Avatar,{src:(0,d.tinygrailOSS)(h),name:g,borderColor:"transparent",skeletonType:"tinygrail",onPress:function(){(0,u.t)(M,Object.assign({to:"Mono",monoId:x},D)),n.push("Mono",{monoId:"character/"+x,_name:g})}})}),(0,j.jsx)(a.Flex.Item,{style:!F&&!c._.flat&&s.border,children:(0,j.jsx)(a.Touchable,{style:s.item,onPress:function(){if(E)return(0,u.t)(M,Object.assign({to:"TinygrailSacrifice",monoId:x},D)),void n.push("TinygrailSacrifice",{monoId:"character/"+x});(0,u.t)(M,Object.assign({to:"TinygrailDeal",monoId:x},D)),n.push("TinygrailDeal",{monoId:"character/"+x,type:B?"ask":"bid"})},children:(0,j.jsxs)(a.Flex,{children:[(0,j.jsxs)(a.Flex.Item,{children:[(0,j.jsxs)(a.Flex,{children:[(0,j.jsx)(m.default,{value:R}),(0,j.jsx)(a.Flex.Item,{children:(0,j.jsxs)(a.Text,{type:"tinygrailPlain",size:g.length>16?13:g.length>13?14:15,lineHeight:15,bold:!0,children:[_+1,". ",g,!!b&&(0,j.jsxs)(a.Text,{size:12,lineHeight:15,type:"warning",children:[" ","x",b]}),parseInt(S)>1&&(0,j.jsxs)(a.Text,{type:"ask",size:12,lineHeight:15,children:[" ","lv",S]})]})})]}),(0,j.jsxs)(a.Text,{style:c._.mt.xs,type:"tinygrailText",size:12,children:[!!O&&(0,j.jsxs)(a.Text,{type:"warning",size:12,bold:!0,children:[O,"股"]}),!!O&&" / ",!!w&&(0,j.jsxs)(a.Text,{type:B?"bid":"ask",size:12,bold:!0,children:[B&&"收",w,"股"]}),v&&(0,j.jsxs)(a.Text,{type:"bid",size:12,children:[v.state||"-"," (",v.sacrifices||"-",")"]}),v&&" / ",!!w&&" / ","₵",(0,l.toFixed)(A||C||T,2)," / +",(0,l.toFixed)(P,1)," (",Number((0,l.toFixed)((0,f.calculateRate)(P,R,k),1)),")"]})]}),I&&(0,j.jsxs)(a.Text,{style:c._.ml.sm,type:"bid",children:[" ","[竞拍中]"]}),(0,j.jsx)(a.Text,{style:c._.ml.md,type:"tinygrailPlain",size:16,children:L})]})})})]})}v.contextTypes={navigation:i.default.object};t.default=(0,o.observer)(v);try{itemadvance.displayName="itemadvance",itemadvance.__docgenInfo={description:"",displayName:"itemadvance",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/tinygrail/_/item-advance/index.tsx#itemadvance"]={docgenInfo:itemadvance.__docgenInfo,name:"itemadvance",path:"src/screens/tinygrail/_/item-advance/index.tsx#itemadvance"})}catch(e){}},"./src/screens/tinygrail/_/item-advance/styles.ts":(e,t,n)=>{n("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.memoStyles=void 0;var s=n("./src/stores/index.ts");t.memoStyles=s._.memoStyles((function(){return{container:{paddingLeft:s._.wind,backgroundColor:s._.colorTinygrailContainer},active:{backgroundColor:s._.colorTinygrailActive},item:{paddingVertical:s._.md,paddingRight:s._.wind,paddingLeft:s._.sm},border:{borderTopColor:s._.colorTinygrailBorder,borderTopWidth:s._.hairlineWidth}}}))},"./src/screens/tinygrail/advance-auction/index.tsx":(e,t,n)=>{n("./node_modules/core-js/modules/es.object.define-property.js"),n("./node_modules/core-js/modules/es.weak-map.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("./node_modules/core-js/modules/es.reflect.construct.js"),n("./node_modules/core-js/modules/es.array.sort.js");var s=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n("./node_modules/@babel/runtime/helpers/classCallCheck.js")),o=s(n("./node_modules/@babel/runtime/helpers/createClass.js")),i=s(n("./node_modules/@babel/runtime/helpers/inherits.js")),a=s(n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=s(n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),l=s(n("./node_modules/react/index.js")),d=n("./src/components/index.ts"),u=n("./src/screens/_/index.ts"),p=n("./src/stores/index.ts"),m=n("./src/utils/index.ts"),f=n("./src/utils/decorators/index.ts"),y=n("./src/utils/fetch/index.ts"),j=s(n("./src/screens/tinygrail/_/tool-bar/index.tsx")),v=s(n("./src/screens/tinygrail/advance-auction/list/index.tsx")),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var s={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=r?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]}return s.default=e,n&&n.set(e,s),s}(n("./src/screens/tinygrail/advance-auction/store.ts")),x=n("./node_modules/react/jsx-runtime.js");function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=(0,c.default)(e);if(t){var r=(0,c.default)(this).constructor;n=Reflect.construct(s,arguments,r)}else n=s.apply(this,arguments);return(0,a.default)(this,n)}}var b=function(e){(0,i.default)(n,e);var t=h(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,o.default)(n,[{key:"componentDidMount",value:function(){this.context.$.init()}},{key:"render",value:function(){var e=this.context.$,t=e.state,n=t.level,s=t.sort;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.Header,{title:"拍卖推荐",hm:["tinygrail/advance-auction","TinygrailAdvanceAuction"],statusBarEvents:!1,statusBarEventsType:"Tinygrail",headerRight:function(){return(0,x.jsx)(u.IconHeader,{name:"md-info-outline",color:p._.colorTinygrailPlain,onPress:function(){(0,y.t)("竞拍推荐.提示",{type:1}),(0,m.alert)("从英灵殿里面查找前 2000 条\n可竞拍数量 > 80, \n实时股息 / 竞拍底价 * 100 = 分数","当前计算方式")}})}}),(0,x.jsxs)(d.Page,{style:p._.container.tinygrail,children:[(0,x.jsx)(j.default,{level:n,levelMap:e.levelMap,data:_.sortDS,sort:s,direction:s?"down":void 0,onLevelSelect:e.onLevelSelect,onSortPress:e.onSortPress}),(0,x.jsx)(v.default,{})]})]})}}]),n}(l.default.Component);t.default=(0,f.inject)(_.default)((0,f.obc)(b));try{advanceauction.displayName="advanceauction",advanceauction.__docgenInfo={description:"",displayName:"advanceauction",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}},route:{defaultValue:null,description:"",name:"route",required:!1,type:{name:"{ params?: any; name?: any; }"}},onMounted:{defaultValue:null,description:"Storybook",name:"onMounted",required:!1,type:{name:"Fn"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/tinygrail/advance-auction/index.tsx#advanceauction"]={docgenInfo:advanceauction.__docgenInfo,name:"advanceauction",path:"src/screens/tinygrail/advance-auction/index.tsx#advanceauction"})}catch(e){}},"./src/screens/tinygrail/advance-auction/list/index.tsx":(e,t,n)=>{n("./node_modules/core-js/modules/es.object.define-property.js"),n("./node_modules/core-js/modules/es.object.assign.js");var s=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;s(n("./node_modules/react/index.js"));var r=n("./src/components/index.ts"),o=n("./src/stores/index.ts"),i=n("./src/utils/index.ts"),a=n("./src/utils/decorators/index.ts"),c=s(n("./src/screens/tinygrail/_/item-advance/index.tsx")),l=n("./node_modules/react/jsx-runtime.js");t.default=(0,a.obc)((function(e,t){var n=t.$;if(!n.computedList._loaded)return(0,l.jsx)(r.Loading,{style:o._.container.flex,color:o._.colorTinygrailText});var s={id:"竞拍推荐.跳转",data:{userId:n.myUserId,type:1}};return(0,l.jsx)(r.ListView,{style:o._.container.flex,contentContainerStyle:o._.container.bottom,keyExtractor:i.keyExtractor,refreshControlProps:{color:o._.colorTinygrailText},footerTextType:"tinygrailText",data:n.computedList,windowSize:6,initialNumToRender:24,maxToRenderPerBatch:24,updateCellsBatchingPeriod:24,lazy:24,scrollToTop:!0,renderItem:function(e){var t=e.item,r=e.index;return(0,l.jsx)(c.default,Object.assign({index:t._index||r,event:s,isAuctioning:n.auctioningMap[t.id],assets:n.myCharaAssetsMap[t.id]},t))},onHeaderRefresh:n.fetchAdvanceAuctionList})}));try{list.displayName="list",list.__docgenInfo={description:"",displayName:"list",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/tinygrail/advance-auction/list/index.tsx#list"]={docgenInfo:list.__docgenInfo,name:"list",path:"src/screens/tinygrail/advance-auction/list/index.tsx#list"})}catch(e){}},"./src/screens/tinygrail/advance-auction/store.ts":(e,t,n)=>{var s=n("./node_modules/@babel/runtime/regenerator/index.js");n("./node_modules/core-js/modules/es.object.define-property.js"),n("./node_modules/core-js/modules/es.reflect.construct.js"),n("./node_modules/core-js/modules/es.array.concat.js"),n("./node_modules/core-js/modules/es.number.constructor.js"),n("./node_modules/core-js/modules/es.array.sort.js"),n("./node_modules/core-js/modules/es.object.assign.js"),n("./node_modules/core-js/modules/es.array.for-each.js"),n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),n("./node_modules/core-js/modules/es.array.filter.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var r=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.sortDS=t.default=void 0;var o,i=r(n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),a=r(n("./node_modules/@babel/runtime/helpers/classCallCheck.js")),c=r(n("./node_modules/@babel/runtime/helpers/createClass.js")),l=r(n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),d=r(n("./node_modules/@babel/runtime/helpers/inherits.js")),u=r(n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),p=r(n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),m=r(n("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=r(n("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),y=n("./node_modules/mobx/dist/mobx.esm.js"),j=n("./src/stores/index.ts"),v=n("./src/utils/index.ts"),_=r(n("./src/utils/store/index.ts")),x=n("./src/constants/index.ts"),g=n("./src/screens/tinygrail/_/utils.ts");function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=(0,p.default)(e);if(t){var r=(0,p.default)(this).constructor;n=Reflect.construct(s,arguments,r)}else n=s.apply(this,arguments);return(0,u.default)(this,n)}}t.sortDS=[g.SORT_GF],t.default=(o=function(e){(0,d.default)(n,e);var t=h(n);function n(){var e;(0,a.default)(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return e=t.call.apply(t,[this].concat(o)),(0,m.default)((0,l.default)(e),"state",(0,y.observable)({level:"",sort:"",_loaded:!1})),(0,m.default)((0,l.default)(e),"init",(0,i.default)(s.mark((function t(){var n;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.advanceAuctionList._loaded,j.tinygrailStore.fetchAuction(),n||e.fetchAdvanceAuctionList(!1),e.fetchCharaAll();case 4:case"end":return t.stop()}}),t)})))),(0,m.default)((0,l.default)(e),"fetchAdvanceAuctionList",(function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=e.advanceAuctionList._loaded;return n?!e.advance&&(0,v.getTimestamp)()-Number(n)<14400?(t&&(0,v.info)("普通用户4小时内只能刷新一次"),!0):!x.DEV&&e.advance&&(0,v.getTimestamp)()-Number(n)<60?(t&&(0,v.info)("为避免服务器压力, 1分钟后再刷新吧"),!0):(j.tinygrailStore.fetchAuction(),j.tinygrailStore.fetchAdvanceAuctionList()):j.tinygrailStore.fetchAdvanceAuctionList()})),(0,m.default)((0,l.default)(e),"fetchCharaAll",(function(){return j.tinygrailStore.fetchCharaAll()})),(0,m.default)((0,l.default)(e),"onLevelSelect",(function(t){e.setState({level:t})})),(0,m.default)((0,l.default)(e),"onSortPress",(function(t){var n=e.state.sort;e.setState({sort:t===n?"":t}),e.setStorage("ScreenTinygrailAdvanceAuction")})),e}return(0,c.default)(n,[{key:"myUserId",get:function(){return j.userStore.myUserId}},{key:"advance",get:function(){return j.tinygrailStore.advance}},{key:"advanceAuctionList",get:function(){return j.tinygrailStore.advanceAuctionList}},{key:"computedList",get:function(){var e=this.state,t=e.level,n=e.sort,s=this.advanceAuctionList;if(!s._loaded)return s;var r=s;return t&&(r=Object.assign({},r,{list:(0,g.levelList)(t,r.list)})),n&&(r=Object.assign({},r,{list:(0,g.sortList)(n,"down",r.list)})),r}},{key:"levelMap",get:function(){var e=this.advanceAuctionList.list,t={};return e.forEach((function(e){return t[e.level]?t[e.level]+=1:t[e.level]=1})),t}},{key:"auctioningMap",get:function(){var e={};return j.tinygrailStore.list("auction").list.filter((function(e){return 0===e.state})).forEach((function(t){return e[t.monoId]=!0})),e}},{key:"myCharaAssetsMap",get:function(){var e={};return j.tinygrailStore.charaAll().list.forEach((function(t){e[t.id]={state:t.state||0,sacrifices:t.sacrifices||0}})),e}}]),n}(_.default),(0,f.default)(o.prototype,"myUserId",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"myUserId"),o.prototype),(0,f.default)(o.prototype,"advance",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"advance"),o.prototype),(0,f.default)(o.prototype,"advanceAuctionList",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"advanceAuctionList"),o.prototype),(0,f.default)(o.prototype,"computedList",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"computedList"),o.prototype),(0,f.default)(o.prototype,"levelMap",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"levelMap"),o.prototype),(0,f.default)(o.prototype,"auctioningMap",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"auctioningMap"),o.prototype),(0,f.default)(o.prototype,"myCharaAssetsMap",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"myCharaAssetsMap"),o.prototype),o)}}]);