(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5423],{"./src/screens/login/assist/index.tsx":(e,t,s)=>{var n=s("./node_modules/@babel/runtime/regenerator/index.js");s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.reflect.construct.js"),s("./node_modules/core-js/modules/es.array.concat.js"),s("./node_modules/core-js/modules/es.array.index-of.js"),s("./node_modules/core-js/modules/es.array.last-index-of.js"),s("./node_modules/core-js/modules/es.string.match.js"),s("./node_modules/core-js/modules/es.regexp.exec.js"),s("./node_modules/core-js/modules/es.array.join.js"),s("./node_modules/core-js/modules/es.array.slice.js"),s("./node_modules/core-js/modules/es.string.split.js");var o=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),r=o(s("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=o(s("./node_modules/@babel/runtime/helpers/createClass.js")),l=o(s("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),d=o(s("./node_modules/@babel/runtime/helpers/inherits.js")),u=o(s("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=o(s("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),f=o(s("./node_modules/@babel/runtime/helpers/defineProperty.js")),h=o(s("react")),m=o(s("./node_modules/react-native-web/dist/exports/View/index.js")),p=o(s("./node_modules/cheerio-without-node-native/index.js")),g=s("./src/components/index.ts"),_=s("./src/stores/index.ts"),x=s("./src/utils/index.ts"),y=s("./src/utils/decorators/index.ts"),j=s("./src/utils/fetch/index.ts"),b=s("./src/constants/index.ts"),v=o(s("./src/constants/i18n/index.ts")),S=s("./src/screens/login/assist/styles.ts"),T=s("./node_modules/react/jsx-runtime.js");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return(0,u.default)(this,s)}}var A="JSON.stringify({\n  userAgent: navigator.userAgent,\n  cookie: document.cookie\n});",C=function(e){(0,d.default)(s,e);var t=k(s);function s(){var e;(0,r.default)(this,s);for(var o=arguments.length,a=new Array(o),d=0;d<o;d++)a[d]=arguments[d];return e=t.call.apply(t,[this].concat(a)),(0,f.default)((0,l.default)(e),"state",{result:"",loading:!1,info:""}),(0,f.default)((0,l.default)(e),"userAgent",""),(0,f.default)((0,l.default)(e),"formhash",""),(0,f.default)((0,l.default)(e),"cookie",{chiiSid:"",chiiAuth:""}),(0,f.default)((0,l.default)(e),"code",""),(0,f.default)((0,l.default)(e),"accessToken",""),(0,f.default)((0,l.default)(e),"copy",(function(){(0,j.t)("辅助登陆.复制"),(0,x.copy)(A,"已复制")})),(0,f.default)((0,l.default)(e),"onChangeText",(function(t){e.setState({result:t})})),(0,f.default)((0,l.default)(e),"submit",(function(){var t=e.state,s=t.loading,n=t.result;if(!s)if(""!==n){(0,j.t)("辅助登陆.提交"),e.setState({loading:!0,info:v.default.login()+"请求中..."});try{var o=n;0===o.indexOf('"')&&(o=o.substring(1)),o.lastIndexOf('"')===o.length-1&&(o=o.substring(0,o.length-1));var i=JSON.parse(o),r=i.userAgent,a=i.cookie;if(!r)return void e.setState({loading:!1,info:"结果中没有userAgent, 请重新输入"});if(e.userAgent=r,a){var l=a.match(/chii_sid=(.+?);/)||a.match(/chii_sid=(.+?)$/);if(!l)return void e.setState({loading:!1,info:"结果中没有"+v.default.login()+"过的cookie, 请重新输入"});e.cookie.chiiSid=l[1];var d=a.match(/chii_auth=(.+?);/)||a.match(/chii_auth=(.+?)$/);if(!d)return void e.setState({loading:!1,info:"结果中没有"+v.default.login()+"过的cookie, 请重新输入"});e.cookie.chiiAuth=d[1]}e.onLogin()}catch(t){e.setState({loading:!1,info:"结果格式有误, 请重新输入"})}}else(0,x.info)("请粘贴结果")})),(0,f.default)((0,l.default)(e),"onLogin",(0,i.default)(n.mark((function t(){var s,o,i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.oauth();case 3:return t.next=5,e.authorize();case 5:return t.next=7,e.getAccessToken();case 7:s=t.sent,o=s._response,i=JSON.parse(o),_.userStore.updateAccessToken(i),e.inStore(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),e.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"});case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))),(0,f.default)((0,l.default)(e),"oauth",(0,i.default)(n.mark((function t(){var s,o,i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({info:"获取授权表单码...(1/4)"}),t.prev=1,s=(0,j.xhrCustom)({url:b.HOST+"/oauth/authorize?client_id="+b.APP_ID+"&response_type=code&redirect_uri="+b.URL_OAUTH_REDIRECT,headers:{Cookie:"; chii_cookietime=2592000; chii_sid="+e.cookie.chiiSid+"; chii_auth="+e.cookie.chiiAuth+";","User-Agent":e.userAgent}}),t.next=5,s;case 5:return o=t.sent,i=o._response,e.formhash=p.default.load(i)("input[name=formhash]").attr("value"),t.abrupt("return",s);case 11:return t.prev=11,t.t0=t.catch(1),e.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"}),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))),(0,f.default)((0,l.default)(e),"authorize",(0,i.default)(n.mark((function t(){var s,o,i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({info:"授权中...(2/4)"}),t.prev=1,s=(0,j.xhrCustom)({method:"POST",url:b.HOST+"/oauth/authorize?client_id="+b.APP_ID+"&response_type=code&redirect_uri="+b.URL_OAUTH_REDIRECT,headers:{"Content-Type":"application/x-www-form-urlencoded",Cookie:"; chii_cookietime=2592000; chii_sid="+e.cookie.chiiSid+"; chii_auth="+e.cookie.chiiAuth+";","User-Agent":e.userAgent},data:{formhash:e.formhash,redirect_uri:"",client_id:b.APP_ID,submit:"授权"}}),t.next=5,s;case 5:return o=t.sent,i=o.responseURL,e.code=i.split("=").slice(1).join("="),t.abrupt("return",s);case 11:return t.prev=11,t.t0=t.catch(1),e.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"}),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))),(0,f.default)((0,l.default)(e),"getAccessToken",(function(){e.setState({info:"授权成功, 获取token中...(3/4)"});try{return(0,j.xhrCustom)({method:"POST",url:b.HOST+"/oauth/access_token",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":e.userAgent},data:{grant_type:"authorization_code",client_id:b.APP_ID,client_secret:b.APP_SECRET,code:e.code,redirect_uri:b.URL_OAUTH_REDIRECT,state:(0,x.getTimestamp)()}})}catch(t){return e.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"}),!1}})),(0,f.default)((0,l.default)(e),"inStore",(0,i.default)(n.mark((function t(){var s;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({info:v.default.login()+"成功, 正在请求个人信息...(4/4)"}),s=e.props.navigation,_.userStore.updateUserCookie({cookie:"chii_cookietime=2592000; chii_sid="+e.cookie.chiiSid+"; chii_auth="+e.cookie.chiiAuth,userAgent:e.userAgent,v:0}),(0,x.feedback)(),t.next=6,_.userStore.fetchUserInfo();case 6:return t.next=8,_.userStore.fetchUsersInfo();case 8:s.popToTop();case 9:case"end":return t.stop()}}),t)})))),e}return(0,a.default)(s,[{key:"render",value:function(){var e=this.state,t=e.loading,s=e.info;return(0,T.jsxs)(g.Component,{id:"screen-login-assist",children:[(0,T.jsx)(g.Header,{title:"电脑辅助"+v.default.login(),alias:"辅助"+v.default.login(),hm:["login/assist","LoginAssist"]}),(0,T.jsx)(g.Page,{children:(0,T.jsxs)(g.ScrollView,{contentContainerStyle:this.styles.container,scrollToTop:!0,children:[(0,T.jsxs)(g.Text,{type:"danger",size:12,children:["此为",v.default.login(),"最后的手段，流程相对较多 (其实不复杂， 熟悉的话比正常",v.default.login(),"还要快和稳)，请先尝试新版和旧版",v.default.login(),"，不行再试这个。"]}),(0,T.jsxs)(g.Text,{style:_._.mt.sm,type:"sub",size:12,children:["第三方",v.default.login(),"失败受很多因素影响，如网络不佳、运营商劫持、手机系统特异， 又或者碰上bgm速度不佳 (当然还有代码有bug)。"]}),(0,T.jsxs)(g.Text,{style:_._.mt.sm,type:"sub",size:12,children:["本人能力有限，部分设备无论如何都不能走通新版和旧版的",v.default.login(),"流程， 若您实在很喜欢本应用，可以尝试下面的方法 (假如还走不通，请多尝试， 又或者过来干我)。"]}),(0,T.jsx)(g.Text,{style:_._.mt.lg,children:"1. 复制框里的代码。"}),(0,T.jsxs)(m.default,{style:_._.mt.sm,children:[(0,T.jsx)(g.Text,{style:this.styles.code,size:12,children:A}),(0,T.jsx)(g.Text,{style:this.styles.copy,size:12,type:"success",onPress:this.copy,children:"点击复制"}),(0,T.jsx)(g.Heatmap,{id:"辅助登陆.复制"})]}),(0,T.jsxs)(g.Text,{style:_._.mt.md,children:["2. 使用电脑打开浏览器，访问 ",b.HOST," (一定要是这个域名) 并",v.default.login(),"。"]}),(0,T.jsxs)(g.Text,{style:_._.mt.md,children:["3. ",v.default.login(),"成功后，打开控制台 (chrome为例，window是F12，mac是⎇ + ⌘ + i)， 之后运行复制的代码。"]}),(0,T.jsx)(g.Text,{style:_._.mt.md,children:"4. 把结果复制到下面的输入框内，提交。"}),(0,T.jsxs)(m.default,{style:_._.mt.sm,children:[(0,T.jsx)(g.Input,{style:this.styles.input,placeholder:"粘贴结果",multiline:!0,numberOfLines:6,returnKeyType:"done",returnKeyLabel:v.default.login(),onChangeText:this.onChangeText,onSubmitEditing:this.submit}),(0,T.jsx)(g.Heatmap,{id:"辅助登陆.提交"})]}),(0,T.jsx)(g.Button,{style:_._.mt.lg,type:"main",shadow:!0,loading:t,onPress:this.submit,children:v.default.login()}),(0,T.jsx)(g.Text,{style:_._.mt.md,size:12,lineHeight:16,type:"sub",children:s}),(0,T.jsx)(g.KeyboardSpacer,{})]})})]})}},{key:"styles",get:function(){return(0,S.memoStyles)()}}]),s}(h.default.Component);t.default=(0,y.ob)(C);try{assist.displayName="assist",assist.__docgenInfo={description:"",displayName:"assist",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/assist/index.tsx#assist"]={docgenInfo:assist.__docgenInfo,name:"assist",path:"src/screens/login/assist/index.tsx#assist"})}catch(e){}},"./src/screens/login/assist/styles.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.memoStyles=void 0;var n=s("./src/stores/index.ts");t.memoStyles=n._.memoStyles((function(){return{container:{display:"flex",flexDirection:"column",paddingTop:n._.sm,paddingHorizontal:n._.wind,paddingBottom:n._.lg},code:{paddingVertical:n._.md,paddingHorizontal:n._.wind,backgroundColor:n._.select(n._.colorBg,n._._colorDarkModeLevel1),borderWidth:1,borderColor:n._.colorBorder,borderRadius:n._.radiusXs,overflow:"hidden"},copy:{position:"absolute",top:n._.sm,right:n._.sm,padding:n._.sm},input:{backgroundColor:n._.select(n._.colorBg,n._._colorDarkModeLevel1)}}}))}}]);