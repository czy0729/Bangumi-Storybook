(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5185],{"./src/screens/login/token/index.tsx":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.weak-map.js"),t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.string.iterator.js"),t("./node_modules/core-js/modules/es.array.iterator.js"),t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),t("./node_modules/core-js/modules/es.object.assign.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),c=o(t("./node_modules/@babel/runtime/helpers/slicedToArray.js")),i=function(e,s){if(!s&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_(s);if(t&&t.has(e))return t.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var c=o?Object.getOwnPropertyDescriptor(e,n):null;c&&(c.get||c.set)?Object.defineProperty(r,n,c):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(t("react")),l=o(t("./node_modules/react-native-web/dist/exports/View/index.js")),u=t("./node_modules/mobx-react/dist/mobxreact.esm.js"),a=t("./src/components/index.ts"),d=t("./src/stores/index.ts"),p=t("./src/utils/index.ts"),j=t("./src/utils/fetch.v0/index.ts"),m=t("./src/utils/hooks/index.ts"),f=t("./src/screens/login/token/styles.ts"),b=t("./node_modules/react/jsx-runtime.js");function _(e){if("function"!=typeof WeakMap)return null;var s=new WeakMap,t=new WeakMap;return(_=function(e){return e?t:s})(e)}s.default=function(){var e=(0,i.useState)(""),s=(0,c.default)(e,2),t=s[0],o=s[1],_=(0,i.useCallback)((0,n.default)(r.mark((function e(){var s,n,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return(0,p.info)("已清除鉴权信息"),d.userStore.updateAccessToken({access_token:"",expires_in:604800,token_type:"Bearer",scope:null,user_id:0,refresh_token:""}),e.abrupt("return");case 4:return s=Object.assign({},d.userStore.accessToken),n={access_token:t,expires_in:604800,token_type:"Bearer",scope:null,user_id:0,refresh_token:""},d.userStore.updateAccessToken(n),e.next=9,(0,j.fetchMeV0)();case 9:if(null==(c=e.sent)||!c.id||null==c||!c.username){e.next=16;break}return(0,p.info)("更新成功"),d.userStore.updateUserInfo(Object.assign({},c,{_loaded:(0,p.getTimestamp)()})),d.userStore.updateAccessToken(Object.assign({},n,{user_id:c.id})),d.collectionStore.clearState("_collectionStatusLastFetchMS"),e.abrupt("return");case 16:(0,p.info)("更新失败，请确保用户令牌可用"),d.userStore.updateAccessToken(s),o(s.access_token);case 19:case"end":return e.stop()}}),e)}))),[t]);return(0,m.useMount)((function(){o(d.userStore.accessToken.access_token)})),(0,u.useObserver)((function(){var e=d.userStore.userInfo,s=e.avatar,r=e.nickname,n=e.username;return(0,b.jsxs)(a.Component,{id:"screen-login-token",children:[(0,b.jsx)(a.Header,{title:" ",domTitle:"授权",headerRight:function(){return(0,b.jsx)(a.Touchable,{style:d._.mr.sm,onPress:function(){(0,p.open)("https://bgm.tv/group/topic/370315")},children:(0,b.jsx)(a.Text,{children:"如何获取"})})}}),(0,b.jsx)(a.Page,{children:(0,b.jsxs)(a.Flex,{style:f.styles.container,direction:"column",justify:"center",children:[null!=s&&s.large&&r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a.Avatar,{src:s.large,size:96,round:!0}),(0,b.jsxs)(a.Text,{style:d._.mt.sm,size:16,bold:!0,children:[r," @",n]})]}):(0,b.jsx)(a.Mesume,{}),(0,b.jsx)(l.default,{style:f.styles.item,children:(0,b.jsx)(a.Input,{style:f.styles.input,placeholder:"用户令牌，必填",value:t,onChangeText:o})}),(0,b.jsx)(a.Touchable,{style:d._.mt.md,onPress:_,children:(0,b.jsxs)(a.Flex,{children:[(0,b.jsx)(a.Text,{type:"sub",size:16,bold:!0,children:"更新"}),(0,b.jsx)(a.Flex,{style:f.styles.arrow,children:(0,b.jsx)(a.Iconfont,{name:"md-arrow-forward",size:14})})]})})]})})]})}))}},"./src/screens/login/token/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.styles=void 0;var r=t("./src/stores/index.ts");s.styles=r._.create({container:{minHeight:.72*r._.window.height,paddingHorizontal:48},item:{width:"100%"},input:Object.assign({height:40,marginTop:48,paddingVertical:0,textAlign:"center"},r._.fontSize14,{borderRadius:20}),arrow:{padding:2,marginLeft:r._.sm,borderWidth:2,borderColor:r._.colorIcon,borderRadius:20}})}}]);