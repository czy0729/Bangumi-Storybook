(self.webpackChunkweb=self.webpackChunkweb||[]).push([[2682],{"./src/screens/discovery/like/component/cate/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/component/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Cate")},"./src/screens/discovery/like/component/cate/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.find-index.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=t("./src/components/index.ts"),o=t("./src/utils/decorators/index.ts"),i=t("./src/constants/index.ts"),c=t("./src/screens/discovery/like/component/cate/ds.ts"),d=t("./src/screens/discovery/like/component/cate/styles.ts"),l=t("./node_modules/react/jsx-runtime.js");s.default=(0,o.obc)((function(e,s){var t=s.$,r=(0,d.memoStyles)(),o=t.state.type;return(0,l.jsx)(n.SegmentedControl,{style:r.segment,size:11,values:i.SUBJECT_TYPE.map((function(e){return e.title})),selectedIndex:i.SUBJECT_TYPE.findIndex((function(e){return e.label===o})),onValueChange:t.onChange},o)}),c.COMPONENT);try{cate.displayName="cate",cate.__docgenInfo={description:"",displayName:"cate",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/component/cate/index.tsx#cate"]={docgenInfo:cate.__docgenInfo,name:"cate",path:"src/screens/discovery/like/component/cate/index.tsx#cate"})}catch(e){}},"./src/screens/discovery/like/component/cate/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.memoStyles=void 0;var r=t("./src/stores/index.ts");s.memoStyles=r._.memoStyles((function(){return{segment:{width:r._.window.width-2*r._.wind,height:r._.r(32),marginLeft:r._.wind,marginVertical:r._.sm}}}))},"./src/screens/discovery/like/component/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Component")},"./src/screens/discovery/like/component/item/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/component/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Item")},"./src/screens/discovery/like/component/item/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.array.join.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=r(t("./node_modules/react-native-web/dist/exports/View/index.js")),o=t("./src/components/index.ts"),i=t("./src/components/cover/utils.ts"),c=t("./src/screens/_/index.ts"),d=t("./src/stores/index.ts"),l=t("./src/utils/index.ts"),a=t("./src/utils/decorators/index.ts"),u=t("./src/utils/fetch/index.ts"),m=t("./src/constants/index.ts"),p=t("./src/screens/discovery/like/utils.ts"),f=r(t("./src/screens/discovery/like/component/item/sub/index.tsx")),j=t("./src/screens/discovery/like/component/item/ds.ts"),_=t("./src/screens/discovery/like/component/item/styles.ts"),y=t("./node_modules/react/jsx-runtime.js");s.default=(0,a.obc)((function(e,s){var t=e.item,r=s.$,a=s.navigation,j=r.state.type,v=r.subjects(t.id);if(!v||j!==m.MODEL_SUBJECT_TYPE.getLabel(v.type))return null;var h=d.collectionStore.collect(t.id);if(h&&!d.systemStore.setting.likeCollected)return null;var x=(0,_.memoStyles)(),b="https://lain.bgm.tv/pic/cover/m/"+t.image+".jpg",g=m.MODEL_SUBJECT_TYPE.getTitle(v.type),O=(0,l.getAction)(g),S=x.cover.width,T="音乐"===g?S:x.cover.height,E=14;return t.name.length>=36?E=10:t.name.length>=24&&(E=12),(0,y.jsxs)(o.Flex,{style:x.item,align:"start",children:[(0,y.jsx)(c.Cover,{src:b,width:S,height:T,radius:!0,type:g,onPress:function(){a.push("Subject",{subjectId:t.id,_cn:t.name,_image:(0,i.getCoverSrc)(b,S),_type:g}),(0,u.t)("猜你喜欢.跳转",{subjectId:t.id,userId:r.userId})}}),(0,y.jsx)(o.Flex.Item,{children:(0,y.jsxs)(o.Flex,{style:[x.body,{height:"音乐"===g?"auto":T}],direction:"column",justify:"between",align:"start",children:[(0,y.jsxs)(o.Flex,{direction:"column",align:"start",children:[(0,y.jsxs)(o.Text,{style:x.title,size:E,bold:!0,numberOfLines:3,children:[t.name,!!v.year&&(0,y.jsxs)(o.Text,{size:E,bold:!0,children:[" ","(",v.year,")"]})]}),(0,y.jsx)(c.Manage,{style:d._.ml.xxs,subjectId:t.id,collection:h,typeCn:g,horizontal:!0,onPress:function(){d.uiStore.showManageModal({subjectId:t.id,title:t.name,action:O,status:m.MODEL_COLLECTION_STATUS.getValue(h)},"猜你喜欢")}})]}),(0,y.jsxs)(n.default,{children:[!!v.total&&(0,y.jsxs)(o.Flex,{children:[(0,y.jsx)(c.Rank,{value:v.rank}),(0,y.jsx)(c.Stars,{value:v.score}),(0,y.jsxs)(o.Text,{style:d._.ml.xs,type:"sub",size:11,bold:!0,children:["(",v.total,")"]})]}),(0,y.jsx)(o.Divider,{style:x.divider}),(0,y.jsx)(f.default,{name:t.name,relates:t.relates,action:O})]})]})}),(0,y.jsx)(c.Rate,{value:t.rate,onPress:function(){(0,l.alert)((0,p.getReasonsInfo)(t.reasons).join("\n"),t.name)}})]})}),j.COMPONENT)},"./src/screens/discovery/like/component/item/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.memoStyles=void 0;var r=t("./src/stores/index.ts"),n=t("./src/constants/index.ts");s.memoStyles=r._.memoStyles((function(){return{item:{paddingHorizontal:r._.wind,paddingVertical:r._.md,marginRight:-r._.sm},cover:{width:Math.floor(1.1*n.IMG_WIDTH_LG),height:Math.floor(1.1*n.IMG_HEIGHT_LG)},body:{paddingLeft:r._.md},divider:{paddingTop:10,paddingBottom:r._.xs},title:{marginRight:64}}}))},"./src/screens/discovery/like/component/item/sub/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/component/item/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Sub")},"./src/screens/discovery/like/component/item/sub/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.string.sub.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.regexp.exec.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=t("./src/components/index.ts"),o=t("./src/stores/index.ts"),i=t("./src/utils/index.ts"),c=t("./src/utils/decorators/index.ts"),d=t("./src/constants/index.ts"),l=t("./src/screens/discovery/like/component/item/sub/ds.ts"),a=t("./src/screens/discovery/like/component/item/sub/styles.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,c.obc)((function(e,s){var t=e.name,r=e.relates,c=e.action,l=s.$,m=0,p=0;return(0,u.jsx)(n.Flex,{style:o._.mt.xs,wrap:"wrap",children:r.slice().sort((function(e,s){var r,n,o=t||"",c=(null==(r=l.relates(e))?void 0:r.name)||"";if(c.includes(o)||o.includes(c))return-1;var d=(null==(n=l.relates(s))?void 0:n.name)||"";return d.includes(o)||o.includes(d)?1:(0,i.desc)((0,i.similar)(o,c),(0,i.similar)(o,d))})).map((function(e){if(m>=28&&p>=3||p>=4)return null;var s=l.relates(e),t=Number(null==s?void 0:s.type);if(!s||1!=t&&2!=t&&3!=t)return null;m+=s.name.length,p+=1;var r=d.MODEL_COLLECTION_STATUS.getLabel(s.type);return(0,u.jsx)(n.Flex,{style:a.styles.sub,direction:"column",align:"start",children:(0,u.jsxs)(n.Text,{size:10,lineHeight:15,numberOfLines:1,onPress:function(){o.uiStore.showPopableSubject({subjectId:s.id})},children:[!!r&&(0,u.jsx)(n.Text,{size:10,type:(0,i.getType)(r),lineHeight:15,children:r.replace("看",c)+"  "}),s.name]})},s.id)}))})}),l.COMPONENT)},"./src/screens/discovery/like/component/item/sub/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.styles=void 0;var r=t("./src/stores/index.ts");s.styles=r._.create({sub:{minWidth:"25%",marginRight:r._.sm}})},"./src/screens/discovery/like/component/list/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/component/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"List")},"./src/screens/discovery/like/component/list/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=t("./src/components/index.ts"),o=t("./src/screens/_/index.ts"),i=t("./src/stores/index.ts"),c=t("./src/utils/index.ts"),d=t("./src/utils/decorators/index.ts"),l=t("./src/screens/discovery/like/component/list/utils.tsx"),a=t("./src/screens/discovery/like/component/list/ds.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,d.obc)((function(e,s){var t=s.$;return t.state.fetching?(0,u.jsx)(n.Loading,{}):(0,u.jsx)(o.PaginationList2,{keyExtractor:c.keyExtractor,contentContainerStyle:i._.container.bottom,data:t.state.list[t.state.type],limit:12,renderItem:l.renderItem,onScroll:t.onScroll,onPage:t.onPage,onNextPage:t.onNextPage,onHeaderRefresh:t.onHeaderRefresh})}),a.COMPONENT);try{list.displayName="list",list.__docgenInfo={description:"",displayName:"list",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/component/list/index.tsx#list"]={docgenInfo:list.__docgenInfo,name:"list",path:"src/screens/discovery/like/component/list/index.tsx#list"})}catch(e){}},"./src/screens/discovery/like/component/list/utils.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.renderItem=i;r(t("react"));var n=r(t("./src/screens/discovery/like/component/item/index.tsx")),o=t("./node_modules/react/jsx-runtime.js");function i(e){var s=e.item;return(0,o.jsx)(n.default,{item:s})}try{i.displayName="renderItem",i.__docgenInfo={description:"",displayName:"renderItem",props:{item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/component/list/utils.tsx#renderItem"]={docgenInfo:i.__docgenInfo,name:"renderItem",path:"src/screens/discovery/like/component/list/utils.tsx#renderItem"})}catch(e){}},"./src/screens/discovery/like/component/setting/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/component/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Setting")},"./src/screens/discovery/like/component/setting/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.map.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=r(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),o=(r(t("react")),r(t("./node_modules/react-native-web/dist/exports/View/index.js"))),i=t("./src/components/index.ts"),c=t("./src/screens/_/index.ts"),d=t("./src/stores/index.ts"),l=t("./src/utils/dev/index.ts"),a=t("./src/utils/hooks/index.ts"),u=t("./src/screens/discovery/like/ds.ts"),m=t("./src/screens/discovery/like/component/setting/ds.ts"),p=t("./src/screens/discovery/like/component/setting/styles.ts"),f=t("./node_modules/react/jsx-runtime.js");function j(e){var s=e.length;(0,l.r)(m.COMPONENT);var t=(0,a.useBoolean)(!1),r=t.state,j=t.setTrue,_=t.setFalse;return(0,a.useObserver)((function(){var e=d.systemStore.setting,t=e.likeCollected,l=e.likeRec;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(c.IconTouchable,{name:"icon-setting",color:d._.colorDesc,onPress:j}),(0,f.jsx)(i.ActionSheet,{show:r,title:"设置",height:800,onClose:_,children:(0,f.jsxs)(o.default,{style:d._.container.wind,children:[(0,f.jsx)(i.Text,{style:d._.mv.sm,size:11,lineHeight:15,type:"sub",children:"这是一个基于全站用户、条目页面中的「猜你喜欢」数据，并根据你目前的收藏，计算出的一个整合数据列表。与另一「推荐番剧」功能不同，此功能非 AI 模型推导结果，只是全程在本地进行的一些很简单的规则累加计算。所以只要你收藏、打分越多，数据就会越多。"}),!!s&&(0,f.jsxs)(i.Text,{style:[d._.mt.md,d._.mb.sm],bold:!0,children:["当前类型已索引到 ",s," 个条目"]}),(0,f.jsx)(o.default,{style:d._.mt.sm,children:(0,f.jsxs)(i.Flex,{children:[(0,f.jsx)(i.Flex.Item,{children:(0,f.jsx)(i.Text,{bold:!0,children:"显示已收藏条目"})}),(0,f.jsx)(i.SwitchPro,{style:p.styles.switch,value:t,onSyncPress:function(){d.systemStore.switchSetting("likeCollected")}})]})}),(0,f.jsx)(i.Divider,{}),(0,f.jsx)(i.Text,{style:d._.mt.md,bold:!0,children:"推荐值计算维度"}),(0,f.jsx)(i.Text,{style:d._.mt.xs,size:11,type:"sub",children:"计算非基于结果中显示的条目项，而是推荐这个项的条目"}),u.REASONS.map((function(e,s){return(0,f.jsx)(o.default,{style:d._.mt.md,children:(0,f.jsxs)(i.Flex,{children:[(0,f.jsxs)(i.Flex.Item,{children:[(0,f.jsx)(i.Text,{bold:!0,children:e}),(0,f.jsx)(i.Text,{style:d._.mt.xs,size:11,type:"sub",children:u.REASONS_INFO[s]})]}),(0,f.jsx)(i.SwitchPro,{style:p.styles.switch,value:1===l[s],onSyncPress:function(){var e=(0,n.default)(l);e[s]=e[s]?0:1,d.systemStore.setSetting("likeRec",e)}})]})})}))]})})]})}))}s.default=j;try{j.displayName="Setting",j.__docgenInfo={description:"",displayName:"Setting",props:{length:{defaultValue:null,description:"",name:"length",required:!0,type:{name:"any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/component/setting/index.tsx#Setting"]={docgenInfo:j.__docgenInfo,name:"Setting",path:"src/screens/discovery/like/component/setting/index.tsx#Setting"})}catch(e){}},"./src/screens/discovery/like/component/setting/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.styles=void 0;var r=t("./src/stores/index.ts");s.styles=r._.create({switch:{marginRight:-4,transform:[{scale:r._.device(.8,1.12)}]}})},"./src/screens/discovery/like/component/tips/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/component/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Tips")},"./src/screens/discovery/like/component/tips/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=t("./src/components/index.ts"),o=t("./src/utils/decorators/index.ts"),i=t("./src/screens/discovery/like/component/tips/ds.ts"),c=t("./node_modules/react/jsx-runtime.js");s.default=(0,o.obc)((function(e,s){var t=s.$.state,r=t.fetching,o=t.message,i=t.current,d=t.total;return(0,c.jsx)(n.Progress,{show:r,message:o,current:i,total:d})}),i.COMPONENT);try{tips.displayName="tips",tips.__docgenInfo={description:"",displayName:"tips",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/component/tips/index.tsx#tips"]={docgenInfo:tips.__docgenInfo,name:"tips",path:"src/screens/discovery/like/component/tips/index.tsx#tips"})}catch(e){}},"./src/screens/discovery/like/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.STATE=s.REASONS_INFO=s.REASONS=s.NAMESPACE=s.MAX_COLLECT_PAGE=s.LIMIT=s.HOST_API_V0=s.EXCLUDE_STATE=s.COMPONENT=s.API_COLLECTIONS=void 0;var r=s.COMPONENT="Like",n=(s.NAMESPACE="Screen"+r,s.EXCLUDE_STATE={fetching:!1,message:"",current:0,total:0}),o=(s.STATE=Object.assign({type:"anime",relates:{},list:{anime:[],book:[],game:[],music:[],real:[]},subjects:{}},n,{_loaded:!1}),s.HOST_API_V0="https://api.bgm.tv/v0"),i=(s.MAX_COLLECT_PAGE=8,s.LIMIT=100);s.API_COLLECTIONS=function(e,s,t,r){var n=o+"/users/"+e+"/collections?subject_type="+s+"&type="+t+"&limit="+(arguments.length>4&&void 0!==arguments[4]?arguments[4]:i);return r&&(n+="&offset="+r),n},s.REASONS=["自己评分","收藏状态","条目排名","条目分数","已看集数","自己点评","私密收藏","最近收藏","标签倾向","多次推荐"],s.REASONS_INFO=["已评分，高分多加分，低分多扣分","想看加分，搁置、抛弃扣分","条目自身高排名加分，低排名扣分","条目自身高分加分，低分扣分","已看过集数多，稍微加分","进行过长评稍微加分","私密收藏加分","最近操作过稍微加分","标签是你倾向打的，越多相对加越多分","被多个条目推荐到相对加分"]},"./src/screens/discovery/like/header/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),n=t("./src/screens/discovery/like/ds.ts");s.COMPONENT=(0,r.rc)(n.COMPONENT,"Header")},"./src/screens/discovery/like/header/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=t("./src/components/index.ts"),o=t("./src/screens/_/index.ts"),i=t("./src/stores/index.ts"),c=t("./src/utils/decorators/index.ts"),d=r(t("./src/screens/discovery/like/component/setting/index.tsx")),l=t("./src/screens/discovery/like/header/ds.ts"),a=t("./node_modules/react/jsx-runtime.js");s.default=(0,c.obc)((function(e,s){var t=s.$,r=s.navigation;return(0,a.jsx)(n.Header,{title:"猜你喜欢",hm:["like","Like"],headerRight:function(){var e;return(0,a.jsxs)(n.Flex,{children:[(0,a.jsx)(d.default,{length:null==(e=t.state.list[t.state.type])?void 0:e.length}),(0,a.jsx)(o.IconTouchable,{style:i._.ml.xs,name:"md-info-outline",color:i._.colorDesc,onPress:function(){r.push("Tips",{key:"hyrzz32whgurgg6t"})}})]})}})}),l.COMPONENT);try{header.displayName="header",header.__docgenInfo={description:"",displayName:"header",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/header/index.tsx#header"]={docgenInfo:header.__docgenInfo,name:"header",path:"src/screens/discovery/like/header/index.tsx#header"})}catch(e){}},"./src/screens/discovery/like/hooks.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.useLikePage=function(e){var s=e.$,t=(0,o.useIsFocused)();(0,r.useEffect)((function(){t||n.uiStore.closePopableSubject()}),[t]),(0,o.useRunAfter)((function(){s.init()}))};var r=t("react"),n=t("./src/stores/index.ts"),o=t("./src/utils/hooks/index.ts")},"./src/screens/discovery/like/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var n=t("./src/components/index.ts"),o=t("./src/screens/_/index.ts"),i=t("./src/utils/decorators/index.ts"),c=t("./src/utils/hooks/index.ts"),d=r(t("./src/screens/discovery/like/component/cate/index.tsx")),l=r(t("./src/screens/discovery/like/component/list/index.tsx")),a=r(t("./src/screens/discovery/like/component/tips/index.tsx")),u=r(t("./src/screens/discovery/like/header/index.tsx")),m=t("./src/screens/discovery/like/hooks.ts"),p=r(t("./src/screens/discovery/like/store.ts")),f=t("./node_modules/react/jsx-runtime.js");s.default=(0,i.ic)(p.default,(function(e,s){return(0,m.useLikePage)(s),(0,c.useObserver)((function(){return(0,f.jsxs)(n.Component,{id:"screen-like",children:[(0,f.jsx)(u.default,{}),(0,f.jsxs)(n.Page,{children:[(0,f.jsx)(d.default,{}),(0,f.jsx)(o.TapListener,{children:(0,f.jsx)(l.default,{})}),(0,f.jsx)(a.default,{})]})]})}))}));try{like.displayName="like",like.__docgenInfo={description:"",displayName:"like",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}},route:{defaultValue:null,description:"",name:"route",required:!1,type:{name:"{ params?: any; name?: any; }"}},onMounted:{defaultValue:null,description:"Storybook",name:"onMounted",required:!1,type:{name:"Fn"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/like/index.tsx#like"]={docgenInfo:like.__docgenInfo,name:"like",path:"src/screens/discovery/like/index.tsx#like"})}catch(e){}},"./src/screens/discovery/like/store.ts":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.object.assign.js"),t("./node_modules/core-js/modules/es.array.is-array.js"),t("./node_modules/core-js/modules/web.timers.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.string.split.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.object.entries.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.object.keys.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o,i=n(t("./node_modules/@babel/runtime/helpers/slicedToArray.js")),c=n(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),d=n(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),l=n(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=n(t("./node_modules/@babel/runtime/helpers/createClass.js")),u=n(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),m=n(t("./node_modules/@babel/runtime/helpers/inherits.js")),p=n(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),f=n(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),j=n(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),_=n(t("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),y=t("./node_modules/mobx/dist/mobx.esm.js"),v=t("./src/stores/index.ts"),h=t("./src/utils/index.ts"),x=t("./src/utils/fetch/index.ts"),b=t("./src/utils/fetch.v0/index.ts"),g=t("./src/utils/kv/index.ts"),O=n(t("./src/utils/store/index.ts")),S=t("./src/constants/index.ts"),T=n(t("./src/constants/i18n/index.ts")),E=t("./src/screens/discovery/like/utils.ts"),C=t("./src/screens/discovery/like/ds.ts");function k(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,f.default)(e);if(s){var n=(0,f.default)(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return(0,p.default)(this,t)}}s.default=(o=function(e){(0,m.default)(t,e);var s=k(t);function t(){var e,n,o;(0,l.default)(this,t);for(var a=arguments.length,m=new Array(a),p=0;p<a;p++)m[p]=arguments[p];return e=s.call.apply(s,[this].concat(m)),(0,j.default)((0,u.default)(e),"state",(0,y.observable)(C.STATE)),(0,j.default)((0,u.default)(e),"init",(0,d.default)(r.mark((function s(){return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.t0=e,s.t1=Object,s.t2={},s.next=5,e.getStorage(C.NAMESPACE);case 5:return s.t3=s.sent,s.t4=C.EXCLUDE_STATE,s.t5={_loaded:!0},s.t6=s.t1.assign.call(s.t1,s.t2,s.t3,s.t4,s.t5),s.t0.setState.call(s.t0,s.t6),e.getList(),s.abrupt("return",!0);case 12:case"end":return s.stop()}}),s)})))),(0,j.default)((0,u.default)(e),"fetchCollections",(0,d.default)(r.mark((function s(){var t,n,o,i,l,a,u,m,p,f,j,_,y,x;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(e.userId){s.next=3;break}return(0,h.info)("此功能依赖收藏数据，请先"+T.default.login(),4),s.abrupt("return",!1);case 3:if(!e.state.fetching){s.next=6;break}return s.abrupt("return",!1);case 6:return a=e.state.type,u=[],e.setState({fetching:!0,message:"获取用户收藏",current:1,total:C.MAX_COLLECT_PAGE}),m=S.MODEL_SUBJECT_TYPE.getValue(a),s.next=12,(0,b.request)((0,C.API_COLLECTIONS)(e.userId,m,S.MODEL_COLLECTION_STATUS.getTitle("看过")));case 12:if(p=s.sent,!Array.isArray(null==(t=p)?void 0:t.data)||!p.data.length){s.next=25;break}if(u.push.apply(u,(0,c.default)(p.data)),!((null==(f=p)?void 0:f.total)>100)){s.next=25;break}j=2;case 17:if(!(j<=Math.min(Math.ceil(p.total/C.LIMIT),C.MAX_COLLECT_PAGE))){s.next=25;break}return s.next=20,(0,b.request)((0,C.API_COLLECTIONS)(e.userId,m,S.MODEL_COLLECTION_STATUS.getTitle("看过"),(j-1)*C.LIMIT));case 20:p=s.sent,Array.isArray(null==(_=p)?void 0:_.data)&&p.data.length&&u.push.apply(u,(0,c.default)(p.data));case 22:j+=1,s.next=17;break;case 25:return e.setState({current:2}),s.next=28,(0,b.request)((0,C.API_COLLECTIONS)(e.userId,m,S.MODEL_COLLECTION_STATUS.getTitle("在看")));case 28:return p=s.sent,Array.isArray(null==(n=p)?void 0:n.data)&&p.data.length&&u.push.apply(u,(0,c.default)(p.data)),e.setState({current:3}),s.next=33,(0,b.request)((0,C.API_COLLECTIONS)(e.userId,m,S.MODEL_COLLECTION_STATUS.getTitle("想看")));case 33:return p=s.sent,Array.isArray(null==(o=p)?void 0:o.data)&&p.data.length&&u.push.apply(u,(0,c.default)(p.data)),e.setState({current:4}),s.next=38,(0,b.request)((0,C.API_COLLECTIONS)(e.userId,m,S.MODEL_COLLECTION_STATUS.getTitle("搁置")));case 38:return p=s.sent,Array.isArray(null==(i=p)?void 0:i.data)&&p.data.length&&u.push.apply(u,(0,c.default)(p.data)),e.setState({current:C.MAX_COLLECT_PAGE}),s.next=43,(0,b.request)((0,C.API_COLLECTIONS)(e.userId,m,S.MODEL_COLLECTION_STATUS.getTitle("抛弃")));case 43:if(p=s.sent,Array.isArray(null==(l=p)?void 0:l.data)&&p.data.length&&u.push.apply(u,(0,c.default)(p.data)),e.setState(Object.assign({},C.EXCLUDE_STATE)),u.length){s.next=49;break}return setTimeout((function(){(0,h.confirm)("没有获取到任何该类型的收藏数据，可能是您的授权信息过期了，也有可能是服务崩了，尝试重新自动授权后再次获取？",(0,d.default)(r.mark((function s(){return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,v.userStore.reOauth();case 2:setTimeout((function(){e.getList(!0)}),0);case 3:case"end":return s.stop()}}),s)}))))}),0),s.abrupt("return",!1);case 49:return y=/^\d+$|^.*([年月]).*$/,x={},u.forEach((function(e){Array.isArray(e.tags)&&e.tags.forEach((function(e){y.test(e)||(e in x?x[e]+=1:x[e]=1)}))})),s.abrupt("return",u.slice().sort((function(e,s){return(0,h.asc)(e.updated_at,s.updated_at)})).map((function(e){var s,t,r,n,o,i,c=0;return Array.isArray(e.tags)&&e.tags.forEach((function(e){c+=x[e]||0})),{id:e.subject_id,name:(0,h.HTMLDecode)(e.subject.name_cn||e.subject.name),image:(null==(s=e.subject.images)||null==(t=s.large)||null==(r=t.split("/l/"))||null==(n=r[1])||null==(o=n.split(".jpg"))?void 0:o[0])||"",rank:e.subject.rank||0,score:e.subject.score||0,rate:e.rate||0,type:e.type,ep:e.ep_status||0,comment:(null==(i=e.comment)?void 0:i.length)||0,private:e.private||!1,diff:(0,E.dayDiff)(e.updated_at),rec:c}})));case 53:case"end":return s.stop()}}),s)})))),(0,j.default)((0,u.default)(e),"fetchLike",(n=(0,d.default)(r.mark((function s(t){var n,o,c,l,a,u,m;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return n={},o={},c=t.map((function(e){return"like_"+e.id})),s.next=5,(0,g.gets)(c);case 5:return l=s.sent,Object.entries(l).forEach((function(e){var s=(0,i.default)(e,2),t=s[0],r=s[1],c=t.replace("like_","");r?n[c]=r.list||[]:o[c]=!0})),a=Object.keys(o).map((function(s){return(0,d.default)(r.mark((function t(){var o,i;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,g.get)("subject_"+s);case 2:return o=t.sent,i=Array.isArray(null==o?void 0:o.like)&&o.like.length,n[s]=i?o.like.map((function(e){return{id:Number(e.id),name:(0,h.HTMLDecode)(e.name),image:e.image.replace("//lain.bgm.tv/pic/cover/m/","").replace(".jpg","")}})):[],t.next=7,(0,g.update)("like_"+s,{list:n[s]});case 7:return t.next=9,(0,h.sleep)(40);case 9:e.setState({current:e.state.current+1});case 10:case"end":return t.stop()}}),t)})))})),e.setState({fetching:!0,message:"获取条目信息",total:a.length}),s.next=11,(0,h.queue)(a);case 11:return u={},m={},t.forEach((function(e){(n[e.id]||[]).forEach((function(s){if(m[s.id]){m[s.id].relates.push(e.id);var t=(0,E.calc)(e,m[s.id].relates.length),r=t.reasons,n=t.rate;m[s.id].rate+=n,m[s.id].reasons=(0,E.mergeArrays)(m[s.id].reasons,r)}else{u[e.id]=Object.assign({},e);var o=(0,E.calc)(e),i=o.reasons,c=o.rate;m[s.id]={name:s.name,image:s.image,relates:[e.id],rate:c,reasons:i}}}))})),e.setState(Object.assign({relates:u},C.EXCLUDE_STATE)),s.abrupt("return",m);case 16:case"end":return s.stop()}}),s)}))),function(e){return n.apply(this,arguments)})),(0,j.default)((0,u.default)(e),"getList",(0,d.default)(r.mark((function s(){var t,n,o,c,d=arguments;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(t=d.length>0&&void 0!==d[0]&&d[0],s.prev=1,n=e.state.type,t||!e.state.list[n].length){s.next=5;break}return s.abrupt("return");case 5:return s.next=7,e.fetchCollections();case 7:if(o=s.sent){s.next=10;break}return s.abrupt("return",!1);case 10:return s.next=12,e.fetchLike(o);case 12:c=s.sent,e.setState({list:(0,j.default)({},n,Object.entries(c).filter((function(e){return!!(0,i.default)(e,2)[1]})).map((function(e){var s=(0,i.default)(e,2),t=s[0],r=s[1];return Object.assign({id:Number(t)},r)})).sort((function(e,s){return(0,h.desc)((null==e?void 0:e.rate)||-100,(null==s?void 0:s.rate)||-100)})))}),e.save(),s.next=20;break;case 17:s.prev=17,s.t0=s.catch(1),(0,h.info)("请求发生错误，请重试");case 20:case"end":return s.stop()}}),s,null,[[1,17]])})))),(0,j.default)((0,u.default)(e),"fetchSubjects",(o=(0,d.default)(r.mark((function s(t){var n,o,c,d;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(n=e.state.subjects,o=[],t.forEach((function(e){e in n||o.push("subject_"+e)})),o.length){s.next=5;break}return s.abrupt("return");case 5:return s.next=7,(0,g.gets)(o);case 7:c=s.sent,d=Object.assign({},n),Object.entries(c).forEach((function(e){var s,t,r=(0,i.default)(e,2),n=r[0],o=r[1],c=n.replace("subject_","");d[c]=o?{type:o.type,rank:o.rank||0,score:(null==o||null==(s=o.rating)?void 0:s.score)||0,total:(null==o||null==(t=o.rating)?void 0:t.total)||0,year:(0,E.matchYear)(null==o?void 0:o.info),_loaded:(0,h.getTimestamp)()}:{_loaded:(0,h.getTimestamp)()}})),e.setState({subjects:d}),e.save();case 12:case"end":return s.stop()}}),s)}))),function(e){return o.apply(this,arguments)})),(0,j.default)((0,u.default)(e),"onChange",(function(s){var t=S.MODEL_SUBJECT_TYPE.getLabel(s);e.setState({fetching:!0,type:t}),e.save(),setTimeout((function(){e.setState({fetching:!1}),e.getList(),(0,x.t)("猜你喜欢.切换",{title:s})}),80)})),(0,j.default)((0,u.default)(e),"onPage",(function(s){if(s.length){var t=s.map((function(e){return e.id}));e.fetchSubjects(t),v.collectionStore.fetchCollectionStatusQueue(t)}})),(0,j.default)((0,u.default)(e),"onNextPage",(function(s){setTimeout((function(){if(s.length){var t=s.map((function(e){return e.id}));e.fetchSubjects(t),v.collectionStore.fetchCollectionStatusQueue(t)}}),2e3)})),(0,j.default)((0,u.default)(e),"onHeaderRefresh",(function(){return e.getList(!0)})),(0,j.default)((0,u.default)(e),"onScroll",(function(){v.uiStore.closePopableSubject()})),(0,j.default)((0,u.default)(e),"save",(function(){e.saveStorage(C.NAMESPACE,C.EXCLUDE_STATE)})),e}return(0,a.default)(t,[{key:"userId",get:function(){return v.userStore.usersInfo(v.userStore.myUserId).username||v.userStore.myUserId}},{key:"relates",value:function(e){var s=this;return(0,y.computed)((function(){return s.state.relates[e]})).get()}},{key:"subjects",value:function(e){var s=this;return(0,y.computed)((function(){return s.state.subjects[e]})).get()}}]),t}(O.default),(0,_.default)(o.prototype,"userId",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"userId"),o.prototype),o)},"./src/screens/discovery/like/utils.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.string.repeat.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.date.to-string.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.string.match.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.calc=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=r.systemStore.setting.likeRec,n=e.rate,i=e.rank,d=e.score,l=e.ep,a=e.comment,u=e.private,m=e.diff,p=e.rec,f=o.MODEL_COLLECTION_STATUS.getLabel(e.type),j=[];t[0]?n>=8?j.push(3*n):n<=4?j.push(-3*Math.abs(n-5)):j.push(n):j.push(0);t[1]?"想看"===f?j.push(10):"搁置"===f?j.push(-40):"抛弃"===f?j.push(-80):j.push(0):j.push(0);var _="想看"===f||"在看"===f||"看过"===f;t[2]&&_&&i?i<=100?j.push(20):i<=1e3?j.push(10):i<=2e3?j.push(5):i>=4e3?j.push(-5):i>=5e3?j.push(-10):j.push(0):j.push(0);t[3]&&_?i?j.push(d):j.push(d/2):j.push(0);t[4]&&_&&l>=12?j.push(10):j.push(0);t[5]&&_&&a>=32?j.push(10):j.push(0);t[6]&&_&&u?j.push(15):j.push(0);t[7]&&_?m&&m<=30?j.push(10):m>=365?j.push(-10):j.push(0):j.push(0);t[8]&&_&&p?j.push(p/5):j.push(0);t[9]&&_&&s?j.push(4):j.push(0);return{reasons:j=j.map((function(e){return Math.floor(e)})),rate:c(j)}},s.dayDiff=function(e){try{var s=new Date(e.replace("T"," ")),t=new Date,r=Math.abs(t.getTime()-s.getTime());return Math.ceil(r/864e5)}catch(e){return null}},s.getReasonsInfo=function(e){return e.map((function(e,s){var t="";return 0!==e&&(t+=i.REASONS[s]+"　",t+=(e>0?"↑":"↓").repeat(e>=80?5:e>=60?4:e>=40?3:e>=20?2:1)),[t,e]})).filter((function(e){return!!e[0]})).sort((function(e,s){return(0,n.desc)(e[1],s[1])})).map((function(e){return e[0]}))},s.matchYear=function(e){var s,t,r,n;if(!e||"string"!=typeof e)return"";var o=(null==(s=((null==(t=e.match(/<li><span>(连载开始|开始): <\/span>(.+?)<\/li>/))?void 0:t[2])||"").match(/(\d{4})/))?void 0:s[0])||"";return o||((null==(r=((null==(n=e.match(/<li><span>(发售日|发售日期|放送开始|上映年度|上映时间|发行日期): <\/span>(.+?)<\/li>/))?void 0:n[2])||"").match(/(\d{4})/))?void 0:r[0])||"")},s.mergeArrays=function(e,s){return e.map((function(e,t){return e+s[t]}))};var r=t("./src/stores/index.ts"),n=t("./src/utils/index.ts"),o=t("./src/constants/index.ts"),i=t("./src/screens/discovery/like/ds.ts");function c(e){for(var s=0,t=0;t<e.length;t+=1)isNaN(e[t])||(s+=Number(e[t]));return s}}}]);