(self.webpackChunkweb=self.webpackChunkweb||[]).push([[6982],{"./src/screens/discovery/recommend/component/category/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.DATA=s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/recommend/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Category"),s.DATA=["默认","动画","书籍","游戏","音乐","三次元"]},"./src/screens/discovery/recommend/component/category/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var o=t("./src/components/index.ts"),n=t("./src/screens/_/index.ts"),d=t("./src/utils/decorators/index.ts"),c=t("./src/screens/discovery/recommend/component/category/ds.ts"),a=t("./src/screens/discovery/recommend/component/category/styles.ts"),l=t("./node_modules/react/jsx-runtime.js");s.default=(0,d.obc)((function(e,s){var t=s.$;return(0,l.jsx)(n.Popover,{style:a.styles.touch,data:c.DATA,onSelect:t.onSelect,children:(0,l.jsx)(o.Button,{style:a.styles.btn,styleText:a.styles.text,size:"sm",type:"ghostMain",children:t.state.cat||"默认"})})}),c.COMPONENT);try{category.displayName="category",category.__docgenInfo={description:"",displayName:"category",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/recommend/component/category/index.tsx#category"]={docgenInfo:category.__docgenInfo,name:"category",path:"src/screens/discovery/recommend/component/category/index.tsx#category"})}catch(e){}},"./src/screens/discovery/recommend/component/category/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.styles=void 0;var r=t("./src/stores/index.ts");s.styles=r._.create({touch:{borderTopLeftRadius:34,borderBottomLeftRadius:34,overflow:"hidden"},btn:{width:68,height:40,paddingLeft:4,borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:34,borderBottomLeftRadius:34},text:{width:68}})},"./src/screens/discovery/recommend/component/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/recommend/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Component")},"./src/screens/discovery/recommend/component/list/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.SORT=s.EVENT=s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/recommend/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"List"),s.EVENT={id:"推荐.跳转"},s.SORT=[{key:"top",title:"最受好评",desc:"分数超过 8分, 看过人数超过 10000 的作品"},{key:"pop",title:"近年流行",desc:"近年来的流行作品，收藏数的排名在前 20%"},{key:"tv",title:"TV",desc:"通常的 tv 动画"},{key:"old_tv",title:"老 TV",desc:"06 年及以前的老动画"},{key:"movie",title:"剧场版",desc:"动画电影 / 剧场版"},{key:"old_movie",title:"老剧场版",desc:"06 年及以前动画电影 / 剧场版"},{key:"nsfw",title:"NSFW",desc:"绝大多数是里番"}]},"./src/screens/discovery/recommend/component/list/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.array.join.js"),t("./node_modules/core-js/modules/es.array.filter.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var o=r(t("./node_modules/react-native-web/dist/exports/View/index.js")),n=t("./src/components/index.ts"),d=t("./src/screens/_/index.ts"),c=t("./src/stores/index.ts"),a=t("./src/utils/index.ts"),l=t("./src/utils/decorators/index.ts"),i=t("./src/constants/index.ts"),u=t("./src/screens/discovery/recommend/component/list/ds.ts"),m=t("./src/screens/discovery/recommend/component/list/styles.ts"),f=t("./node_modules/react/jsx-runtime.js");s.default=(0,l.obc)((function(e,s){var t=s.$,r=s.navigation;if(t.state.searching)return(0,f.jsx)(n.Loading,{style:c._.container.flex});var l=t.state.cat;if("v1"===l){var p=t.state.data;return(0,f.jsx)(n.ScrollView,{contentContainerStyle:c._.container.bottom,keyboardDismissMode:"on-drag",onScroll:t.onScroll,children:u.SORT.slice().sort((function(e,s){var t,r;return(0,a.desc)(!(null==(t=p[e.key])||!t.length),!(null==(r=p[s.key])||!r.length))})).map((function(e){return(0,f.jsxs)(o.default,{style:c._.mv.md,children:[(0,f.jsx)(n.Text,{style:c._.ml.md,size:20,bold:!0,children:e.title}),(0,f.jsx)(o.default,{style:m.styles.list,children:p[e.key].map((function(e,s){var o,a,l=t.subject(e),i=t.subjectOSS(e);return l.jp||i.name||l.cn||i.name_cn?(0,f.jsx)(d.ItemSearch,{style:c._.container.item,navigation:r,index:s,id:"/subject/"+e,typeCn:"动画",name:l.jp||i.name,nameCn:l.cn||i.name_cn,cover:l.image||i.image,rank:l.rank||i.rank,score:l.rating.score||(null==(o=i.rating)?void 0:o.score),total:"("+(l.rating.total||(null==(a=i.rating)?void 0:a.total)||0)+")",tip:[l.eps||i.totalEps?(l.eps||i.totalEps)+"话":"",l.date||i.date,i.origin,i.director].filter((function(e){return!!e})).join(" / "),event:u.EVENT},String(e)):(0,f.jsx)(n.Flex,{style:m.styles.loading,justify:"center",children:(0,f.jsx)(n.Loading.Raw,{})},String(e))}))})]},e.key)}))})}var y=t.state.dataV2[l]||[];return(0,f.jsx)(n.ScrollView,{contentContainerStyle:c._.container.bottom,keyboardDismissMode:"on-drag",onScroll:t.onScroll,children:(0,f.jsx)(o.default,{style:m.styles.list,children:y.map((function(e,s){var a,l,p=e.sid,y=e.type,j=e.score,h=t.subject(p),b=t.subjectOSS(p);return h.jp||b.name||h.cn||b.name_cn?(0,f.jsxs)(o.default,{style:[c._.container.item,m.styles.recItem],children:[(0,f.jsx)(d.ItemSearch,{navigation:r,index:s,id:"/subject/"+p,typeCn:i.MODEL_SUBJECT_TYPE.getTitle(y||h.type||b.type),name:h.jp||b.name,nameCn:h.cn||b.name_cn,cover:h.image||b.image,rank:h.rank||b.rank,score:h.rating.score||(null==(a=b.rating)?void 0:a.score),total:"("+(h.rating.total||(null==(l=b.rating)?void 0:l.total)||0)+")",tip:[h.eps||b.totalEps?(h.eps||b.totalEps)+"话":"",h.date||b.date,b.origin,b.director].filter((function(e){return!!e})).join(" / "),showManage:!1,event:u.EVENT}),(0,f.jsx)(o.default,{style:m.styles.recBadge,pointerEvents:"none",children:(0,f.jsxs)(n.Text,{overrideStyle:m.styles.recText,children:[j,i.IOS?"":" "]})})]},String(p)):null}))})})}),u.COMPONENT);try{list.displayName="list",list.__docgenInfo={description:"",displayName:"list",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/recommend/component/list/index.tsx#list"]={docgenInfo:list.__docgenInfo,name:"list",path:"src/screens/discovery/recommend/component/list/index.tsx#list"})}catch(e){}},"./src/screens/discovery/recommend/component/list/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.styles=void 0;var r=t("./src/stores/index.ts"),o=t("./src/constants/index.ts");s.styles=r._.create({list:{minHeight:80},loading:{height:o.IMG_HEIGHT_LG},recItem:{paddingRight:20},recBadge:{position:"absolute",zIndex:1,top:8,right:r._.ios(20,14)+r._.wind-r._._wind,opacity:.5},recText:{fontFamily:"Avenir",fontStyle:"italic",fontWeight:"900",fontSize:32,lineHeight:40,letterSpacing:-2}})},"./src/screens/discovery/recommend/component/search-bar/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/recommend/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"SearchBar")},"./src/screens/discovery/recommend/component/search-bar/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),d=t("./src/screens/discovery/recommend/component/search-bar/ds.ts"),c=t("./src/screens/discovery/recommend/component/search-bar/styles.ts"),a=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.obc)((function(e,s){var t=s.$,r=(0,c.memoStyles)();return(0,a.jsx)(o.Flex,{style:r.searchBar,children:(0,a.jsx)(o.Input,{style:r.searchIpt,value:t.state.value,returnKeyType:"search",returnKeyLabel:"查询",placeholder:"输入用户 ID",onChange:t.onChange,onSubmitEditing:t.doSearchV2})})}),d.COMPONENT);try{searchbar.displayName="searchbar",searchbar.__docgenInfo={description:"",displayName:"searchbar",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/recommend/component/search-bar/index.tsx#searchbar"]={docgenInfo:searchbar.__docgenInfo,name:"searchbar",path:"src/screens/discovery/recommend/component/search-bar/index.tsx#searchbar"})}catch(e){}},"./src/screens/discovery/recommend/component/search-bar/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.memoStyles=void 0;var r=t("./src/stores/index.ts");s.memoStyles=r._.memoStyles((function(){return{searchBar:{borderTopRightRadius:34,borderBottomRightRadius:34,backgroundColor:r._.select(r._.colorBg,r._._colorDarkModeLevel1),overflow:"hidden"},searchIpt:Object.assign({height:40},r._.fontSize12,{backgroundColor:r._.select(r._.colorBg,r._._colorDarkModeLevel1),borderRadius:0}),split:{width:1,height:16,marginRight:8,borderLeftWidth:1,borderColor:r._.colorBorder}}}))},"./src/screens/discovery/recommend/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.STATE=s.NAMESPACE=s.HOST_REC=s.EXCLUDE_STATE=s.COMPONENT=void 0;var r=t("./src/stores/index.ts"),o=t("./src/constants/index.ts"),n=t("./config.ts"),d=s.COMPONENT="Recommend",c=(s.NAMESPACE="Screen"+d,s.HOST_REC=o.STORYBOOK?n.HOST_PROXY:"https://bangrecs.net",s.EXCLUDE_STATE={visibleBottom:r._.window.height,cat:"动画",focus:!1,searching:!1});s.STATE=Object.assign({},c,{value:"",e:"",data:{top:[],pop:[],tv:[],old_tv:[],movie:[],old_movie:[],nsfw:[],_loaded:0},dataV2:{默认:[],动画:[],书籍:[],游戏:[],音乐:[],三次元:[]},subjects:{},_loaded:!1})},"./src/screens/discovery/recommend/header/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/recommend/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Header")},"./src/screens/discovery/recommend/header/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),d=t("./src/constants/index.ts"),c=t("./src/screens/discovery/recommend/header/ds.ts"),a=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.obc)((function(e,s){var t=s.navigation;return(0,a.jsx)(o.Header,{title:"AI 推荐",hm:["recommend","Recommend"],headerRight:function(){return d.STORYBOOK?null:(0,a.jsx)(o.Header.Popover,{data:["说明","帖子讨论"],onSelect:function(e){"说明"===e?t.push("Tips",{key:"hyrzz32whgurgg6t"}):"帖子讨论"===e&&t.push("Topic",{topicId:"group/382655"})}})}})}),c.COMPONENT);try{header.displayName="header",header.__docgenInfo={description:"",displayName:"header",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/recommend/header/index.tsx#header"]={docgenInfo:header.__docgenInfo,name:"header",path:"src/screens/discovery/recommend/header/index.tsx#header"})}catch(e){}},"./src/screens/discovery/recommend/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var o=r(t("./node_modules/react-native-web/dist/exports/View/index.js")),n=t("./src/components/index.ts"),d=t("./src/screens/_/index.ts"),c=t("./src/stores/index.ts"),a=t("./src/utils/decorators/index.ts"),l=t("./src/utils/hooks/index.ts"),i=t("./src/constants/index.ts"),u=r(t("./src/screens/discovery/recommend/component/category/index.tsx")),m=r(t("./src/screens/discovery/recommend/component/list/index.tsx")),f=r(t("./src/screens/discovery/recommend/component/search-bar/index.tsx")),p=r(t("./src/screens/discovery/recommend/header/index.tsx")),y=r(t("./src/screens/discovery/recommend/store/index.ts")),j=t("./src/screens/discovery/recommend/styles.ts"),h=t("./node_modules/react/jsx-runtime.js");s.default=(0,a.ic)(y.default,(function(e,s){var t=s.$,r=s.navigation;return(0,l.useRunAfter)((function(){t.init()})),(0,l.useObserver)((function(){var e=(0,j.memoStyles)();return(0,h.jsxs)(n.Component,{id:"screen-recommend",children:[(0,h.jsx)(p.default,{}),(0,h.jsxs)(n.Page,{children:[(0,h.jsxs)(n.Flex,{style:e.searchBar,children:[(0,h.jsx)(u.default,{}),(0,h.jsx)(n.Flex.Item,{children:(0,h.jsx)(f.default,{})}),(0,h.jsx)(n.Button,{style:e.btn,type:"ghostPlain",size:"sm",onPress:t.doSearchV2,children:"查询"})]}),(0,h.jsx)(m.default,{})]}),i.STORYBOOK&&(0,h.jsx)(o.default,{style:e.home,children:(0,h.jsx)(d.IconTouchable,{name:"home",size:17,color:c._.colorSub,onPress:function(){return r.push("Discovery")}})})]})}))}));try{recommend.displayName="recommend",recommend.__docgenInfo={description:"",displayName:"recommend",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}},route:{defaultValue:null,description:"",name:"route",required:!1,type:{name:"{ params?: any; name?: any; }"}},onMounted:{defaultValue:null,description:"Storybook",name:"onMounted",required:!1,type:{name:"Fn"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/discovery/recommend/index.tsx#recommend"]={docgenInfo:recommend.__docgenInfo,name:"recommend",path:"src/screens/discovery/recommend/index.tsx#recommend"})}catch(e){}},"./src/screens/discovery/recommend/store/action.ts":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/web.timers.js"),t("./node_modules/core-js/modules/es.function.bind.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),d=o(t("./node_modules/@babel/runtime/helpers/createClass.js")),c=o(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=o(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),l=o(t("./node_modules/@babel/runtime/helpers/inherits.js")),i=o(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),u=o(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),m=o(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=t("./src/utils/index.ts"),p=t("./src/constants/index.ts"),y=o(t("./src/screens/discovery/recommend/store/fetch.ts")),j=t("./src/screens/discovery/recommend/store/ds.ts");function h(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,u.default)(e);if(s){var o=(0,u.default)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,i.default)(this,t)}}s.default=function(e){(0,l.default)(t,e);var s=h(t);function t(){var e;(0,c.default)(this,t);for(var o=arguments.length,d=new Array(o),l=0;l<o;l++)d[l]=arguments[l];return e=s.call.apply(s,[this].concat(d)),(0,m.default)((0,a.default)(e),"onChange",(function(s){var t=s.nativeEvent.text;e.setState({value:t})})),(0,m.default)((0,a.default)(e),"onChangeE",(function(s){var t=s.nativeEvent.text;e.setState({e:t})})),(0,m.default)((0,a.default)(e),"onSelect",(function(s){setTimeout((0,n.default)(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({cat:s}),t.next=3,e.doSearchV2();case 3:if(p.STORYBOOK){t.next=6;break}return t.next=6,e.fetchSubjects();case 6:return t.next=8,e.fetchSubjectsFromOSS();case 8:e.setStorage(j.NAMESPACE);case 9:case"end":return t.stop()}}),t)}))),16)})),(0,m.default)((0,a.default)(e),"onScroll",f.updateVisibleBottom.bind((0,a.default)(e))),e}return(0,d.default)(t)}(y.default)},"./src/screens/discovery/recommend/store/computed.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o,n=r(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),d=r(t("./node_modules/@babel/runtime/helpers/createClass.js")),c=r(t("./node_modules/@babel/runtime/helpers/inherits.js")),a=r(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),l=r(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),i=r(t("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),u=t("./node_modules/mobx/dist/mobx.esm.js"),m=t("./src/stores/index.ts"),f=r(t("./src/screens/discovery/recommend/store/state.ts"));function p(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,l.default)(e);if(s){var o=(0,l.default)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,a.default)(this,t)}}s.default=(o=function(e){(0,c.default)(t,e);var s=p(t);function t(){return(0,n.default)(this,t),s.apply(this,arguments)}return(0,d.default)(t,[{key:"ids",get:function(){var e=[],s=this.state.cat;if("v1"===s){var t=this.state.data;["top","pop","tv","old_tv","movie","old_movie","nsfw"].forEach((function(s){t[s].forEach((function(s){e.push(s)}))}))}else{(this.state.dataV2[s]||[]).forEach((function(s){return e.push(s.sid)}))}return e}},{key:"subject",value:function(e){return(0,u.computed)((function(){return m.subjectStore.subjectV2(e)})).get()}},{key:"subjectOSS",value:function(e){var s=this;return(0,u.computed)((function(){return s.state.subjects["subject_"+e]||{}})).get()}}]),t}(f.default),(0,i.default)(o.prototype,"ids",[u.computed],Object.getOwnPropertyDescriptor(o.prototype,"ids"),o.prototype),o)},"./src/screens/discovery/recommend/store/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.STATE=s.NAMESPACE=s.HOST_REC=s.EXCLUDE_STATE=s.COMPONENT=void 0;var r=t("./src/stores/index.ts"),o=t("./src/constants/index.ts"),n=t("./config.ts"),d=s.COMPONENT="Recommend",c=(s.NAMESPACE="Screen"+d,s.HOST_REC=o.STORYBOOK?n.HOST_PROXY:"https://cf.bangrecs.net",s.EXCLUDE_STATE={visibleBottom:r._.window.height,cat:"动画",focus:!1,searching:!1});s.STATE=Object.assign({},c,{value:"",e:"",data:{top:[],pop:[],tv:[],old_tv:[],movie:[],old_movie:[],nsfw:[],_loaded:0},dataV2:{默认:[],动画:[],书籍:[],游戏:[],音乐:[],三次元:[]},subjects:{},_loaded:!1})},"./src/screens/discovery/recommend/store/fetch.ts":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.object.entries.js"),t("./node_modules/core-js/modules/es.string.match.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.is-array.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.string.trim.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.number.to-fixed.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=o(t("./node_modules/@babel/runtime/helpers/slicedToArray.js")),d=o(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),c=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),a=o(t("./node_modules/@babel/runtime/helpers/createClass.js")),l=o(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),i=o(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),u=o(t("./node_modules/@babel/runtime/helpers/inherits.js")),m=o(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),f=o(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=o(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),y=t("./src/utils/index.ts"),j=t("./src/utils/fetch/index.ts"),h=t("./src/utils/kv/index.ts"),b=o(t("./src/utils/thirdParty/axios.js")),v=t("./src/constants/index.ts"),_=o(t("./src/screens/discovery/recommend/store/computed.ts")),x=t("./src/screens/discovery/recommend/store/ds.ts");function g(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,f.default)(e);if(s){var o=(0,f.default)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,m.default)(this,t)}}s.default=function(e){(0,u.default)(t,e);var s=g(t);function t(){var e;(0,l.default)(this,t);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return e=s.call.apply(s,[this].concat(a)),(0,p.default)((0,i.default)(e),"fetchSubjects",(0,c.default)(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})))),(0,p.default)((0,i.default)(e),"fetchSubjectsFromOSS",(0,c.default)(r.mark((function s(){var t,o,c,a,l,i;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if((t=(0,d.default)(e.ids)).length){s.next=3;break}return s.abrupt("return",!0);case 3:if(o=e.state.subjects,c=(0,y.getTimestamp)(),a=[],t.forEach((function(s){if(!e.subject(s).id){var t=(o[s]||{})._loaded;if(!t||c-Number(t)>=3600){var r=e.subjectOSS(s)._loaded;(!r||c-Number(r)>=3600)&&a.push("subject_"+s)}}})),a.length){s.next=9;break}return s.abrupt("return",!0);case 9:return s.prev=9,console.info("fetchSubjectsFromOSS",a),l=["name","name_cn","image","rank","rating","totalEps","info","staff","tags"],s.next=14,(0,h.gets)(a,l);case 14:i=s.sent,Object.entries(i).forEach((function(e){var s=(0,n.default)(e,2),t=s[0],r=s[1];try{var o;if(i[t]=(0,y.pick)(r,l),i[t].info)i[t].date=(null==(o=i[t].info.match(/<li><span>(发售日|放送开始|上映年度|上映时间): <\/span>(.+?)<\/li>/))?void 0:o[2])||"";if(delete i[t].info,!i[t].date&&Array.isArray(i[t].tags)){var d=i[t].tags.find((function(e){return/^\d+年\d+月$/.test(e.name)}));d&&(i[t].date=d.name),d=i[t].tags.find((function(e){return/^\d{4}$/.test(e.name)})),d&&(i[t].date=d.name)}if(delete i[t].tags,Array.isArray(i[t].staff)){var c,a,u=i[t].staff.find((function(e){return"原作"===e.desc}));i[t].origin=(null==u?void 0:u.name)||(null==u?void 0:u.nameJP)||"";var m,f,p=i[t].staff.find((function(e){return"导演"===e.desc}));if(i[t].director=(null==(c=p)?void 0:c.name)||(null==(a=p)?void 0:a.nameJP)||"",!i[t].director)p=i[t].staff.find((function(e){return"作者"===e.desc||"开发"===e.desc||"音乐"===e.desc})),i[t].director=(null==(m=p)?void 0:m.name)||(null==(f=p)?void 0:f.nameJP)||""}delete i[t].staff,i[t]._loaded=(0,y.getTimestamp)()}catch(e){}})),e.setState({subjects:i}),e.setStorage(x.NAMESPACE),s.next=22;break;case 20:s.prev=20,s.t0=s.catch(9);case 22:case"end":return s.stop()}}),s,null,[[9,20]])})))),(0,p.default)((0,i.default)(e),"doSearchV2",(0,c.default)(r.mark((function s(){var t,o,n,d,c,a,l,i;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,n=e.state,d=n.cat,c=n.value){s.next=4;break}return s.abrupt("return");case 4:return e.setState({searching:!0}),a=v.MODEL_SUBJECT_TYPE.getValue(d),s.next=8,(0,b.default)({method:"POST",url:x.HOST_REC+"/api/v4/rec/"+c.trim(),data:{IsTagFilter:!1,IsTimeFilter:!1,popdays:7,strategy:"p",tags:[[]],topk:40,type:String(a||0),update_f:!1}});case 8:if(l=s.sent,i=l.data,null!=(t=i)&&t.data&&(i=i.data),(0,j.t)("推荐.刷新",{value:c.trim(),type:a||0}),!Array.isArray(i)||!i.length){s.next=22;break}if(e.setState({dataV2:(0,p.default)({},d,i.sort((function(e,s){return(0,y.desc)(e.score,s.score)})).map((function(e){return{sid:e.sid,type:e.type,score:e.score.toFixed(1)}})))}),v.STORYBOOK){s.next=17;break}return s.next=17,e.fetchSubjects();case 17:return s.next=19,e.fetchSubjectsFromOSS();case 19:e.setStorage(x.NAMESPACE),s.next=23;break;case 22:null!=(o=i)&&o.message&&(e.setState({dataV2:(0,p.default)({},d,[])}),e.setStorage(x.NAMESPACE),(0,y.info)(i.message));case 23:s.next=28;break;case 25:s.prev=25,s.t0=s.catch(0),(0,y.info)("获取出错，请重试");case 28:e.setState({searching:!1});case 29:case"end":return s.stop()}}),s,null,[[0,25]])})))),e}return(0,a.default)(t)}(_.default)},"./src/screens/discovery/recommend/store/index.ts":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.object.assign.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),d=o(t("./node_modules/@babel/runtime/helpers/createClass.js")),c=o(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=o(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),l=o(t("./node_modules/@babel/runtime/helpers/inherits.js")),i=o(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),u=o(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),m=o(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=t("./src/stores/index.ts"),p=t("./src/constants/index.ts"),y=o(t("./src/screens/discovery/recommend/store/action.ts")),j=t("./src/screens/discovery/recommend/store/ds.ts");function h(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,u.default)(e);if(s){var o=(0,u.default)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,i.default)(this,t)}}var b=function(e){(0,l.default)(t,e);var s=h(t);function t(){var e;(0,c.default)(this,t);for(var o=arguments.length,d=new Array(o),l=0;l<o;l++)d[l]=arguments[l];return e=s.call.apply(s,[this].concat(d)),(0,m.default)((0,a.default)(e),"init",(0,n.default)(r.mark((function s(){return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.t0=e,s.t1=Object,s.t2={},s.next=5,e.getStorage(j.NAMESPACE);case 5:if(s.t3=s.sent,s.t4=j.EXCLUDE_STATE,s.t5={_loaded:!0},s.t6=s.t1.assign.call(s.t1,s.t2,s.t3,s.t4,s.t5),s.t0.setState.call(s.t0,s.t6),p.STORYBOOK){s.next=14;break}return!e.state.value&&f.userStore.myId&&e.setState({value:String(f.userStore.myId)}),s.next=14,e.fetchSubjects();case 14:return s.abrupt("return",e.fetchSubjectsFromOSS());case 15:case"end":return s.stop()}}),s)})))),e}return(0,d.default)(t)}(y.default);s.default=b},"./src/screens/discovery/recommend/store/state.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o=r(t("./node_modules/@babel/runtime/helpers/createClass.js")),n=r(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),d=r(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),c=r(t("./node_modules/@babel/runtime/helpers/inherits.js")),a=r(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),l=r(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),i=r(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),u=t("./node_modules/mobx/dist/mobx.esm.js"),m=r(t("./src/utils/store/index.ts")),f=t("./src/screens/discovery/recommend/store/ds.ts");function p(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,l.default)(e);if(s){var o=(0,l.default)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,a.default)(this,t)}}s.default=function(e){(0,c.default)(t,e);var s=p(t);function t(){var e;(0,n.default)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return e=s.call.apply(s,[this].concat(o)),(0,i.default)((0,d.default)(e),"state",(0,u.observable)(f.STATE)),e}return(0,o.default)(t)}(m.default)},"./src/screens/discovery/recommend/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.memoStyles=void 0;var r=t("./src/stores/index.ts");s.memoStyles=r._.memoStyles((function(){return{searchBar:{paddingTop:r._.sm,paddingBottom:r._.md,paddingHorizontal:r._.wind},btn:{width:68,height:40,marginLeft:r._.sm,borderRadius:40},home:{position:"fixed",zIndex:1001,top:9,right:10}}}))}}]);