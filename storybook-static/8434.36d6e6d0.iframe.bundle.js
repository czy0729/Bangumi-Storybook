(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8434],{"./src/screens/reader/comic/index.js":(e,t,r)=>{r("./node_modules/core-js/modules/es.object.define-property.js"),r("./node_modules/core-js/modules/es.reflect.construct.js"),r("./node_modules/core-js/modules/es.string.sub.js"),r("./node_modules/core-js/modules/es.array.map.js"),r("./node_modules/core-js/modules/es.string.search.js"),r("./node_modules/core-js/modules/es.regexp.exec.js");var s=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=s(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=s(r("./node_modules/@babel/runtime/helpers/createClass.js")),o=s(r("./node_modules/@babel/runtime/helpers/inherits.js")),c=s(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),l=s(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),u=s(r("./node_modules/react/index.js")),_=s(r("./node_modules/react-native-web/dist/exports/View/index.js")),d=r("./src/components/index.ts"),p=r("./src/screens/_/index.ts"),h=r("./src/stores/index.ts"),m=r("./src/utils/index.ts"),f=r("./src/utils/decorators/index.ts"),b=r("./src/constants/index.ts"),g=s(r("./src/screens/reader/comic/store.js")),x=r("./node_modules/react/jsx-runtime.js");function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,s=(0,l.default)(e);if(t){var n=(0,l.default)(this).constructor;r=Reflect.construct(s,arguments,n)}else r=s.apply(this,arguments);return(0,c.default)(this,r)}}t.default=(0,f.inject)(g.default)(n=(0,f.withHeader)({title:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).cn},screen:"",alias:"漫画",hm:["comic","Comic"]})(n=(0,f.obc)(n=function(e){(0,o.default)(r,e);var t=j(r);function r(){return(0,i.default)(this,r),t.apply(this,arguments)}return(0,a.default)(r,[{key:"componentDidMount",value:function(){this.context.$.init()}},{key:"renderInfo",value:function(e){var t=this.context.$,r=t.state.searchingUrl;return(0,x.jsxs)(d.Touchable,{onPress:function(){return t.searchEps(e)},children:[(0,x.jsxs)(d.Flex,{style:this.styles.info,align:"start",children:[(0,x.jsx)(d.Image,{src:e.cover,headers:e.headers,width:b.IMG_WIDTH,height:b.IMG_HEIGHT,cache:!1,shadow:!0,radius:!0}),(0,x.jsx)(d.Heatmap,{id:"漫画.搜索章节"}),(0,x.jsx)(d.Flex.Item,{style:h._.ml.md,children:(0,x.jsxs)(d.Flex,{style:this.styles.content,direction:"column",justify:"between",align:"start",children:[(0,x.jsxs)(_.default,{children:[(0,x.jsx)(d.Text,{size:15,numberOfLines:2,bold:!0,children:e.title}),(0,x.jsx)(d.Text,{style:h._.mt.sm,type:"sub",size:13,numberOfLines:2,bold:!0,children:e.sub})]}),(0,x.jsx)(d.Text,{type:"sub",size:12,numberOfLines:1,children:e.extra})]})}),(0,x.jsx)(p.Tag,{style:this.styles.tag,type:e.type,value:e.tag})]}),r===e.url&&(0,x.jsx)(d.Loading,{style:h._.mt.md,children:(0,x.jsx)(d.Text,{style:h._.mt.sm,type:"sub",size:12,children:"查找章节中"})})]})}},{key:"renderEps",value:function(e){var t=this,r=this.context.$,s=r.state.eps[e.url],n=s.list,i=s._loaded;return(0,x.jsx)(d.Expand,{ratio:1.6,children:(0,x.jsxs)(d.Flex,{style:this.styles.eps,wrap:"wrap",children:[!!i&&!n.length&&(0,x.jsx)(d.Text,{style:h._.mt.sm,type:"sub",children:"没有搜索到章节"}),n.map((function(s,n){return(0,x.jsxs)(d.Touchable,{style:t.styles.ep,onPress:function(){return r.searchThenOpen(s,s.text+" - "+e.title,n)},children:[(0,x.jsx)(d.Text,{size:13,children:s.text}),!n&&(0,x.jsx)(d.Heatmap,{id:"漫画.搜索图片"})]},s.url)}))]})})}},{key:"render",value:function(){var e=this,t=this.context.$,r=t.state,s=r.key,n=r.origins,i=r.eps;if(!r._loaded)return(0,x.jsx)(_.default,{style:h._.container.screen,children:(0,x.jsx)(d.Loading,{})});var a=n.list;return(0,x.jsxs)(d.ScrollView,{style:h._.container.screen,scrollToTop:!0,children:[(0,x.jsxs)(d.Flex,{style:this.styles.search,children:[(0,x.jsx)(d.Flex.Item,{children:(0,x.jsx)(d.Input,{style:this.styles.ipt,value:s,returnKeyType:"search",onChangeText:t.onChange,onSubmitEditing:t.onSearch})}),(0,x.jsxs)(_.default,{style:h._.ml.sm,children:[(0,x.jsx)(d.Button,{style:this.styles.btn,size:"sm",onPress:t.onSearch,children:"搜索"}),(0,x.jsx)(d.Heatmap,{id:"漫画.搜索"})]})]}),a.length?a.map((function(t,r){return(0,x.jsx)(_.default,{style:e.styles.item,children:(0,x.jsxs)(_.default,{style:(0,m.stl)(e.styles.wrap,0!==r&&e.styles.border),children:[e.renderInfo(t),!!i[t.url]&&e.renderEps(t)]})},t.url)})):(0,x.jsxs)(d.Flex,{style:this.styles.empty,direction:"column",justify:"center",children:[(0,x.jsx)(d.Mesume,{}),(0,x.jsx)(d.Text,{style:[this.styles.footerText,h._.mt.sm],children:"搜索不到源头"})]}),(0,x.jsx)(d.Heatmap,{id:"漫画.初始化",transparent:!0})]})}},{key:"styles",get:function(){return y()}}]),r}(u.default.Component))||n)||n)||n;var y=h._.memoStyles((function(e){return{search:{paddingVertical:e.space,paddingHorizontal:e.wind},ipt:{height:34,paddingHorizontal:e._wind,fontSize:12+e.fontSizeAdjust,lineHeight:14,backgroundColor:e.colorPlain,borderRadius:34},btn:{width:68,height:34,borderRadius:34},item:{paddingLeft:e._wind,backgroundColor:e.colorPlain},wrap:{paddingVertical:e.space,paddingRight:e.wind},border:{borderTopColor:e.colorBorder,borderTopWidth:e.hairlineWidth},content:{paddingVertical:2,height:b.IMG_HEIGHT},tag:{marginTop:2,marginLeft:e.sm},eps:{paddingTop:e.md},ep:{paddingVertical:4,paddingHorizontal:8,marginRight:8,marginBottom:12,backgroundColor:e.select(e.colorBg,e._colorDarkModeLevel1),borderWidth:1,borderColor:e.select(e.colorBorder,e._colorDarkModeLevel1),borderRadius:e.radiusXs},empty:{flex:1,height:480}}}))},"./src/screens/reader/comic/store.js":(__unused_webpack_module,exports,__webpack_require__)=>{var _regeneratorRuntime=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js");__webpack_require__("./node_modules/core-js/modules/es.object.define-property.js"),__webpack_require__("./node_modules/core-js/modules/es.reflect.construct.js"),__webpack_require__("./node_modules/core-js/modules/es.array.concat.js"),__webpack_require__("./node_modules/core-js/modules/es.object.assign.js"),__webpack_require__("./node_modules/core-js/modules/es.string.replace.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.exec.js"),__webpack_require__("./node_modules/core-js/modules/es.array.slice.js"),__webpack_require__("./node_modules/core-js/modules/es.array.map.js"),__webpack_require__("./node_modules/core-js/modules/es.array.find.js"),__webpack_require__("./node_modules/core-js/modules/es.array.reverse.js"),__webpack_require__("./node_modules/core-js/modules/es.string.trim.js"),__webpack_require__("./node_modules/core-js/modules/es.array.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.string.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.string.match.js"),__webpack_require__("./node_modules/core-js/modules/es.string.split.js"),__webpack_require__("./node_modules/core-js/modules/es.array.join.js"),__webpack_require__("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_assertThisInitialized2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),_inherits2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/inherits.js")),_possibleConstructorReturn2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),_getPrototypeOf2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),_applyDecoratedDescriptor2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),_mobx=__webpack_require__("./node_modules/mobx/dist/mobx.esm.js"),_utils=__webpack_require__("./src/utils/index.ts"),_ui=__webpack_require__("./src/utils/ui/index.ts"),_fetch=__webpack_require__("./src/utils/fetch/index.ts"),_store2=_interopRequireDefault(__webpack_require__("./src/utils/store/index.ts")),_html=__webpack_require__("./src/utils/html/index.ts"),_constants=__webpack_require__("./src/constants/index.ts"),_site=__webpack_require__("./src/constants/site/index.ts"),_class;function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,s=(0,_getPrototypeOf2.default)(e);if(t){var n=(0,_getPrototypeOf2.default)(this).constructor;r=Reflect.construct(s,arguments,n)}else r=s.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,r)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var namespace="ScreenComic",excludeState={eps:{},images:{},searchingUrl:""},ScreenComic=exports.default=(_class=function(_store){(0,_inherits2.default)(ScreenComic,_store);var _super=_createSuper(ScreenComic);function ScreenComic(){var _this,_ref2,_ref3,_ref5;(0,_classCallCheck2.default)(this,ScreenComic);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _this=_super.call.apply(_super,[this].concat(args)),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"state",(0,_mobx.observable)(Object.assign({key:"",origins:_constants.LIST_EMPTY},excludeState,{_loaded:!1}))),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"init",(0,_asyncToGenerator2.default)(_regeneratorRuntime.mark((function e(){var t,r,s,n;return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_fetch.t)("漫画.初始化",{subjectId:_this.subjectId}),t=_this.params,r=t.cn,s=t.jp,e.next=4,_this.getStorage(void 0,_this.namespace);case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0={};case 7:if(n=e.t0,_this.setState(Object.assign({},n,{key:r||s},excludeState)),!n.origins||!n.origins.list.length){e.next=12;break}return _this.setState({_loaded:!0}),e.abrupt("return");case 12:return(0,_ui.info)("1/4"),e.next=15,_this.searchOrigins(r);case 15:if(!e.sent.length){e.next=19;break}return _this.setState({_loaded:!0}),e.abrupt("return");case 19:return e.next=21,(0,_utils.sleep)(2e3);case 21:return(0,_ui.info)("2/4"),e.next=24,_this.searchOrigins(r.replace(/,|\.|!|\?|\(|\)|·|、|。|！|，|（|）/g," "));case 24:if(!e.sent.length){e.next=28;break}return _this.setState({_loaded:!0}),e.abrupt("return");case 28:return e.next=30,(0,_utils.sleep)(2e3);case 30:if((0,_ui.info)("3/4"),s===r){e.next=38;break}return e.next=34,_this.searchOrigins(s);case 34:if(!e.sent.length){e.next=38;break}return _this.setState({_loaded:!0}),e.abrupt("return");case 38:return e.next=40,(0,_utils.sleep)(2e3);case 40:if((0,_ui.info)("4/4"),!(r.length>4)){e.next=48;break}return e.next=44,_this.searchOrigins(r.slice(0,3));case 44:if(!e.sent.length){e.next=48;break}return _this.setState({_loaded:!0}),e.abrupt("return");case 48:_this.setState({key:r||s,_loaded:!0}),(0,_ui.info)("搜索完毕");case 50:case"end":return e.stop()}}),e)})))),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"searchOrigins",(_ref2=(0,_asyncToGenerator2.default)(_regeneratorRuntime.mark((function e(t){var r,s,n,i,a,o,c;return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_fetch.fetchHTML)({url:(0,_site.SITE_77MH)()+"/m.php?k="+encodeURIComponent(t)});case 2:return r=e.sent,s=(0,_html.cheerio)(r),n=s("div.clist > ul > a").map((function(e,t){var r=(0,_html.cheerio)(t);return(0,_utils.safeObject)({url:r.attr("href"),cover:r.find("img").attr("src"),title:r.find("p.title").text(),sub:r.find("p.subtitle").text(),extra:r.find("p.uptime").text(),headers:{Referer:(0,_site.SITE_77MH)()+"/m.php"},type:"warning",tag:"新新漫画"})})).get()||[],e.next=7,(0,_fetch.fetchHTML)({method:"POST",url:(0,_site.SITE_COMIC123)()+"/index.php/search.html",data:{keyword:t}});case 7:return i=e.sent,a=(0,_html.cheerio)(i),o=a("li.vbox").map((function(e,t){var r=(0,_html.cheerio)(t),s=r.find("a.vbox_t");return(0,_utils.safeObject)({url:""+(0,_site.SITE_COMIC123)()+s.attr("href"),title:s.attr("title"),cover:s.find("mip-img").attr("src"),sub:s.find("mip-img + span").text(),extra:r.find("h4 + h4").text(),headers:{Referer:(0,_site.SITE_COMIC123)()+"/"},type:"main",tag:"漫画123"})})).get()||[],(c=[].concat((0,_toConsumableArray2.default)(n),(0,_toConsumableArray2.default)(o))).length&&(_this.setState({key:t,origins:{list:c,_loaded:(0,_utils.getTimestamp)()}}),_this.setStorage(void 0,void 0,_this.namespace),(0,_ui.info)("搜索完毕")),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)}))),function(e){return _ref2.apply(this,arguments)})),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"searchEps",(_ref3=(0,_asyncToGenerator2.default)(_regeneratorRuntime.mark((function e(t){var r,s,n,i,a,o;return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_fetch.t)("漫画.搜索章节",{subjectId:_this.subjectId}),_this.setState({searchingUrl:t.url}),r=[],"新新漫画"!==t.tag){e.next=9;break}return e.next=6,(0,_fetch.fetchHTML)({url:t.url});case 6:s=e.sent,n=(0,_html.cheerio)(s),r=(n("ul.chapter > li > a").map((function(e,r){var s=(0,_html.cheerio)(r);return(0,_utils.safeObject)({url:(0,_site.SITE_77MH)()+"/"+s.attr("href"),text:s.text(),tag:t.tag})})).get()||[]).reverse();case 9:if("漫画123"!==t.tag){e.next=15;break}return e.next=12,(0,_fetch.fetchHTML)({url:t.url});case 12:i=e.sent,a=(0,_html.cheerio)(i),r=a("ul.list_block > li > a").map((function(e,r){var s=(0,_html.cheerio)(r);return(0,_utils.safeObject)({url:""+(0,_site.SITE_COMIC123)()+s.attr("href"),text:s.text(),tag:t.tag})})).get()||[];case 15:o=_this.state.eps,_this.setState({eps:Object.assign({},o,(0,_defineProperty2.default)({},t.url,{list:r,_loaded:(0,_utils.getTimestamp)()})),searchingUrl:""});case 17:case"end":return e.stop()}}),e)}))),function(e){return _ref3.apply(this,arguments)})),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"searchImages",function(){var _ref4=(0,_asyncToGenerator2.default)(_regeneratorRuntime.mark((function _callee4(item,title,index){var url,tag,href,getImagesScript,HTML,script,urlScript,_HTML2,mark,_images,_urlScript,_images2,_urlScript2,images;return _regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if((0,_fetch.t)("漫画.搜索图片",{subjectId:_this.subjectId,index}),(0,_ui.info)("获取图片地址中"),url=item.url,tag=item.tag,href="","新新漫画"!==tag){_context4.next=12;break}return getImagesScript=function getImagesScript(script,title){return eval(script),"title='"+title+"';images='"+msg+"'.split('|').map(it=>'https://picsh.77dm.top/h"+img_s+"/'+it)"},_context4.next=8,(0,_fetch.fetchHTML)({url});case 8:HTML=_context4.sent,script=(0,_utils.trim)((0,_html.cheerio)(HTML,!1)("section + script").text()),urlScript=getImagesScript(script,title),href=_constants.HOST_MANGA+"/index.html?script="+encodeURIComponent(urlScript);case 12:if("漫画123"!==tag){_context4.next=17;break}return _context4.next=15,(0,_fetch.fetchHTML)({url});case 15:_HTML2=_context4.sent,_HTML2.includes("images.dmzj.com")?(mark="",_images=JSON.stringify(JSON.parse(_HTML2.match(/var z_img='(.+?)';/)[1]).map((function(e){var t=e.split("/");return mark||(mark=t[4]+"/"+t[5]),t[4]="$",t[5]="$",t.join("/")}))),_urlScript="title='"+title+"';images="+_images+".map(it=>it.replace('$/$', '"+mark+"').replace('https://', '"+(0,_site.SITE_COMIC123)()+"/pic-dmzj/'))",href=_constants.HOST_MANGA+"/index.html?script="+encodeURIComponent(_urlScript)):(_images2=_HTML2.match(/var z_img='(.+?)';/)[1],_urlScript2="title='"+title+"';images=JSON.parse('"+_images2+"').map(it=>'https://img.detatu.com/'+it)",href=_constants.HOST_MANGA+"/index.html?script="+encodeURIComponent(_urlScript2));case 17:return images=_this.state.images,_this.setState({images:Object.assign({},images,(0,_defineProperty2.default)({},url,href))}),_context4.abrupt("return",href);case 20:case"end":return _context4.stop()}}),_callee4)})));return function(e,t,r){return _ref4.apply(this,arguments)}}()),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"searchThenOpen",(_ref5=(0,_asyncToGenerator2.default)(_regeneratorRuntime.mark((function e(t,r,s){var n;return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_this.searchImages(t,r,s);case 3:n=e.sent,(0,_utils.open)(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,_ui.info)("图片地址分析出错");case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(e,t,r){return _ref5.apply(this,arguments)})),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onChange",(function(e){_this.setState({key:e})})),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onSearch",(function(){(0,_fetch.t)("漫画.搜索",{subjectId:_this.subjectId});var e=_this.state.key;_this.searchOrigins(e)})),_this}return(0,_createClass2.default)(ScreenComic,[{key:"subjectId",get:function(){return this.params.subjectId}},{key:"namespace",get:function(){return namespace+"|"+this.subjectId}}]),ScreenComic}(_store2.default),(0,_applyDecoratedDescriptor2.default)(_class.prototype,"subjectId",[_mobx.computed],Object.getOwnPropertyDescriptor(_class.prototype,"subjectId"),_class.prototype),(0,_applyDecoratedDescriptor2.default)(_class.prototype,"namespace",[_mobx.computed],Object.getOwnPropertyDescriptor(_class.prototype,"namespace"),_class.prototype),_class)}}]);