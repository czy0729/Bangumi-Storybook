(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5519],{"./src/screens/discovery/series/component/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Component")},"./src/screens/discovery/series/component/item/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_PROPS=s.COMPONENT_MAIN=s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/component/ds.ts"),n=s.COMPONENT=(0,r.rc)(o.COMPONENT,"Item");s.COMPONENT_MAIN=(0,r.rc)(n),s.DEFAULT_PROPS={styles:{},data:[],subjects:{}}},"./src/screens/discovery/series/component/item/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/utils/decorators/index.ts"),n=r(t("./src/screens/discovery/series/component/item/item.tsx")),c=t("./src/screens/discovery/series/component/item/ds.ts"),u=t("./src/screens/discovery/series/component/item/styles.ts"),a=t("./node_modules/react/jsx-runtime.js");s.default=(0,o.obc)((function(e,s){var t=e.item,r=s.$;if("有关联系列"===r.state.status&&t.length<=1)return null;var o=r.filterData(t);return(0,a.jsx)(n.default,{styles:(0,u.memoStyles)(),data:o,subjects:r.subjects(o)})}),c.COMPONENT)},"./src/screens/discovery/series/component/item/item.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.string.sub.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o=r(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),n=(r(t("react")),r(t("./node_modules/react-native-web/dist/exports/View/index.js"))),c=t("./src/utils/index.ts"),u=t("./src/utils/decorators/index.ts"),a=r(t("./src/screens/discovery/series/component/subject/index.tsx")),d=t("./src/screens/discovery/series/component/item/ds.ts"),i=t("./node_modules/react/jsx-runtime.js");s.default=(0,u.memo)((function(e){var s=e.styles,t=e.data,r=e.subjects;if(!t.length)return null;var u=Math.min.apply(Math,(0,o.default)(t)),d=t.filter((function(e){return e!==u}));return(0,i.jsxs)(n.default,{children:[(0,i.jsx)(a.default,{id:u}),!!d.length&&(0,i.jsx)(n.default,{style:s.sub,children:d.sort((function(e,s){var t,o;return(0,c.asc)((null==(t=r[e])?void 0:t.date)||"9999-99-99",(null==(o=r[s])?void 0:o.date)||"9999-99-99")})).map((function(e){return(0,i.jsx)(a.default,{style:s.subItem,id:e,small:!0},e)}))})]})}),d.DEFAULT_PROPS,d.COMPONENT_MAIN)},"./src/screens/discovery/series/component/item/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.memoStyles=void 0;var r=t("./src/stores/index.ts");s.memoStyles=r._.memoStyles((function(){return{sub:{marginTop:-r._.sm,paddingLeft:r._.wind+r._.sm,paddingBottom:r._.md},subItem:{paddingVertical:r._.md}}}))},"./src/screens/discovery/series/component/list/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"List")},"./src/screens/discovery/series/component/list/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.fixed.js"),t("./node_modules/core-js/modules/es.array.sort.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/screens/_/index.ts"),n=t("./src/stores/index.ts"),c=t("./src/utils/decorators/index.ts"),u=r(t("./src/screens/discovery/series/component/tool-bar/index.tsx")),a=t("./src/screens/discovery/series/component/list/utils.tsx"),d=t("./src/screens/discovery/series/component/list/ds.ts"),i=t("./node_modules/react/jsx-runtime.js");s.default=(0,c.obc)((function(e,s){var t=s.$;return(0,i.jsx)(o.PaginationList,{contentContainerStyle:n._.container.bottom,data:t.data,limit:20,ListHeaderComponent:!t.state.fixed&&(0,i.jsx)(u.default,{}),renderItem:a.renderItem,onPage:t.onPage},t.state.sort)}),d.COMPONENT)},"./src/screens/discovery/series/component/list/utils.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.renderItem=function(e){var s=e.item;return(0,n.jsx)(o.default,{item:s})};r(t("react"));var o=r(t("./src/screens/discovery/series/component/item/index.tsx")),n=t("./node_modules/react/jsx-runtime.js")},"./src/screens/discovery/series/component/subject/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Subject")},"./src/screens/discovery/series/component/subject/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.small.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.array.join.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=r(t("./node_modules/react-native-web/dist/exports/View/index.js")),n=t("./src/components/index.ts"),c=t("./src/components/cover/utils.ts"),u=t("./src/screens/_/index.ts"),a=t("./src/stores/index.ts"),d=t("./src/utils/index.ts"),i=t("./src/utils/decorators/index.ts"),l=t("./src/constants/index.ts"),m=t("./src/screens/discovery/series/component/subject/ds.ts"),f=t("./src/screens/discovery/series/component/subject/styles.ts"),p=t("./node_modules/react/jsx-runtime.js");s.default=(0,i.obc)((function(e,s){var t=e.style,r=e.id,i=e.small,m=void 0!==i&&i,j=s.$,_=s.navigation,v=(0,f.memoStyles)(),y=j.subject(r);if(0===y._loaded)return(0,p.jsx)(n.Flex,{style:v.loading,justify:"center",children:(0,p.jsx)(n.Loading.Raw,{})});var b=j.collection(r),x=[];null!=b&&b.ep?x.push("看到 "+b.ep+" "):b&&x.push("看到 0"),null!=y&&y.eps&&x.push(" "+(null==y?void 0:y.eps)+" 话"),null!=y&&y.total_episodes&&(null==y?void 0:y.total_episodes)!==(null==y?void 0:y.eps)&&x.push("共 "+(null==y?void 0:y.total_episodes)+" 章节");var h=y.platform&&"TV"!==y.platform&&y.platform,S=[!!y.total&&"("+y.total+")",String(y.date).slice(0,7)||"未放送",h].filter((function(e){return!!e})),T=y.name.length,g=T>24?11:T>16?12:T>8?13:14,E=m?.88*l.IMG_WIDTH_SM:l.IMG_WIDTH_SM,O=a.collectionStore.collect(r)||l.MODEL_COLLECTION_STATUS.getLabel(null==b?void 0:b.type)||"",P=(0,p.jsx)(n.Text,{style:a._.mt.xs,size:11,lineHeight:1,bold:!0,numberOfLines:1,shadow:!0,children:x.join(" / ")});return(0,p.jsx)(n.Touchable,{animate:!0,onPress:function(){_.push("Subject",{subjectId:y.id,_cn:y.name,_image:(0,c.getCoverSrc)(y.image,E)})},children:(0,p.jsxs)(n.Flex,{style:(0,d.stl)(v.item,t),align:"start",children:[(0,p.jsx)(u.Cover,{src:y.image,width:E,height:m?.88*l.IMG_HEIGHT_SM:l.IMG_HEIGHT_SM,radius:!0}),(0,p.jsx)(n.Flex.Item,{children:(0,p.jsxs)(n.Flex,{style:m?v.bodySm:v.body,direction:"column",justify:"between",align:"start",children:[(0,p.jsx)(n.Text,{style:a._.mr.sm,size:g,bold:!0,numberOfLines:2,children:y.name}),(0,p.jsx)(o.default,{style:a._.container.block,children:O?(0,p.jsx)(u.Progress,{current:(null==b?void 0:b.ep)||0,total:(null==y?void 0:y.eps)||0,children:P}):P}),(0,p.jsxs)(n.Flex,{style:a._.mt.sm,children:[(0,p.jsx)(u.Rank,{style:a._.mr.xs,value:y.rank}),(0,p.jsx)(u.Stars,{style:a._.mr.xs,value:y.score,simple:!0}),(0,p.jsx)(n.Text,{size:11,type:"sub",children:S.join(" · ")})]})]})}),(0,p.jsx)(u.Manage,{style:v.manage,subjectId:r,collection:O,onPress:function(){a.uiStore.showManageModal({subjectId:r,title:y.name,status:null==b?void 0:b.type},"关联系列")}})]})})}),m.COMPONENT)},"./src/screens/discovery/series/component/subject/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.memoStyles=void 0;var r=t("./src/stores/index.ts"),o=t("./src/constants/index.ts");s.memoStyles=r._.memoStyles((function(){return{loading:{height:120},item:{paddingHorizontal:r._.wind,paddingVertical:20},body:{height:o.IMG_HEIGHT_SM,paddingLeft:r._.md},bodySm:{height:.88*o.IMG_HEIGHT_SM,paddingLeft:r._.md},manage:{marginTop:-2}}}))},"./src/screens/discovery/series/component/tips/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Tips")},"./src/screens/discovery/series/component/tips/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),c=t("./src/screens/discovery/series/component/tips/ds.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.obc)((function(e,s){var t=s.$.state,r=t.fetching,n=t.message,c=t.current,a=t.total;return(0,u.jsx)(o.Progress,{show:r,message:n,current:c,total:a})}),c.COMPONENT)},"./src/screens/discovery/series/component/tool-bar/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/component/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"ToolBar")},"./src/screens/discovery/series/component/tool-bar/filter.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.filter.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),c=t("./src/screens/discovery/series/ds.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.obc)((function(e,s){var t=s.$,r=t.state.filter;return(0,u.jsx)(o.ToolBar.Popover,{data:c.DATA_FILTER,text:r||"类型",type:r?"desc":void 0,onSelect:t.onFilterSelect})}))},"./src/screens/discovery/series/component/tool-bar/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),c=r(t("./src/screens/discovery/series/component/tool-bar/filter.tsx")),u=r(t("./src/screens/discovery/series/component/tool-bar/more.tsx")),a=r(t("./src/screens/discovery/series/component/tool-bar/sort.tsx")),d=r(t("./src/screens/discovery/series/component/tool-bar/status.tsx")),i=r(t("./src/screens/discovery/series/component/tool-bar/year.tsx")),l=t("./src/screens/discovery/series/component/tool-bar/ds.ts"),m=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.ob)((function(){return(0,m.jsxs)(o.ToolBar,{children:[(0,m.jsx)(a.default,{}),(0,m.jsx)(i.default,{}),(0,m.jsx)(c.default,{}),(0,m.jsx)(d.default,{}),(0,m.jsx)(u.default,{})]})}),l.COMPONENT)},"./src/screens/discovery/series/component/tool-bar/more.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.fixed.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/stores/index.ts"),c=t("./src/utils/decorators/index.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,c.obc)((function(e,s){var t=s.$,r=t.state.fixed;return(0,u.jsx)(o.ToolBar.Popover,{data:["筛选（"+(r?"固定":"浮动")+"）"],icon:"md-more-vert",iconColor:n._.colorDesc,iconSize:16,type:"desc",transparent:!0,onSelect:function(e){if(e.includes("筛选"))return t.onToggleFixed()}})}))},"./src/screens/discovery/series/component/tool-bar/sort.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.sort.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/stores/index.ts"),c=t("./src/utils/decorators/index.ts"),u=t("./src/screens/discovery/series/ds.ts"),a=t("./node_modules/react/jsx-runtime.js");s.default=(0,c.obc)((function(e,s){var t=s.$,r=t.state.sort;return(0,a.jsx)(o.ToolBar.Popover,{data:u.DATA_SORT,icon:"md-sort",iconColor:r?n._.colorDesc:n._.colorSub,text:r||"排序",type:r?"desc":void 0,onSelect:t.onSortSelect})}))},"./src/screens/discovery/series/component/tool-bar/status.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),c=t("./src/screens/discovery/series/ds.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.obc)((function(e,s){var t=s.$,r=t.state.status;return(0,u.jsx)(o.ToolBar.Popover,{data:c.DATA_STATUS,text:r||"状态",type:r?"desc":void 0,onSelect:t.onStatusSelect})}))},"./src/screens/discovery/series/component/tool-bar/year.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),c=t("./src/constants/index.ts"),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.obc)((function(e,s){var t=s.$,r=t.state.airtime;return(0,u.jsx)(o.ToolBar.Popover,{data:c.DATA_AIRTIME,text:r||"年",type:r?"desc":void 0,onSelect:t.onAirtimeSelect})}))},"./src/screens/discovery/series/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),t("./node_modules/core-js/modules/es.array.map.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.SUBJECT_TYPE=s.SUBJECT_ITEM=s.STATE=s.RELATIONS=s.NAMESPACE=s.LIMIT=s.HOST_API_V0=s.EXCLUDE_STATE=s.DISTANCE=s.DATA_STATUS=s.DATA_SORT=s.DATA_FILTER=s.COMPONENT=void 0;var r=t("./src/constants/index.ts"),o=s.COMPONENT="Series",n=(s.NAMESPACE="Screen"+o,s.EXCLUDE_STATE={fetching:!1,message:"",current:0,total:0});s.STATE=Object.assign({collections:[],otherCollections:[],relations:{},subjects:{},data:[],sort:"",filter:"",airtime:"",status:"",fixed:!0},n,{_loaded:!1}),s.DATA_SORT=["默认","关联数","新放送","评分"],s.DATA_FILTER=r.RANK_ANIME_FILTER.map((function(e){return e.label})),s.DATA_STATUS=["全部","有关联系列","未收藏","看过","在看","未看完"],s.HOST_API_V0="https://api.bgm.tv/v0",s.RELATIONS=["前传","续集","番外篇","主线故事","相同世界观","不同世界观"],s.SUBJECT_TYPE=2,s.SUBJECT_ITEM={id:0,name:"",name_cn:"",image:"",date:"",total_episodes:0,platform:"",rank:0,score:0,total:0,_loaded:0},s.LIMIT=100,s.DISTANCE=86400},"./src/screens/discovery/series/header/ds.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.COMPONENT=void 0;var r=t("./src/utils/dev/index.ts"),o=t("./src/screens/discovery/series/ds.ts");s.COMPONENT=(0,r.rc)(o.COMPONENT,"Header")},"./src/screens/discovery/series/header/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/screens/_/index.ts"),c=t("./src/stores/index.ts"),u=t("./src/utils/index.ts"),a=t("./src/utils/decorators/index.ts"),d=t("./src/screens/discovery/series/header/ds.ts"),i=t("./node_modules/react/jsx-runtime.js");s.default=(0,a.obc)((function(e,s){var t=s.$,r=s.navigation;return(0,i.jsx)(o.Header,{title:"关联系列",hm:["series","Series"],headerRight:function(){return(0,i.jsxs)(o.Flex,{children:[(0,i.jsx)(n.IconTouchable,{style:c._.mr.xs,name:"md-refresh",color:c._.colorDesc,onPress:function(){(0,u.confirm)("刷新涉及大量请求与计算，若非必要请勿重复刷新，确定?",t.fetchSeries)}}),(0,i.jsx)(n.IconTouchable,{name:"md-info-outline",color:c._.colorDesc,size:19,onPress:function(){r.push("Information",{title:"关联系列",message:["目的为查漏补缺，便捷查找是否存在未收藏的关联番剧。","使用了你「在看」和「看过」的收藏数据，通过关联条目计算出结果。","为了控制请求数，所以并没有一次性循环请求关联到底。","举例说当一部有四季的番剧，你只收藏过第一季，那就最多只能索引到第三季，所以你收藏的条目越多，关联范围越广。","为什么排序不符合预期? 因可能关联到上千个条目，条目的上映日期和评分需要请求，当条目项看见才会请求，所以请至少手动滚动到底一次，条目信息才会补全。","为了防止滥用，目前此功能非高级会员仅会对「在看」和「看过」的前 100 条数据进行关联计算，高级会员支持 500 条。"],advance:!0})}})]})}})}),d.COMPONENT)},"./src/screens/discovery/series/index.tsx":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.fixed.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),c=t("./src/utils/hooks/index.ts"),u=r(t("./src/screens/discovery/series/component/list/index.tsx")),a=r(t("./src/screens/discovery/series/component/tips/index.tsx")),d=r(t("./src/screens/discovery/series/component/tool-bar/index.tsx")),i=r(t("./src/screens/discovery/series/header/index.tsx")),l=r(t("./src/screens/discovery/series/store.ts")),m=t("./node_modules/react/jsx-runtime.js");s.default=(0,n.ic)(l.default,(function(e,s){var t=s.$;return(0,c.useRunAfter)((function(){t.init()})),(0,c.useObserver)((function(){return(0,m.jsxs)(o.Component,{id:"screen-series",children:[(0,m.jsx)(i.default,{}),(0,m.jsxs)(o.Page,{loaded:t.state._loaded,children:[t.state.fixed&&(0,m.jsx)(d.default,{}),(0,m.jsx)(u.default,{}),(0,m.jsx)(a.default,{})]})]})}))}))},"./src/screens/discovery/series/store.ts":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.object.assign.js"),t("./node_modules/core-js/modules/web.timers.js"),t("./node_modules/core-js/modules/es.array.is-array.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js"),t("./node_modules/core-js/modules/es.object.keys.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.array.from.js"),t("./node_modules/core-js/modules/es.string.iterator.js"),t("./node_modules/core-js/modules/es.set.js"),t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.array.iterator.js"),t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),t("./node_modules/core-js/modules/es.string.fixed.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n,c=o(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),u=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),a=o(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),d=o(t("./node_modules/@babel/runtime/helpers/createClass.js")),i=o(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),l=o(t("./node_modules/@babel/runtime/helpers/inherits.js")),m=o(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),f=o(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=o(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),j=o(t("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),_=t("./node_modules/mobx/dist/mobx.esm.js"),v=t("./src/stores/index.ts"),y=t("./src/utils/index.ts"),b=t("./src/utils/fetch/index.ts"),x=t("./src/utils/fetch.v0/index.ts"),h=o(t("./src/utils/store/index.ts")),S=o(t("./src/constants/i18n/index.ts")),T=t("./src/screens/discovery/series/ds.ts");function g(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,f.default)(e);if(s){var o=(0,f.default)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,m.default)(this,t)}}var E={},O={};s.default=(n=function(e){(0,l.default)(t,e);var s=g(t);function t(){var e;(0,a.default)(this,t);for(var o=arguments.length,n=new Array(o),d=0;d<o;d++)n[d]=arguments[d];return e=s.call.apply(s,[this].concat(n)),(0,p.default)((0,i.default)(e),"state",(0,_.observable)(T.STATE)),(0,p.default)((0,i.default)(e),"init",(0,u.default)(r.mark((function s(){return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.t0=e,s.t1=Object,s.t2={},s.next=5,e.getStorage(T.NAMESPACE);case 5:s.t3=s.sent,s.t4=T.EXCLUDE_STATE,s.t5={_loaded:(0,y.getTimestamp)()},s.t6=s.t1.assign.call(s.t1,s.t2,s.t3,s.t4,s.t5),s.t0.setState.call(s.t0,s.t6),e.state.data.length?e.calculateData():e.fetchSeries();case 11:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchSeries",(0,u.default)(r.mark((function s(){return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(!e.state.fetching){s.next=2;break}return s.abrupt("return",!1);case 2:return O={},s.next=5,e.fetchCollections();case 5:return s.next=7,e.fetchRelations();case 7:e.calculateData(),setTimeout((0,u.default)(r.mark((function s(){return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.fetchSubRelations();case 2:e.calculateData(),e.fetchSomeSubjects(),setTimeout((function(){e.fetchOtherCollections()}),4e3);case 5:case"end":return s.stop()}}),s)}))),1600);case 9:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchCollections",(0,u.default)(r.mark((function s(){var t,o,n,u,a,d,i,l,m;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(e.userId){s.next=3;break}return(0,y.info)("此功能依赖收藏数据，请先"+S.default.login(),4),s.abrupt("return",!1);case 3:return e.setState({fetching:!0,message:"获取用户收藏",current:1,total:2}),u=[],s.next=7,(0,x.request)(T.HOST_API_V0+"/users/"+e.userId+"/collections?subject_type="+T.SUBJECT_TYPE+"&type=2&limit="+T.LIMIT);case 7:if(a=s.sent,!Array.isArray(null==(t=a)?void 0:t.data)){s.next=21;break}if(u.push.apply(u,(0,c.default)(null==(d=a)?void 0:d.data)),!v.systemStore.advance){s.next=21;break}if(!((null==(i=a)?void 0:i.total)>100)){s.next=21;break}l=2;case 13:if(!(l<=Math.min(Math.ceil(a.total/T.LIMIT),5))){s.next=21;break}return s.next=16,(0,x.request)(T.HOST_API_V0+"/users/"+e.userId+"/collections?subject_type="+T.SUBJECT_TYPE+"&type=2&offset="+(l-1)*T.LIMIT+"&limit="+T.LIMIT);case 16:a=s.sent,u.push.apply(u,(0,c.default)(null==(m=a)?void 0:m.data));case 18:l+=1,s.next=13;break;case 21:return e.setState({current:2}),s.next=24,(0,x.request)(T.HOST_API_V0+"/users/"+e.userId+"/collections?subject_type="+T.SUBJECT_TYPE+"&type=3&limit="+T.LIMIT);case 24:if(a=s.sent,Array.isArray(null==(o=a)?void 0:o.data)&&u.push.apply(u,(0,c.default)(null==(n=a)?void 0:n.data)),u.length){s.next=28;break}return s.abrupt("return",!1);case 28:return e.setState({collections:u.slice().sort((function(e,s){return(0,y.desc)(e.updated_at,s.updated_at)})).map((function(e){return{id:e.subject_id,type:e.type,ep:e.ep_status,updated_at:e.updated_at}}))}),e.setState(Object.assign({},T.EXCLUDE_STATE)),e.setStorage(T.NAMESPACE),s.abrupt("return",!0);case 32:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchOtherCollections",(0,u.default)(r.mark((function s(){var t,o,n,u,a,d,i,l;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i=[],s.next=3,(0,x.request)(T.HOST_API_V0+"/users/"+e.userId+"/collections?subject_type="+T.SUBJECT_TYPE+"&type=1&limit="+T.LIMIT);case 3:return l=s.sent,Array.isArray(null==(t=l)?void 0:t.data)&&i.push.apply(i,(0,c.default)(null==(o=l)?void 0:o.data)),s.next=7,(0,x.request)(T.HOST_API_V0+"/users/"+e.userId+"/collections?subject_type="+T.SUBJECT_TYPE+"&type=4&limit="+T.LIMIT);case 7:return l=s.sent,Array.isArray(null==(n=l)?void 0:n.data)&&i.push.apply(i,(0,c.default)(null==(u=l)?void 0:u.data)),s.next=11,(0,x.request)(T.HOST_API_V0+"/users/"+e.userId+"/collections?subject_type="+T.SUBJECT_TYPE+"&type=5&limit="+T.LIMIT);case 11:if(l=s.sent,Array.isArray(null==(a=l)?void 0:a.data)&&i.push.apply(i,(0,c.default)(null==(d=l)?void 0:d.data)),i.length){s.next=15;break}return s.abrupt("return",!1);case 15:e.setState({otherCollections:i.slice().sort((function(e,s){return(0,y.desc)(e.updated_at,s.updated_at)})).map((function(e){return{id:e.subject_id,type:e.type,ep:e.ep_status,updated_at:e.updated_at}}))}),e.setStorage(T.NAMESPACE);case 17:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchRelations",(0,u.default)(r.mark((function s(){var t,o;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t={},o=[],e.subjectIds.forEach((function(e){o.push((0,u.default)(r.mark((function s(){var o;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,x.request)(T.HOST_API_V0+"/subjects/"+e+"/subjects");case 2:if(o=s.sent,Array.isArray(o)){s.next=6;break}return t[e]=[],s.abrupt("return",!1);case 6:return t[e]=o.filter((function(e){return T.SUBJECT_TYPE===e.type&&T.RELATIONS.includes(e.relation)})).sort((function(e,s){return(0,y.asc)(e.id,s.id)})).map((function(e){return e.id})),s.abrupt("return",!0);case 8:case"end":return s.stop()}}),s)}))))})),s.next=5,(0,b.queue)(o.map((function(s){return(0,u.default)(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s();case 2:return e.setState({fetching:!0,message:"获取条目关系",current:e.state.current+1,total:o.length}),t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})))})),2);case 5:return e.clearState("relations",t),e.setStorage(T.NAMESPACE),s.abrupt("return",!0);case 8:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchSubRelations",(0,u.default)(r.mark((function s(){var t,o;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=Object.assign({},e.state.relations),o=[],Object.keys(t).forEach((function(e){t[e].forEach((function(e){t[e]||o.push((0,u.default)(r.mark((function s(){var o;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,x.request)(T.HOST_API_V0+"/subjects/"+e.id+"/subjects");case 2:if(o=s.sent,Array.isArray(o)){s.next=6;break}return t[e]=[],s.abrupt("return",!1);case 6:return t[e]=o.filter((function(e){return T.SUBJECT_TYPE===e.type&&T.RELATIONS.includes(e.relation)})).sort((function(e,s){return(0,y.asc)(e.id,s.id)})).map((function(e){return e.id})),s.abrupt("return",!0);case 8:case"end":return s.stop()}}),s)}))))}))})),e.setState({fetching:!0,message:"获取二级条目关系",current:0,total:o.length}),s.next=6,(0,b.queue)(o.map((function(s){return(0,u.default)(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s();case 2:return e.setState({fetching:!0,message:"获取二级条目关系",current:e.state.current+1,total:o.length}),t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})))})),2);case 6:return e.setState({relations:t}),setTimeout((function(){e.setState(Object.assign({},T.EXCLUDE_STATE))}),1600),e.setStorage(T.NAMESPACE),s.abrupt("return",!0);case 10:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchSubjects",(0,u.default)(r.mark((function s(){var t,o,n,c=arguments;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if((t=c.length>0&&void 0!==c[0]?c[0]:[]).length){s.next=3;break}return s.abrupt("return",!1);case 3:return o=(0,y.getTimestamp)(),n=[],t.forEach((function(s){if(E[s])return!0;var t=e.subject(s);if(t._loaded&&o-t._loaded<=T.DISTANCE)return!0;E[s]=!0,n.push((0,u.default)(r.mark((function t(){var o,n,c,u,a;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,x.request)(T.HOST_API_V0+"/subjects/"+s);case 2:if(null!=(a=t.sent)&&a.id){t.next=5;break}return t.abrupt("return",!1);case 5:e.setState({subjects:(0,p.default)({},s,{id:s,name:(0,y.cnjp)(a.name_cn,a.name),image:(null==a||null==(o=a.images)?void 0:o.common)||"",date:a.date,eps:a.eps,total_episodes:a.total_episodes,platform:a.platform,rank:null==(n=a.rating)?void 0:n.rank,score:null==(c=a.rating)?void 0:c.score,total:null==(u=a.rating)?void 0:u.total,_loaded:(0,y.getTimestamp)()})});case 6:case"end":return t.stop()}}),t)}))))})),s.next=8,(0,b.queue)(n,2);case 8:return e.setStorage(T.NAMESPACE),s.abrupt("return",!0);case 10:case"end":return s.stop()}}),s)})))),(0,p.default)((0,i.default)(e),"fetchSomeSubjects",(function(){var s=e.state.data,t=[];s.forEach((function(e){Array.isArray((0,_.toJS)(e))?t.push.apply(t,(0,c.default)(e)):t.push(e)})),t.length=200,e.fetchSubjects(t)})),(0,p.default)((0,i.default)(e),"calculateData",(function(){var s=e.state.relations,t=[];Object.keys(s).sort((function(e,s){return(0,y.desc)(e,s)})).forEach((function(e){var r,o=[Number(e)].concat((0,c.default)(s[e])),n=o.find((function(e){return e in O}));n?(r=t[O[n]]).push.apply(r,(0,c.default)(o)):(t.push(o),o.forEach((function(e){O[e]=t.length-1})))})),e.setState({data:t.map((function(e){return Array.from(new Set(e)).sort((function(e,s){return(0,y.asc)(e,s)}))})),_loaded:(0,y.getTimestamp)()})})),(0,p.default)((0,i.default)(e),"onPage",(function(){var s=[];(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){Array.isArray((0,_.toJS)(e))?s.push.apply(s,(0,c.default)(e)):s.push(e)})),e.fetchSubjects(s)})),(0,p.default)((0,i.default)(e),"onToggleFixed",(function(){var s=e.state.fixed;e.setState({fixed:!s}),e.setStorage(T.NAMESPACE)})),(0,p.default)((0,i.default)(e),"onSortSelect",(function(s){"默认"!==s?(e.setState({sort:s}),e.setStorage(T.NAMESPACE)):e.setState({sort:""})})),(0,p.default)((0,i.default)(e),"onFilterSelect",(function(s){"全部"!==s?(e.setState({filter:s}),e.setStorage(T.NAMESPACE)):e.setState({filter:""})})),(0,p.default)((0,i.default)(e),"onAirtimeSelect",(function(s){"全部"!==s?(e.setState({airtime:s}),e.setStorage(T.NAMESPACE)):e.setState({airtime:""})})),(0,p.default)((0,i.default)(e),"onStatusSelect",(function(s){"全部"!==s?(e.setState({status:s}),e.setStorage(T.NAMESPACE)):e.setState({status:""})})),e}return(0,d.default)(t,[{key:"userId",get:function(){return v.userStore.usersInfo(v.userStore.myUserId).username||v.userStore.myUserId}},{key:"subjectIds",get:function(){return this.state.collections.map((function(e){return e.id}))}},{key:"collection",value:function(e){var s=this;return(0,_.computed)((function(){return s.state.collections.find((function(s){return s.id===e}))||s.state.otherCollections.find((function(s){return s.id===e}))})).get()}},{key:"collections",value:function(e){var s=this;return(0,_.computed)((function(){var t={};return e.forEach((function(e){var r=s.collection(e);r&&(t[e]=r)})),t})).get()}},{key:"subject",value:function(e){var s=this;return(0,_.computed)((function(){return s.state.subjects[e]||T.SUBJECT_ITEM})).get()}},{key:"subjects",value:function(e){var s=this;return(0,_.computed)((function(){var t={};return e.forEach((function(e){t[e]=s.subject(e)})),t})).get()}},{key:"filterData",value:function(e){var s=this;return(0,_.computed)((function(){var t=s.state.filter,r=e;t&&(r=r.filter((function(e){var r=s.subject(e);return(null==r?void 0:r.platform)&&String(r.platform).includes(t)})));var o=s.state.airtime;o&&(r=r.filter((function(e){var t=s.subject(e);return(null==t?void 0:t.date)&&String(t.date).includes(o+"-")})));var n=s.state.status;return"未收藏"===n?r=r.filter((function(e){return!s.collection(e)})):"看过"===n?r=r.filter((function(e){var t;return 2===(null==(t=s.collection(e))?void 0:t.type)})):"在看"===n?r=r.filter((function(e){var t;return 3===(null==(t=s.collection(e))?void 0:t.type)})):"未看完"===n&&(r=r.filter((function(e){var t=s.collection(e),r=s.subject(e);return(null==t?void 0:t.ep)&&(null==r?void 0:r.eps)&&(null==t?void 0:t.ep)!==(null==r?void 0:r.eps)}))),r})).get()}},{key:"data",get:function(){var e=this,s=this.state,t=s.data,r=s.sort;return"关联数"===r?t.slice().sort((function(e,s){return(0,y.desc)(e.length,s.length)})):"新放送"===r?t.slice().sort((function(s,t){var r=Math.max.apply(Math,(0,c.default)(s.map((function(s){return Number((e.subject(s).date||"0000-00-00").replace(/-/g,""))})))),o=Math.max.apply(Math,(0,c.default)(t.map((function(s){return Number((e.subject(s).date||"0000-00-00").replace(/-/g,""))}))));return(0,y.desc)(r,o)})):"评分"===r?t.slice().sort((function(s,t){var r=Math.min.apply(Math,(0,c.default)(s.map((function(s){return e.subject(s).rank||9999})))),o=Math.min.apply(Math,(0,c.default)(t.map((function(s){return e.subject(s).rank||9999}))));return(0,y.asc)(r,o)})):t}},{key:"info",get:function(){var e=0;return this.data.forEach((function(s){return e+=s.length})),{series:this.data.length,total:e}}}]),t}(h.default),(0,j.default)(n.prototype,"userId",[_.computed],Object.getOwnPropertyDescriptor(n.prototype,"userId"),n.prototype),(0,j.default)(n.prototype,"subjectIds",[_.computed],Object.getOwnPropertyDescriptor(n.prototype,"subjectIds"),n.prototype),(0,j.default)(n.prototype,"data",[_.computed],Object.getOwnPropertyDescriptor(n.prototype,"data"),n.prototype),(0,j.default)(n.prototype,"info",[_.computed],Object.getOwnPropertyDescriptor(n.prototype,"info"),n.prototype),n)},"./node_modules/core-js/modules/es.string.small.js":(e,s,t)=>{"use strict";var r=t("./node_modules/core-js/internals/export.js"),o=t("./node_modules/core-js/internals/create-html.js");r({target:"String",proto:!0,forced:t("./node_modules/core-js/internals/string-html-forced.js")("small")},{small:function(){return o(this,"small","","")}})}}]);