(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3405],{"./src/screens/home/preview/component/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT=void 0;var s=t("./src/utils/dev/index.ts"),o=t("./src/screens/home/preview/ds.ts");r.COMPONENT=(0,s.rc)(o.COMPONENT,"Component")},"./src/screens/home/preview/component/list/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT=void 0;var s=t("./src/utils/dev/index.ts"),o=t("./src/screens/home/preview/component/ds.ts");r.COMPONENT=(0,s.rc)(o.COMPONENT,"List")},"./src/screens/home/preview/component/list/index.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.string.split.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.object.assign.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=s(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),n=(s(t("./node_modules/react/index.js")),s(t("./node_modules/react-native-web/dist/exports/View/index.js"))),d=t("./src/components/index.ts"),i=t("./src/stores/index.ts"),a=t("./src/utils/index.ts"),u=t("./src/utils/decorators/index.ts"),c=t("./src/screens/home/preview/component/list/ds.ts"),l=t("./src/screens/home/preview/component/list/styles.tsx"),m=t("./node_modules/react/jsx-runtime.js");r.default=(0,u.obc)((function(e,r){var t=r.$,s=(0,l.memoStyles)(),u=t.state,c=u.epsThumbs,p=u.epsThumbsHeader,f=t.params,h=f.data,j=void 0===h?[]:h,v=f.headers,b=void 0===v?{}:v,_=c.length?c:j,x=c.length?p:b,y={};return null!=x&&x.Referer&&x.Referer.includes("douban")?(j.length&&j[0].includes("douban")&&(_=(0,o.default)(j)),c.forEach((function(e){_.includes(e)||_.push(e)})),y.autoSize=s.item.width,y.fallback=!0):(y.width=s.item.width,y.height=.56*s.item.width,y.fallback=!0),(0,m.jsx)(d.ScrollView,{contentContainerStyle:i._.container.bottom,scrollToTop:!0,children:_.map((function(e,r){return(0,m.jsx)(n.default,{style:s.item,children:(0,m.jsx)(d.Touchable,{withoutFeedback:!0,onPress:function(){(0,a.showImageViewer)(_.map((function(e){return{url:e.split("@")[0],headers:b}})),r)},children:(0,m.jsx)(d.Image,Object.assign({src:e},y,{shadow:!0,headers:b,errorToHide:!0}))})},e)}))})}),c.COMPONENT);try{list.displayName="list",list.__docgenInfo={description:"",displayName:"list",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/home/preview/component/list/index.tsx#list"]={docgenInfo:list.__docgenInfo,name:"list",path:"src/screens/home/preview/component/list/index.tsx#list"})}catch(e){}},"./src/screens/home/preview/component/list/styles.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.memoStyles=void 0;var s=t("./src/stores/index.ts");r.memoStyles=s._.memoStyles((function(){return{item:{width:s._.window.width-(2*s._.wind-s._._wind),marginLeft:s._.sm,marginBottom:s._.md}}}))},"./src/screens/home/preview/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.STATE=r.NAMESPACE=r.COMPONENT=void 0;var s=r.COMPONENT="Preview";r.NAMESPACE="Screen"+s,r.STATE={epsThumbs:[],epsThumbsHeader:{},_loaded:!1}},"./src/screens/home/preview/header/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT=void 0;var s=t("./src/utils/dev/index.ts"),o=t("./src/screens/home/preview/ds.ts");r.COMPONENT=(0,s.rc)(o.COMPONENT,"Header")},"./src/screens/home/preview/header/index.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;s(t("./node_modules/react/index.js"));var o=t("./src/components/index.ts"),n=t("./src/utils/index.ts"),d=t("./src/utils/decorators/index.ts"),i=t("./src/screens/home/preview/header/ds.ts"),a=t("./src/screens/home/preview/header/styles.ts"),u=t("./node_modules/react/jsx-runtime.js");r.default=(0,d.obc)((function(e,r){var t,s,d=r.$,i=(0,n.cnjp)(null==(t=d.params)?void 0:t.cn,null==(s=d.params)?void 0:s.jp);return(0,u.jsx)(o.Header,{headerTitleStyle:a.styles.title,title:i?i+"的预览":"预览",alias:"预览",hm:[d.url,"Preview"]})}),i.COMPONENT);try{header.displayName="header",header.__docgenInfo={description:"",displayName:"header",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/home/preview/header/index.tsx#header"]={docgenInfo:header.__docgenInfo,name:"header",path:"src/screens/home/preview/header/index.tsx#header"})}catch(e){}},"./src/screens/home/preview/header/styles.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.styles=void 0;var s=t("./src/stores/index.ts");r.styles=s._.create({title:{paddingLeft:s._.sm,paddingRight:s._.md}})},"./src/screens/home/preview/index.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;s(t("./node_modules/react/index.js"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),d=t("./src/utils/hooks/index.ts"),i=s(t("./src/screens/home/preview/component/list/index.tsx")),a=s(t("./src/screens/home/preview/header/index.tsx")),u=s(t("./src/screens/home/preview/store.ts")),c=t("./node_modules/react/jsx-runtime.js");r.default=(0,n.ic)(u.default,(function(e,r){var t=r.$;return(0,d.useRunAfter)((function(){t.init()})),(0,d.useObserver)((function(){return(0,c.jsxs)(o.Component,{id:"screen-preview",children:[(0,c.jsx)(a.default,{}),(0,c.jsx)(o.Page,{loaded:t.state._loaded,children:(0,c.jsx)(i.default,{})})]})}))}));try{preview.displayName="preview",preview.__docgenInfo={description:"",displayName:"preview",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}},route:{defaultValue:null,description:"",name:"route",required:!1,type:{name:"{ params?: any; name?: any; }"}},onMounted:{defaultValue:null,description:"Storybook",name:"onMounted",required:!1,type:{name:"Fn"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/home/preview/index.tsx#preview"]={docgenInfo:preview.__docgenInfo,name:"preview",path:"src/screens/home/preview/index.tsx#preview"})}catch(e){}},"./src/screens/home/preview/store.ts":(e,r,t)=>{var s=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.object.assign.js"),t("./node_modules/core-js/modules/es.string.search.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.reverse.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,d=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),i=o(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=o(t("./node_modules/@babel/runtime/helpers/createClass.js")),u=o(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),c=o(t("./node_modules/@babel/runtime/helpers/inherits.js")),l=o(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),m=o(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=o(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=o(t("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),h=t("./node_modules/mobx/dist/mobx.esm.js"),j=t("./src/utils/douban/index.ts"),v=o(t("./src/utils/store/index.ts")),b=t("./src/constants/index.ts"),_=t("./src/screens/home/preview/ds.ts");function x(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,s=(0,m.default)(e);if(r){var o=(0,m.default)(this).constructor;t=Reflect.construct(s,arguments,o)}else t=s.apply(this,arguments);return(0,l.default)(this,t)}}r.default=(n=function(e){(0,c.default)(t,e);var r=x(t);function t(){var e;(0,i.default)(this,t);for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),(0,p.default)((0,u.default)(e),"params",void 0),(0,p.default)((0,u.default)(e),"state",(0,h.observable)(_.STATE)),(0,p.default)((0,u.default)(e),"init",(0,d.default)(s.mark((function r(){return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=e,r.t1=Object,r.t2={},r.next=5,e.getStorage(e.namespace);case 5:r.t3=r.sent,r.t4={_loaded:!0},r.t5=r.t1.assign.call(r.t1,r.t2,r.t3,r.t4),r.t0.setState.call(r.t0,r.t5),e.state.epsThumbs.length||e.fetchMovieFromDouban();case 10:case"end":return r.stop()}}),r)})))),(0,p.default)((0,u.default)(e),"fetchMovieFromDouban",(0,d.default)(s.mark((function r(){var t,o,n,d,i,a,u;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.params,o=t.cn,n=t.jp,!(d=o||n)){r.next=11;break}return r.next=5,(0,j.search)(d);case 5:return i=r.sent,a=(0,j.matchMovie)(d,i,n),r.next=9,(0,j.getPreview)(a,void 0,40);case 9:(u=r.sent).data.length&&(e.setState({epsThumbs:u.data.slice().reverse(),epsThumbsHeader:{Referer:u.referer}}),e.setStorage(e.namespace));case 11:case"end":return r.stop()}}),r)})))),e}return(0,a.default)(t,[{key:"subjectId",get:function(){return this.params.subjectId}},{key:"namespace",get:function(){return _.NAMESPACE+"|"+this.subjectId}},{key:"url",get:function(){return b.HOST+"/preview/"+this.subjectId}}]),t}(v.default),(0,f.default)(n.prototype,"subjectId",[h.computed],Object.getOwnPropertyDescriptor(n.prototype,"subjectId"),n.prototype),(0,f.default)(n.prototype,"namespace",[h.computed],Object.getOwnPropertyDescriptor(n.prototype,"namespace"),n.prototype),(0,f.default)(n.prototype,"url",[h.computed],Object.getOwnPropertyDescriptor(n.prototype,"url"),n.prototype),n)},"./src/utils/douban/index.ts":(e,r,t)=>{var s=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.search.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.string.trim.js"),t("./node_modules/core-js/modules/es.string.match.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.string.split.js"),t("./node_modules/core-js/modules/es.number.constructor.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.getPreview=function(e,r){return v.apply(this,arguments)},r.getTrailer=function(e){return b.apply(this,arguments)},r.getVideo=function(e,r){return _.apply(this,arguments)},r.matchGame=function(e,r){var t=x(e),s=!1;return r.forEach((function(e){s||(0,d.similar)(e.title,t)<.7&&!e.title.includes(t)||(s=e.id)})),r.forEach((function(e){s||e.desc.includes(t)&&(s=e.id)})),s},r.matchMovie=function(e,r,t,s){var o=x(e),n=!1;return r.forEach((function(e){e.name&&e.name===t&&(n=e.id)})),r.forEach((function(r){if(!n){if((0,d.similar)(r.title,o)<.7){if(!r.desc.includes("原名:"))return;if(s&&r.year&&s!=r.year)return;var i=r.desc.split(" / ")[0].replace("原名:","");if((0,d.similar)(i,t||e)<.7)return}n=r.id}})),n},r.search=function(e,r){return j.apply(this,arguments)};var n=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),d=t("./src/utils/utils/index.ts"),i=t("./src/utils/fetch/index.ts"),a=t("./src/utils/html/index.ts"),u="https://www.douban.com",c="https://movie.douban.com",l=function(e,r){return u+"/search?cat="+("game"===r?3114:1002)+"&q="+e},m=function(e){return c+"/subject/"+e},p=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"o",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return"game"===r?"https://www.douban.com/game/"+e+"/photos/?type=1&start=0&sortby=hot":m(e)+"/photos?type=S&start="+s+"&sortby=time&size=a&subtype="+t},f=function(e){return u+"/"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"subject")+"/"+e+"/videos"},h=function(e){return c+"/subject/"+e+"/trailer"};function j(){return(j=(0,n.default)(s.mark((function e(r,t){var o,n,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.xhrCustom)({url:l(r,t)});case 2:return o=e.sent,n=o._response,u=(0,a.cheerio)(n),e.prev=5,e.abrupt("return",(u(".result .content").map((function(e,r){var t,s,o,n=(0,a.cheerio)(r),d=n.find("h3 a"),i=x(n.find(".subject-cast").text().trim())||"";return{id:null==(t=d.attr("onclick").match(/sid: (\d+)/))?void 0:t[1],title:x(d.text().trim()),name:(null==(s=i.match(/原名:(.*?)\//))?void 0:s[1])||"",desc:x(n.find("p").text().trim()),year:(null==(o=i.match(/(\d{4})$/))?void 0:o[1])||""}})).get()||[]).filter((function(e){return e.id})).sort((function(e,t){return(0,d.desc)((0,d.similar)(r,e.title),(0,d.similar)(r,t.title))})));case 9:return e.prev=9,e.t0=e.catch(5),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[5,9]])})))).apply(this,arguments)}function v(){return v=(0,n.default)(s.mark((function e(r,t){var o,n,d,u,c,l,f,h,j,v,b,_,x=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=x.length>2&&void 0!==x[2]?x[2]:12,r){e.next=3;break}return e.abrupt("return",{data:[],referer:""});case 3:return n="game"===t,e.next=6,(0,i.xhrCustom)({url:p(r,t,n?void 0:"o")});case 6:if(u=e.sent,d=u._response,!n){e.next=11;break}e.next=26;break;case 11:if(c=(0,a.cheerio)(d)(".cover img"),!((l=c.length)>0&&l<12||0===l)){e.next=17;break}return e.next=15,(0,i.xhrCustom)({url:p(r,t,"a")});case 15:f=e.sent,d=f._response;case 17:if(0===l){e.next=26;break}if(h=d.match(/<span class="count">\(共(\d+)张\)<\/span>/),j=h?Number(h[1]):0,!(v=j>=100?j-50:j>=30?j-30:0)){e.next=26;break}return e.next=24,(0,i.xhrCustom)({url:p(r,t,"a",v)});case 24:b=e.sent,d=b._response;case 26:return _=(0,a.cheerio)(d),e.abrupt("return",{data:(_(n?".pholist img":".cover img").map((function(e,r){var t=(0,a.cheerio)(r).attr("src").replace("http://","https://");return n&&(t=t.replace("/photo/thumb/","/photo/photo/")),t})).get()||[]).filter((function(e,r){return r<o})),referer:m(r)});case 28:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function b(){return b=(0,n.default)(s.mark((function e(r){var t,o,n,d,u,c=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>1&&void 0!==c[1]?c[1]:2,r){e.next=3;break}return e.abrupt("return",{data:[],referer:""});case 3:return o=h(r),e.next=6,(0,i.xhrCustom)({url:o});case 6:return n=e.sent,d=n._response,u=(0,a.cheerio)(d),e.abrupt("return",{data:(u(".pr-video").map((function(e,r){var t=(0,a.cheerio)(r);return{cover:t.find("img").attr("src").replace("http://","https://"),title:t.text().trim(),href:t.attr("href")||""}})).get()||[]).filter((function(e,r){return r<t})),referer:o});case 10:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function _(){return _=(0,n.default)(s.mark((function e(r,t){var o,n,c,l,m,p,h,j,v,b,_=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=_.length>2&&void 0!==_[2]?_[2]:3,r){e.next=3;break}return e.abrupt("return",{data:[],referer:""});case 3:return n=f(r,t),e.next=6,(0,i.xhrCustom)({url:n});case 6:c=e.sent,l=c._response,m=(0,a.cheerio)(l),p=(m(".video-list li").map((function(e,r){var t,s=(0,a.cheerio)(r),o=s.find("p a");return{cover:s.find("img").attr("src").replace("http://","https://"),title:(null==(t=o.text().trim().split("_哔哩哔哩"))?void 0:t[0])||"",href:o.attr("href")||"",src:""}})).get()||[]).filter((function(e,r){return r<3})),h=0;case 11:if(!(h<p.length)){e.next=23;break}return e.next=14,(0,i.xhrCustom)({url:""+u+p[h].href});case 14:return j=e.sent,v=j._response,e.next=18,(0,d.sleep)(800);case 18:(b=(0,a.cheerio)(v)(".video-player-fallback").attr("href")||"").includes("www.bilibili.com")&&(p[h].src=b);case 20:h+=1,e.next=11;break;case 23:return e.abrupt("return",{data:p.filter((function(e){return e.src})).filter((function(e,r){return r<o})),referer:n});case 24:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function x(e){return String(e).replace(/ |(&amp;)|-|：|《|》|（|）|“|”|，|。|之/g,"")}}}]);