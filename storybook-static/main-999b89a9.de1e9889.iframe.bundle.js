(self.webpackChunkweb=self.webpackChunkweb||[]).push([[1599],{"./src/screens/login/assist/index.stories.tsx":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.object.assign.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.LoginAssist=void 0,n(s("./node_modules/react/index.js")),s("./src/components/index.ts")),r=n(s("./src/screens/login/assist/index.tsx")),i=s("./node_modules/react/jsx-runtime.js"),n=(t.default={title:"screens/LoginAssist",component:r.default},t.LoginAssist=function(){return(0,i.jsx)(o.StorybookSPA,{children:(0,i.jsx)(o.StorybookList,{children:(0,i.jsx)(r.default,Object.assign({},(0,o.getStorybookArgs)("LoginAssist")))})})});n.parameters=Object.assign({storySource:{source:"() => (\n  <StorybookSPA>\n    <StorybookList>\n      <Component {...getStorybookArgs('LoginAssist')} />\n    </StorybookList>\n  </StorybookSPA>\n)"}},n.parameters)},"./src/screens/login/token/index.stories.tsx":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.object.assign.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.LoginToken=void 0,n(s("./node_modules/react/index.js")),s("./src/components/index.ts")),r=n(s("./src/screens/login/token/index.tsx")),i=s("./node_modules/react/jsx-runtime.js"),n=(t.default={title:"screens/LoginToken",component:r.default},t.LoginToken=function(){return(0,i.jsx)(o.StorybookSPA,{children:(0,i.jsx)(o.StorybookList,{children:(0,i.jsx)(r.default,Object.assign({},(0,o.getStorybookArgs)("LoginToken")))})})});n.parameters=Object.assign({storySource:{source:"() => (\n  <StorybookSPA>\n    <StorybookList>\n      <Component {...getStorybookArgs('LoginToken')} />\n    </StorybookList>\n  </StorybookSPA>\n)"}},n.parameters)},"./src/screens/login/v2/index.stories.tsx":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.object.assign.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.LoginV2=void 0,n(s("./node_modules/react/index.js")),s("./src/components/index.ts")),r=n(s("./src/screens/login/v2/index.tsx")),i=s("./node_modules/react/jsx-runtime.js"),n=(t.default={title:"screens/LoginV2",component:r.default},t.LoginV2=function(){return(0,i.jsx)(o.StorybookSPA,{children:(0,i.jsx)(o.StorybookList,{children:(0,i.jsx)(r.default,Object.assign({},(0,o.getStorybookArgs)("LoginV2")))})})});n.parameters=Object.assign({storySource:{source:"() => (\n  <StorybookSPA>\n    <StorybookList>\n      <Component {...getStorybookArgs('LoginV2')} />\n    </StorybookList>\n  </StorybookSPA>\n)"}},n.parameters)},"./src/screens/login/assist/index.tsx":(e,t,s)=>{var n=s("./node_modules/@babel/runtime/regenerator/index.js"),o=(s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.reflect.construct.js"),s("./node_modules/core-js/modules/es.array.concat.js"),s("./node_modules/core-js/modules/es.array.index-of.js"),s("./node_modules/core-js/modules/es.array.last-index-of.js"),s("./node_modules/core-js/modules/es.string.match.js"),s("./node_modules/core-js/modules/es.regexp.exec.js"),s("./node_modules/core-js/modules/es.array.join.js"),s("./node_modules/core-js/modules/es.array.slice.js"),s("./node_modules/core-js/modules/es.string.split.js"),s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js")),r=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o(s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"))),i=o(s("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=o(s("./node_modules/@babel/runtime/helpers/createClass.js")),d=o(s("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),l=o(s("./node_modules/@babel/runtime/helpers/inherits.js")),u=o(s("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=o(s("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),f=o(s("./node_modules/@babel/runtime/helpers/defineProperty.js")),m=o(s("./node_modules/react/index.js")),p=o(s("./node_modules/react-native-web/dist/exports/View/index.js")),h=o(s("./node_modules/cheerio-without-node-native/index.js")),g=s("./src/components/index.ts"),y=s("./src/stores/index.ts"),j=s("./src/utils/index.ts"),_=s("./src/utils/decorators/index.ts"),x=s("./src/utils/fetch/index.ts"),b=s("./src/constants/index.ts"),v=o(s("./src/constants/i18n/index.ts")),S=s("./src/screens/login/assist/styles.ts"),k=s("./node_modules/react/jsx-runtime.js");function T(s){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(s);return e=n?(e=(0,c.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,u.default)(this,e)}}var A,C="JSON.stringify({\n  userAgent: navigator.userAgent,\n  cookie: document.cookie\n});",s=(o=m.default.Component,(0,l.default)(w,o),A=T(w),(0,a.default)(w,[{key:"render",value:function(){var e=this.state,t=e.loading,e=e.info;return(0,k.jsxs)(g.Component,{id:"screen-login-assist",children:[(0,k.jsx)(g.Header,{title:"电脑辅助"+v.default.login(),alias:"辅助"+v.default.login(),hm:["login/assist","LoginAssist"]}),(0,k.jsx)(g.Page,{children:(0,k.jsxs)(g.ScrollView,{contentContainerStyle:this.styles.container,scrollToTop:!0,children:[(0,k.jsxs)(g.Text,{type:"danger",size:12,children:["此为",v.default.login(),"最后的手段，流程相对较多 (其实不复杂， 熟悉的话比正常",v.default.login(),"还要快和稳)，请先尝试新版和旧版",v.default.login(),"，不行再试这个。"]}),(0,k.jsxs)(g.Text,{style:y._.mt.sm,type:"sub",size:12,children:["第三方",v.default.login(),"失败受很多因素影响，如网络不佳、运营商劫持、手机系统特异， 又或者碰上bgm速度不佳 (当然还有代码有bug)。"]}),(0,k.jsxs)(g.Text,{style:y._.mt.sm,type:"sub",size:12,children:["本人能力有限，部分设备无论如何都不能走通新版和旧版的",v.default.login(),"流程， 若您实在很喜欢本应用，可以尝试下面的方法 (假如还走不通，请多尝试， 又或者过来干我)。"]}),(0,k.jsx)(g.Text,{style:y._.mt.lg,children:"1. 复制框里的代码。"}),(0,k.jsxs)(p.default,{style:y._.mt.sm,children:[(0,k.jsx)(g.Text,{style:this.styles.code,size:12,children:C}),(0,k.jsx)(g.Text,{style:this.styles.copy,size:12,type:"success",onPress:this.copy,children:"点击复制"}),(0,k.jsx)(g.Heatmap,{id:"辅助登陆.复制"})]}),(0,k.jsxs)(g.Text,{style:y._.mt.md,children:["2. 使用电脑打开浏览器，访问 ",b.HOST," (一定要是这个域名) 并",v.default.login(),"。"]}),(0,k.jsxs)(g.Text,{style:y._.mt.md,children:["3. ",v.default.login(),"成功后，打开控制台 (chrome为例，window是F12，mac是⎇ + ⌘ + i)， 之后运行复制的代码。"]}),(0,k.jsx)(g.Text,{style:y._.mt.md,children:"4. 把结果复制到下面的输入框内，提交。"}),(0,k.jsxs)(p.default,{style:y._.mt.sm,children:[(0,k.jsx)(g.Input,{style:this.styles.input,placeholder:"粘贴结果",multiline:!0,numberOfLines:6,returnKeyType:"done",returnKeyLabel:v.default.login(),onChangeText:this.onChangeText,onSubmitEditing:this.submit}),(0,k.jsx)(g.Heatmap,{id:"辅助登陆.提交"})]}),(0,k.jsx)(g.Button,{style:y._.mt.lg,type:"main",shadow:!0,loading:t,onPress:this.submit,children:v.default.login()}),(0,k.jsx)(g.Text,{style:y._.mt.md,size:12,lineHeight:16,type:"sub",children:e}),(0,k.jsx)(g.KeyboardSpacer,{})]})})]})}},{key:"styles",get:function(){return(0,S.memoStyles)()}}]),w);function w(){var l;(0,i.default)(this,w);for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return l=A.call.apply(A,[this].concat(t)),(0,f.default)((0,d.default)(l),"state",{result:"",loading:!1,info:""}),(0,f.default)((0,d.default)(l),"userAgent",""),(0,f.default)((0,d.default)(l),"formhash",""),(0,f.default)((0,d.default)(l),"cookie",{chiiSid:"",chiiAuth:""}),(0,f.default)((0,d.default)(l),"code",""),(0,f.default)((0,d.default)(l),"accessToken",""),(0,f.default)((0,d.default)(l),"copy",function(){(0,x.t)("辅助登陆.复制"),(0,j.copy)(C,"已复制")}),(0,f.default)((0,d.default)(l),"onChangeText",function(e){l.setState({result:e})}),(0,f.default)((0,d.default)(l),"submit",function(){var e=l.state,t=e.loading,e=e.result;if(!t)if(""===e)(0,j.info)("请粘贴结果");else{(0,x.t)("辅助登陆.提交"),l.setState({loading:!0,info:v.default.login()+"请求中..."});try{var s=e,n=((s=0===s.indexOf('"')?s.substring(1):s).lastIndexOf('"')===s.length-1&&(s=s.substring(0,s.length-1)),JSON.parse(s)),o=n.userAgent,r=n.cookie;if(o){if(l.userAgent=o,r){var i=r.match(/chii_sid=(.+?);/)||r.match(/chii_sid=(.+?)$/);if(!i)return void l.setState({loading:!1,info:"结果中没有"+v.default.login()+"过的cookie, 请重新输入"});l.cookie.chiiSid=i[1];var a=r.match(/chii_auth=(.+?);/)||r.match(/chii_auth=(.+?)$/);if(!a)return void l.setState({loading:!1,info:"结果中没有"+v.default.login()+"过的cookie, 请重新输入"});l.cookie.chiiAuth=a[1]}l.onLogin()}else l.setState({loading:!1,info:"结果中没有userAgent, 请重新输入"})}catch(e){l.setState({loading:!1,info:"结果格式有误, 请重新输入"})}}}),(0,f.default)((0,d.default)(l),"onLogin",(0,r.default)(n.mark(function e(){var t;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.oauth();case 3:return e.next=5,l.authorize();case 5:return e.next=7,l.getAccessToken();case 7:t=e.sent,t=t._response,t=JSON.parse(t),y.userStore.updateAccessToken(t),l.inStore(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),l.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"});case 17:case"end":return e.stop()}},e,null,[[0,14]])}))),(0,f.default)((0,d.default)(l),"oauth",(0,r.default)(n.mark(function e(){var t,s;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.setState({info:"获取授权表单码...(1/4)"}),e.prev=1,t=(0,x.xhrCustom)({url:b.HOST+"/oauth/authorize?client_id="+b.APP_ID+"&response_type=code&redirect_uri="+b.URL_OAUTH_REDIRECT,headers:{Cookie:"; chii_cookietime=2592000; chii_sid="+l.cookie.chiiSid+"; chii_auth="+l.cookie.chiiAuth+";","User-Agent":l.userAgent}}),e.next=5,t;case 5:return s=e.sent,s=s._response,l.formhash=h.default.load(s)("input[name=formhash]").attr("value"),e.abrupt("return",t);case 11:return e.prev=11,e.t0=e.catch(1),l.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"}),e.abrupt("return",!1);case 15:case"end":return e.stop()}},e,null,[[1,11]])}))),(0,f.default)((0,d.default)(l),"authorize",(0,r.default)(n.mark(function e(){var t,s;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.setState({info:"授权中...(2/4)"}),e.prev=1,t=(0,x.xhrCustom)({method:"POST",url:b.HOST+"/oauth/authorize?client_id="+b.APP_ID+"&response_type=code&redirect_uri="+b.URL_OAUTH_REDIRECT,headers:{"Content-Type":"application/x-www-form-urlencoded",Cookie:"; chii_cookietime=2592000; chii_sid="+l.cookie.chiiSid+"; chii_auth="+l.cookie.chiiAuth+";","User-Agent":l.userAgent},data:{formhash:l.formhash,redirect_uri:"",client_id:b.APP_ID,submit:"授权"}}),e.next=5,t;case 5:return s=e.sent,s=s.responseURL,l.code=s.split("=").slice(1).join("="),e.abrupt("return",t);case 11:return e.prev=11,e.t0=e.catch(1),l.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"}),e.abrupt("return",!1);case 15:case"end":return e.stop()}},e,null,[[1,11]])}))),(0,f.default)((0,d.default)(l),"getAccessToken",function(){l.setState({info:"授权成功, 获取token中...(3/4)"});try{return(0,x.xhrCustom)({method:"POST",url:b.HOST+"/oauth/access_token",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":l.userAgent},data:{grant_type:"authorization_code",client_id:b.APP_ID,client_secret:b.APP_SECRET,code:l.code,redirect_uri:b.URL_OAUTH_REDIRECT,state:(0,j.getTimestamp)()}})}catch(e){return l.setState({loading:!1,info:v.default.login()+"失败, 请重试或跟我反馈吧bgm38"}),!1}}),(0,f.default)((0,d.default)(l),"inStore",(0,r.default)(n.mark(function e(){var t;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.setState({info:v.default.login()+"成功, 正在请求个人信息...(4/4)"}),t=l.props.navigation,y.userStore.updateUserCookie({cookie:"chii_cookietime=2592000; chii_sid="+l.cookie.chiiSid+"; chii_auth="+l.cookie.chiiAuth,userAgent:l.userAgent,v:0}),(0,j.feedback)(),e.next=6,y.userStore.fetchUserInfo();case 6:return e.next=8,y.userStore.fetchUsersInfo();case 8:t.popToTop();case 9:case"end":return e.stop()}},e)}))),l}t.default=(0,_.ob)(s);try{assist.displayName="assist",assist.__docgenInfo={description:"",displayName:"assist",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/assist/index.tsx#assist"]={docgenInfo:assist.__docgenInfo,name:"assist",path:"src/screens/login/assist/index.tsx#assist"})}catch(e){}},"./src/screens/login/assist/styles.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.memoStyles=void 0;var n=s("./src/stores/index.ts");t.memoStyles=n._.memoStyles(function(){return{container:{display:"flex",flexDirection:"column",paddingTop:n._.sm,paddingHorizontal:n._.wind,paddingBottom:n._.lg},code:{paddingVertical:n._.md,paddingHorizontal:n._.wind,backgroundColor:n._.select(n._.colorBg,n._._colorDarkModeLevel1),borderWidth:1,borderColor:n._.colorBorder,borderRadius:n._.radiusXs,overflow:"hidden"},copy:{position:"absolute",top:n._.sm,right:n._.sm,padding:n._.sm},input:{backgroundColor:n._.select(n._.colorBg,n._._colorDarkModeLevel1)}}})},"./src/screens/login/token/index.tsx":(e,t,s)=>{var i=s("./node_modules/@babel/runtime/regenerator/index.js"),n=(s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.weak-map.js"),s("./node_modules/core-js/modules/es.object.to-string.js"),s("./node_modules/core-js/modules/es.string.iterator.js"),s("./node_modules/core-js/modules/es.array.iterator.js"),s("./node_modules/core-js/modules/web.dom-collections.iterator.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),s("./node_modules/core-js/modules/es.object.assign.js"),s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js")),a=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"))),l=n(s("./node_modules/@babel/runtime/helpers/slicedToArray.js")),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=_(t);if(t&&t.has(e))return t.get(e);var s,n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(s in e){var r;"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&((r=o?Object.getOwnPropertyDescriptor(e,s):null)&&(r.get||r.set)?Object.defineProperty(n,s,r):n[s]=e[s])}return n.default=e,t&&t.set(e,n),n}(s("./node_modules/react/index.js")),u=n(s("./node_modules/react-native-web/dist/exports/View/index.js")),c=s("./node_modules/mobx-react/dist/mobxreact.esm.js"),f=s("./src/components/index.ts"),m=s("./src/stores/index.ts"),p=s("./src/utils/index.ts"),h=s("./src/utils/fetch.v0/index.ts"),g=s("./src/utils/hooks/index.ts"),y=s("./src/screens/login/token/styles.ts"),j=s("./node_modules/react/jsx-runtime.js");function _(e){var t,s;return"function"!=typeof WeakMap?null:(t=new WeakMap,s=new WeakMap,(_=function(e){return e?s:t})(e))}t.default=function(){var e=(0,d.useState)(""),e=(0,l.default)(e,2),o=e[0],r=e[1],n=(0,d.useCallback)((0,a.default)(i.mark(function e(){var t,s,n;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=4;break}return(0,p.info)("已清除鉴权信息"),m.userStore.updateAccessToken({access_token:"",expires_in:604800,token_type:"Bearer",scope:null,user_id:0,refresh_token:""}),e.abrupt("return");case 4:return t=Object.assign({},m.userStore.accessToken),s={access_token:o,expires_in:604800,token_type:"Bearer",scope:null,user_id:0,refresh_token:""},m.userStore.updateAccessToken(s),e.next=9,(0,h.fetchMeV0)();case 9:if(null!=(n=e.sent)&&n.id&&null!=n&&n.username)return(0,p.info)("更新成功"),m.userStore.updateUserInfo(Object.assign({},n,{_loaded:(0,p.getTimestamp)()})),m.userStore.updateAccessToken(Object.assign({},s,{user_id:n.id})),m.collectionStore.clearState("_collectionStatusLastFetchMS"),e.abrupt("return");e.next=16;break;case 16:(0,p.info)("更新失败，请确保用户令牌可用"),m.userStore.updateAccessToken(t),r(t.access_token);case 19:case"end":return e.stop()}},e)})),[o]);return(0,g.useMount)(function(){r(m.userStore.accessToken.access_token)}),(0,c.useObserver)(function(){var e=m.userStore.userInfo,t=e.avatar,s=e.nickname,e=e.username;return(0,j.jsxs)(f.Component,{id:"screen-login-token",children:[(0,j.jsx)(f.Header,{title:" "}),(0,j.jsx)(f.Page,{children:(0,j.jsxs)(f.Flex,{style:y.styles.container,direction:"column",justify:"center",children:[null!=t&&t.large&&s?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f.Avatar,{src:t.large,size:96,round:!0}),(0,j.jsxs)(f.Text,{style:m._.mt.sm,size:16,bold:!0,children:[s," @",e]})]}):(0,j.jsx)(f.Mesume,{}),(0,j.jsx)(u.default,{style:y.styles.item,children:(0,j.jsx)(f.Input,{style:y.styles.input,placeholder:"用户令牌，必填",value:o,onChangeText:r})}),(0,j.jsx)(f.Touchable,{style:m._.mt.md,onPress:n,children:(0,j.jsxs)(f.Flex,{children:[(0,j.jsx)(f.Text,{type:"sub",size:16,bold:!0,children:"更新"}),(0,j.jsx)(f.Flex,{style:y.styles.arrow,children:(0,j.jsx)(f.Iconfont,{name:"md-arrow-forward",size:14})})]})})]})})]})})};try{token.displayName="token",token.__docgenInfo={description:"SPA 网页版更新授权",displayName:"token",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/token/index.tsx#token"]={docgenInfo:token.__docgenInfo,name:"token",path:"src/screens/login/token/index.tsx#token"})}catch(e){}},"./src/screens/login/token/styles.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;s=s("./src/stores/index.ts");t.styles=s._.create({container:{minHeight:.72*s._.window.height,paddingHorizontal:48},item:{width:"100%"},input:Object.assign({height:40,marginTop:48,paddingVertical:0,textAlign:"center"},s._.fontSize14,{borderRadius:20}),arrow:{padding:2,marginLeft:s._.sm,borderWidth:2,borderColor:s._.colorIcon,borderRadius:20}})},"./src/screens/login/v2/ds.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.URL_TOURIST=t.UA_EKIBUN_BANGUMI_APP=t.TITLE=t.NAMESPACE=t.AUTH_RETRY_COUNT=void 0;var n=s("./src/utils/index.ts"),s=s("./src/constants/index.ts");t.TITLE="登录",t.NAMESPACE="LoginV2",t.AUTH_RETRY_COUNT=4,t.URL_TOURIST=s.GITHUB_HOST+"/raw/master/tourist.json?t="+(0,n.getTimestamp)(),t.UA_EKIBUN_BANGUMI_APP="Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Mobile Safari/537.36"},"./src/screens/login/v2/form/index.tsx":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.reflect.construct.js"),s("./node_modules/core-js/modules/es.array.concat.js"),s("./node_modules/core-js/modules/es.array.includes.js"),s("./node_modules/core-js/modules/es.string.includes.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(s("./node_modules/@babel/runtime/helpers/classCallCheck.js"))),r=n(s("./node_modules/@babel/runtime/helpers/createClass.js")),i=n(s("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),a=n(s("./node_modules/@babel/runtime/helpers/inherits.js")),l=n(s("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),d=n(s("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),u=n(s("./node_modules/@babel/runtime/helpers/defineProperty.js")),c=n(s("./node_modules/react/index.js")),f=n(s("./node_modules/react-native-web/dist/exports/View/index.js")),m=n(s("./node_modules/react-native-web/dist/exports/Image/index.js")),p=n(s("./node_modules/@ant-design/react-native/lib/activity-indicator/index.js")),h=s("./src/components/index.ts"),g=s("./src/screens/_/index.ts"),y=s("./src/stores/index.ts"),j=s("./src/utils/index.ts"),_=s("./src/utils/decorators/index.ts"),x=s("./src/utils/fetch/index.ts"),b=s("./src/constants/index.ts"),v=n(s("./src/constants/i18n/index.ts")),S=s("./src/screens/login/v2/form/styles.ts"),k=s("./node_modules/react/jsx-runtime.js");function T(s){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,d.default)(s);return e=n?(e=(0,d.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,e)}}var A,C=[b.HOST,b.HOST_2,b.HOST_3],s=(n=c.default.Component,(0,a.default)(w,n),A=T(w),(0,r.default)(w,[{key:"componentDidMount",value:function(){var e,t,s=this.props,n=s.email,o=s.password,s=s.captcha;if(n&&o&&!s)try{"function"==typeof(null==this||null==(e=this.codeRef)||null==(t=e.inputRef)?void 0:t.focus)&&this.codeRef.inputRef.focus()}catch(e){}}},{key:"renderForm",value:function(){var t=this,e=this.props,s=e.email,n=e.password,o=e.captcha,r=e.base64,i=e.forwardRef,a=e.onGetCaptcha,l=e.onFocus,d=e.onBlur,u=e.onChange,e=e.onLogin;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(h.Flex,{style:y._.mt.lg,children:(0,k.jsx)(h.Flex.Item,{children:(0,k.jsx)(h.Input,{style:this.styles.input,value:s,placeholder:"Email",returnKeyType:"next",onFocus:l,onBlur:d,onChange:function(e){return u(e,"email")},onSubmitEditing:this.onSubmitEditingEmail})})}),(0,k.jsx)(h.Flex,{style:y._.mt.md,children:(0,k.jsx)(h.Flex.Item,{children:(0,k.jsx)(h.Input,{ref:function(e){return t.passwordRef=e},style:this.styles.input,value:n,placeholder:"密码",secureTextEntry:!0,returnKeyType:"next",onFocus:l,onBlur:d,onChange:function(e){return u(e,"password")},onSubmitEditing:this.onSubmitEditingPassword})})}),(0,k.jsxs)(h.Flex,{style:y._.mt.md,children:[(0,k.jsx)(h.Flex.Item,{children:(0,k.jsx)(h.Input,{ref:function(e){i(e),t.codeRef=e},style:this.styles.input,value:o,placeholder:"验证码",returnKeyType:"done",returnKeyLabel:v.default.login(),onFocus:l,onBlur:d,onChange:function(e){return u(e,"captcha")},onSubmitEditing:e})}),(0,k.jsx)(h.Touchable,{style:this.styles.touchCaptcha,onPress:a,children:(0,k.jsx)(h.Flex,{style:this.styles.captchaContainer,justify:"center",children:r?(0,k.jsx)(m.default,{style:this.styles.captcha,source:{uri:r}}):(0,k.jsx)(p.default,{size:"small"})})})]})]})}},{key:"renderConfig",value:function(){var e=this.props,t=e.failed,s=e.isCommonUA,n=e.host,o=e.onSelect,e=e.onUAChange;return t?this.state.config?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(h.Flex,{style:[this.styles.touch,y._.mt.sm],children:[(0,k.jsx)(h.Flex.Item,{children:(0,k.jsx)(g.Popover,{style:this.styles.touch,data:C,onSelect:o,children:(0,k.jsxs)(h.Flex,{style:this.styles.content,children:[(0,k.jsxs)(h.Text,{type:"sub",size:12,children:["使用 ",n," 进行",v.default.login()]}),(0,k.jsx)(h.Iconfont,{name:"md-keyboard-arrow-down"})]})})}),(0,k.jsx)(h.Touchable,{style:this.styles.touchIcon,onPress:this.onNoticeHost,children:(0,k.jsx)(h.Flex,{style:this.styles.icon,justify:"center",children:(0,k.jsx)(h.Iconfont,{name:"md-info-outline",size:18})})})]}),(0,k.jsxs)(h.Flex,{style:this.styles.touch,children:[(0,k.jsx)(h.Flex.Item,{children:(0,k.jsx)(h.Touchable,{style:this.styles.touch,onPress:e,children:(0,k.jsxs)(h.Flex,{style:this.styles.content,children:[(0,k.jsx)(h.Iconfont,{name:s?"md-radio-button-on":"md-radio-button-off",color:s?y._.colorMain:y._.colorSub,size:18}),(0,k.jsxs)(h.Text,{style:y._.ml.xs,type:"sub",size:12,children:["使用固定UA",v.default.login()," (频繁掉线请勾选)"]})]})})}),(0,k.jsx)(h.Touchable,{style:this.styles.touchIcon,onPress:this.onNoticeUA,children:(0,k.jsx)(h.Flex,{style:this.styles.icon,justify:"center",children:(0,k.jsx)(h.Iconfont,{name:"md-info-outline",size:18})})})]})]}):(0,k.jsxs)(h.Touchable,{style:[this.styles.touch,y._.mt.sm],onPress:this.showConfig,children:[(0,k.jsxs)(h.Flex,{style:this.styles.content,children:[(0,k.jsxs)(h.Text,{type:"sub",size:12,children:[v.default.login(),"配置"]}),(0,k.jsx)(h.Iconfont,{name:"md-navigate-next"})]}),(0,k.jsx)(h.Heatmap,{id:"登陆.切换域名"}),(0,k.jsx)(h.Heatmap,{bottom:-32,id:"登陆.配置提示",transparent:!0})]}):null}},{key:"renderError",value:function(){var e=this.props,t=e.navigation,e=e.info,s=e.includes("错误");return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(h.Text,{style:y._.mt.md,size:12,lineHeight:16,type:"sub",onPress:function(){s&&t.push("Login")},children:e}),s&&(0,k.jsxs)(h.Text,{style:y._.mt.md,size:12,lineHeight:16,type:"sub",onPress:function(){return t.push("LoginAssist")},children:["请尝试切换另一域名进行重试，或尝试切换wifi或4g网络，实在没法",v.default.login(),"，可点击这里前往辅助",v.default.login(),"→"]})]})}},{key:"render",value:function(){var e=this.props,t=e.loading,e=e.onLogin;return(0,k.jsx)(f.default,{style:y._.container.column,children:(0,k.jsxs)(f.default,{style:this.styles.form,children:[(0,k.jsx)(h.Flex,{justify:"center",children:(0,k.jsx)(h.Mesume,{})}),this.renderForm(),!b.STORYBOOK&&this.renderConfig(),(0,k.jsx)(h.Button,{style:y._.mt.lg,type:"main",shadow:!0,loading:t,onPress:e,children:v.default.login()}),this.renderError()]})})}},{key:"styles",get:function(){return(0,S.memoStyles)()}}]),w);function w(){var n;(0,o.default)(this,w);for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return n=A.call.apply(A,[this].concat(t)),(0,u.default)((0,i.default)(n),"state",{config:!1}),(0,u.default)((0,i.default)(n),"passwordRef",void 0),(0,u.default)((0,i.default)(n),"codeRef",void 0),(0,u.default)((0,i.default)(n),"showConfig",function(){return n.setState({config:!0})}),(0,u.default)((0,i.default)(n),"onNoticeHost",function(){(0,x.t)("登陆.配置提示",{name:"host"}),(0,j.alert)("三个选项都是同一个站点的不同域名，只是具体服务器位置不同。 \n\n"+v.default.login()+"建议优先使用 bgm.tv，出现问题再尝试 bangumi.tv，最后尝试 chii.in。")}),(0,u.default)((0,i.default)(n),"onNoticeUA",function(){(0,x.t)("登陆.配置提示",{name:"ua"}),(0,j.alert)("假如您频繁掉授权状态，不妨试试把这个选项勾上，通常"+v.default.login()+"状态生存时间为7天。 \n\n这是个不稳定的选项，若"+v.default.login()+"正常不建议勾上，可能会遇到预测不能的状况。")}),(0,u.default)((0,i.default)(n),"onSubmitEditingEmail",function(){try{var e,t,s;"function"==typeof(null==(e=(0,i.default)(n))||null==(t=e.passwordRef)||null==(s=t.inputRef)?void 0:s.focus)&&n.passwordRef.inputRef.focus()}catch(e){}}),(0,u.default)((0,i.default)(n),"onSubmitEditingPassword",function(){try{var e,t,s;"function"==typeof(null==(e=(0,i.default)(n))||null==(t=e.codeRef)||null==(s=t.inputRef)?void 0:s.focus)&&n.codeRef.inputRef.focus()}catch(e){}}),n}(0,u.default)(s,"defaultProps",{host:"",forwardRef:function(){},onGetCaptcha:function(){},onFocus:function(){},onBlur:function(){},onChange:function(){},onSelect:function(){},onUAChange:function(){},onLogin:function(){}});t.default=(0,_.ob)(s);try{form.displayName="form",form.__docgenInfo={description:"",displayName:"form",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}},info:{defaultValue:null,description:"",name:"info",required:!0,type:{name:"string"}},email:{defaultValue:null,description:"",name:"email",required:!0,type:{name:"string"}},password:{defaultValue:null,description:"",name:"password",required:!0,type:{name:"string"}},captcha:{defaultValue:null,description:"",name:"captcha",required:!0,type:{name:"string"}},base64:{defaultValue:null,description:"",name:"base64",required:!0,type:{name:"string"}},isCommonUA:{defaultValue:null,description:"",name:"isCommonUA",required:!0,type:{name:"boolean"}},host:{defaultValue:null,description:"",name:"host",required:!0,type:{name:"string"}},loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}},failed:{defaultValue:null,description:"",name:"failed",required:!0,type:{name:"boolean"}},forwardRef:{defaultValue:null,description:"",name:"forwardRef",required:!0,type:{name:"Fn"}},onGetCaptcha:{defaultValue:null,description:"",name:"onGetCaptcha",required:!0,type:{name:"Fn"}},onFocus:{defaultValue:null,description:"",name:"onFocus",required:!0,type:{name:"Fn"}},onBlur:{defaultValue:null,description:"",name:"onBlur",required:!0,type:{name:"Fn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"Fn"}},onLogin:{defaultValue:null,description:"",name:"onLogin",required:!0,type:{name:"Fn"}},onSelect:{defaultValue:null,description:"",name:"onSelect",required:!0,type:{name:"Fn"}},onUAChange:{defaultValue:null,description:"",name:"onUAChange",required:!0,type:{name:"Fn"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/v2/form/index.tsx#form"]={docgenInfo:form.__docgenInfo,name:"form",path:"src/screens/login/v2/form/index.tsx#form"})}catch(e){}},"./src/screens/login/v2/form/styles.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.memoStyles=void 0;var n=s("./src/stores/index.ts");t.memoStyles=n._.memoStyles(function(){return{form:{width:n._.r(300),paddingBottom:200},input:Object.assign({height:44,paddingVertical:0,paddingHorizontal:14},n._.device(n._.fontSize12,n._.fontSize15),{backgroundColor:n._.colorBg,borderRadius:n._.radiusSm}),touchCaptcha:{height:44,marginLeft:n._.sm,borderRadius:n._.radiusSm,overflow:"hidden"},captchaContainer:{width:118,height:44},captcha:{width:118,height:44},touch:{borderRadius:n._.radiusSm,overflow:"hidden"},content:{paddingVertical:4},touchIcon:{marginLeft:n._.md,borderRadius:20,overflow:"hidden"},icon:{width:36,height:36}}})},"./src/screens/login/v2/index.tsx":(e,t,s)=>{var i=s("./node_modules/@babel/runtime/regenerator/index.js"),n=(s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.reflect.construct.js"),s("./node_modules/core-js/modules/es.array.concat.js"),s("./node_modules/core-js/modules/es.array.includes.js"),s("./node_modules/core-js/modules/es.string.includes.js"),s("./node_modules/core-js/modules/es.string.match.js"),s("./node_modules/core-js/modules/es.regexp.exec.js"),s("./node_modules/core-js/modules/es.typed-array.uint8-array.js"),s("./node_modules/core-js/modules/es.typed-array.copy-within.js"),s("./node_modules/core-js/modules/es.typed-array.every.js"),s("./node_modules/core-js/modules/es.typed-array.fill.js"),s("./node_modules/core-js/modules/es.typed-array.filter.js"),s("./node_modules/core-js/modules/es.typed-array.find.js"),s("./node_modules/core-js/modules/es.typed-array.find-index.js"),s("./node_modules/core-js/modules/es.typed-array.for-each.js"),s("./node_modules/core-js/modules/es.typed-array.includes.js"),s("./node_modules/core-js/modules/es.typed-array.index-of.js"),s("./node_modules/core-js/modules/es.typed-array.iterator.js"),s("./node_modules/core-js/modules/es.typed-array.join.js"),s("./node_modules/core-js/modules/es.typed-array.last-index-of.js"),s("./node_modules/core-js/modules/es.typed-array.map.js"),s("./node_modules/core-js/modules/es.typed-array.reduce.js"),s("./node_modules/core-js/modules/es.typed-array.reduce-right.js"),s("./node_modules/core-js/modules/es.typed-array.reverse.js"),s("./node_modules/core-js/modules/es.typed-array.set.js"),s("./node_modules/core-js/modules/es.typed-array.slice.js"),s("./node_modules/core-js/modules/es.typed-array.some.js"),s("./node_modules/core-js/modules/es.typed-array.sort.js"),s("./node_modules/core-js/modules/es.typed-array.subarray.js"),s("./node_modules/core-js/modules/es.typed-array.to-locale-string.js"),s("./node_modules/core-js/modules/es.typed-array.to-string.js"),s("./node_modules/core-js/modules/es.object.to-string.js"),s("./node_modules/core-js/modules/es.array.iterator.js"),s("./node_modules/core-js/modules/es.array-buffer.slice.js"),s("./node_modules/core-js/modules/es.array.join.js"),s("./node_modules/core-js/modules/es.array.slice.js"),s("./node_modules/core-js/modules/es.string.split.js"),s("./node_modules/core-js/modules/es.array.for-each.js"),s("./node_modules/core-js/modules/es.regexp.constructor.js"),s("./node_modules/core-js/modules/es.regexp.to-string.js"),s("./node_modules/core-js/modules/es.string.trim.js"),s("./node_modules/core-js/modules/es.array.map.js"),s("./node_modules/core-js/modules/es.object.keys.js"),s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js")),o=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"))),a=n(s("./node_modules/@babel/runtime/helpers/classCallCheck.js")),r=n(s("./node_modules/@babel/runtime/helpers/createClass.js")),l=n(s("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),d=n(s("./node_modules/@babel/runtime/helpers/inherits.js")),u=n(s("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=n(s("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),f=n(s("./node_modules/@babel/runtime/helpers/defineProperty.js")),m=n(s("./node_modules/react/index.js")),p=n(s("./node_modules/react-native-web/dist/exports/View/index.js")),h=n(s("./node_modules/cheerio-without-node-native/index.js")),g=n(s("./node_modules/expo-constants/build/Constants.js")),y=s("./src/components/index.ts"),j=s("./src/screens/_/index.ts"),_=s("./src/stores/index.ts"),x=s("./src/utils/index.ts"),b=s("./src/utils/decorators/index.ts"),v=s("./src/utils/fetch/index.ts"),S=n(s("./src/utils/thirdParty/axios.js")),k=s("./src/constants/index.ts"),T=n(s("./src/constants/i18n/index.ts")),A=s("./config.ts"),C=n(s("./src/screens/login/v2/form/index.tsx")),w=n(s("./src/screens/login/v2/preview/index.tsx")),O=s("./src/screens/login/v2/ds.ts"),R=s("./src/screens/login/v2/styles.ts"),P=s("./node_modules/react/jsx-runtime.js");function L(s){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(s);return e=n?(e=(0,c.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,u.default)(this,e)}}n=m.default.Component,(0,d.default)(I,n),E=L(I),(0,r.default)(I,[{key:"componentDidMount",value:(U=(0,o.default)(i.mark(function e(){var t,s,n,o;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,s={},e.next=4,(0,x.getStorage)(O.NAMESPACE+"|host");case 4:return(n=e.sent)&&(s.host=n),e.next=8,(0,x.getStorage)(O.NAMESPACE+"|email");case 8:return(n=e.sent)&&(s.email=n),e.next=12,(0,x.getStorage)(O.NAMESPACE+"|password");case 12:return(o=e.sent)&&(s.password=o),e.next=16,(0,x.getStorage)(O.NAMESPACE+"|isCommonUA");case 16:(o=e.sent)&&(s.isCommonUA=o),this.setState(s,function(){t.reset()}),(0,v.hm)("login/v2","LoginV2");case 20:case"end":return e.stop()}},e,this)})),function(){return U.apply(this,arguments)})},{key:"cookieString",get:function(){var t=this;return Object.keys(this.cookie).map(function(e){return e+"="+t.cookie[e]}).join("; ").trim()}},{key:"renderPreview",value:function(){var e=this;return(0,P.jsx)(w.default,{onLogin:this.onPreviewLogin,onTour:function(){return(0,x.confirm)("将使用开发者的测试账号, 提供大部分功能预览, 确定"+T.default.login()+"? (可以在设置里面退出"+T.default.login()+")",e.onTour,"提示")}})}},{key:"renderForm",value:function(){var t=this,e=this.props.navigation,s=this.state,n=s.host,o=s.email,r=s.password,i=s.captcha,a=s.base64,l=s.isCommonUA,d=s.loading,u=s.info,s=s.failed;return(0,P.jsx)(C.default,{forwardRef:function(e){return t.codeRef=e},navigation:e,email:o,password:r,captcha:i,base64:a,isCommonUA:l,loading:d,info:u,host:n,failed:s,onGetCaptcha:this.getCaptcha,onBlur:this.onBlur,onFocus:this.onFocus,onChange:this.onChange,onSelect:this.onSelect,onUAChange:this.onUAChange,onLogin:this.onLogin})}},{key:"renderContent",value:function(){var e=this,t=this.state,s=t.clicked,t=t.focus;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(p.default,{style:_._.container.flex,children:s?this.renderForm():this.renderPreview()}),s?!t&&(0,P.jsx)(p.default,{style:this.styles.ps,children:(0,P.jsxs)(y.Text,{size:12,lineHeight:14,type:"sub",children:["隐私策略: 我们十分尊重您的隐私, 我们不会收集上述信息. (多次",T.default.login(),"失败后可能一段时间内不能再次",T.default.login(),")"]})}):(0,P.jsxs)(y.Flex,{style:this.styles.old,justify:"around",children:[!k.STORYBOOK&&(0,P.jsxs)(y.Touchable,{onPress:function(){(0,v.t)("登陆.跳转",{to:"Signup"}),(0,x.confirm)("声明: 本APP的性质为第三方，只提供显示数据和简单的操作，没有修复和改变源站业务的能力。 \n\n在移动端浏览器注册会经常遇到验证码错误，碰到错误建议在浏览器里使用 [电脑版UA]，再不行推荐使用电脑Chrome注册。 \n\n注册后会有 [激活码] 发到邮箱，测试过只会发送一次，请务必在激活有效时间内激活，否则这个注册账号就废了。输入激活码前，看见下方的文字改变了再填入，提示服务不可用的请务必等到浏览器加载条完成，不然永远都会说激活码错误。\n\n作者只能帮大家到这里了。",function(){return(0,x.open)(k.HOST+"/signup")},"提示",function(){},"前往注册")},children:[(0,P.jsxs)(y.Flex,{justify:"center",children:[(0,P.jsx)(y.Text,{size:11,type:"sub",bold:!0,children:"注册"}),(0,P.jsx)(y.Iconfont,{style:_._.ml.xxs,name:"md-open-in-new",color:_._.colorSub,size:12})]}),(0,P.jsx)(y.Heatmap,{id:"登陆.跳转",to:"Signup",alias:"注册"})]}),(0,P.jsxs)(y.Touchable,{onPress:function(){(0,v.t)("登陆.跳转",{to:"Privacy"}),(0,x.open)(k.URL_PRIVACY)},children:[(0,P.jsxs)(y.Flex,{justify:"center",children:[(0,P.jsx)(y.Text,{size:11,type:"sub",bold:!0,children:"隐私保护政策"}),(0,P.jsx)(y.Iconfont,{style:_._.ml.xxs,name:"md-open-in-new",color:_._.colorSub,size:12})]}),(0,P.jsx)(y.Heatmap,{id:"登陆.跳转",to:"Privacy",alias:"隐私保护政策"})]}),!k.STORYBOOK&&(0,P.jsxs)(y.Text,{size:11,bold:!0,type:"sub",onPress:function(){(0,v.t)("登陆.跳转",{to:"LoginAssist"}),e.props.navigation.push("LoginAssist")},children:["辅助",T.default.login(),(0,P.jsx)(y.Heatmap,{id:"登陆.跳转",to:"LoginAssist",alias:"辅助登录"})]})]})]})}},{key:"render",value:function(){return(0,P.jsxs)(y.Component,{id:"screen-login-v2",style:_._.container.plain,children:[(0,P.jsx)(y.UM,{title:O.TITLE}),(0,P.jsx)(j.StatusBarPlaceholder,{}),k.STORYBOOK&&(0,P.jsxs)(j.Notice,{style:_._.mv.lg,children:["当前网页版",T.default.login(),"功能尚未实装，本页面仅供查看使用"]}),this.renderContent(),(0,P.jsx)(y.KeyboardSpacer,{topSpacing:_._.ios(-120,0)}),(0,P.jsx)(y.Heatmap,{id:"登陆.登陆",right:_._.wind,bottom:_._.bottom+120,transparent:!0}),(0,P.jsx)(y.Heatmap,{id:"登陆.成功",right:_._.wind,bottom:_._.bottom+86,transparent:!0}),(0,P.jsx)(y.Heatmap,{id:"登陆.错误",right:_._.wind,bottom:_._.bottom+52,transparent:!0}),(0,P.jsx)(y.Heatmap,{id:"登陆",screen:"Login"})]})}},{key:"styles",get:function(){return(0,R.memoStyles)()}}]);var U,E,s=I;function I(){var r;(0,a.default)(this,I);for(var t,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return r=E.call.apply(E,[this].concat(s)),(0,f.default)((0,l.default)(r),"state",{host:k.STORYBOOK?A.HOST_PROXY:k.HOST,clicked:!1,email:"",password:"",captcha:"",base64:"",isCommonUA:!1,loading:!1,info:"",focus:!1,failed:!1}),(0,f.default)((0,l.default)(r),"userAgent",""),(0,f.default)((0,l.default)(r),"formhash",""),(0,f.default)((0,l.default)(r),"lastCaptcha",""),(0,f.default)((0,l.default)(r),"cookie",{}),(0,f.default)((0,l.default)(r),"code",""),(0,f.default)((0,l.default)(r),"accessToken",{}),(0,f.default)((0,l.default)(r),"retryCount",0),(0,f.default)((0,l.default)(r),"codeRef",null),(0,f.default)((0,l.default)(r),"onTour",(0,o.default)(i.mark(function e(){var t,s;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(0,v.t)("登陆.游客访问"),e.prev=1,(0,x.info)("正在从github获取游客cookie..."),e.next=5,(0,v.xhrCustom)({url:O.URL_TOURIST});case 5:t=e.sent,t=t._response,t=JSON.parse(t),s=t.accessToken,t=t.userCookie,_.userStore.updateAccessToken(s),s=r.props.navigation,_.userStore.updateUserCookie({cookie:t.cookie,userAgent:t.userAgent,v:0,tourist:1}),(0,x.info)(T.default.login()+"成功, 正在请求个人信息...",6),_.userStore.fetchUserInfo(),_.userStore.fetchUsersInfo(),(0,x.feedback)(),s.popToTop(),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),console.error(O.NAMESPACE,"onTour",e.t0),(0,x.info)(T.default.login()+"状态过期, 请稍后再试");case 22:case"end":return e.stop()}},e,null,[[1,18]])}))),(0,f.default)((0,l.default)(r),"onPreviewLogin",function(){r.setState({clicked:!0})}),(0,f.default)((0,l.default)(r),"loginFail",(t=(0,o.default)(i.mark(function e(t){return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(0,v.t)("登陆.错误"),r.setState({loading:!1,info:t,failed:!0}),r.reset();case 3:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})),(0,f.default)((0,l.default)(r),"onLogin",(0,o.default)(i.mark(function e(){var t,s,n,o;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.state,t=n.email,s=n.password,n=n.captcha,t&&s&&n){e.next=4;break}return(0,x.info)("请填写以上字段"),e.abrupt("return");case 4:if(e.prev=4,r.lastCaptcha!==n)return(0,v.t)("登陆.登陆"),"function"==typeof(null==(o=(0,l.default)(r))||null==(o=o.codeRef)||null==(o=o.inputRef)?void 0:o.blur)&&r.codeRef.inputRef.blur(),(0,x.setStorage)(O.NAMESPACE+"|email",t),e.next=11,r.login();e.next=21;break;case 11:if(r.cookie.chii_auth){e.next=14;break}return r.loginFail("验证码或密码错误，稍会再重试或前往授权"+T.default.login()+" →"),e.abrupt("return");case 14:return r.lastCaptcha=n,e.next=17,r.oauth();case 17:return e.next=19,r.authorize();case 19:e.next=23;break;case 21:r.setState({info:"重试 (4/5)"}),r.retryCount+=1;case 23:return e.next=25,r.getAccessToken();case 25:(0,x.setStorage)(O.NAMESPACE+"|password",s),r.inStore(),e.next=37;break;case 29:if(e.prev=29,e.t0=e.catch(4),r.retryCount+=1,r.retryCount>=O.AUTH_RETRY_COUNT)return r.loginFail("["+String(e.t0)+"] "+T.default.login()+"失败，请重试或重启APP，或点击前往旧版授权"+T.default.login()+" →"),e.abrupt("return");e.next=35;break;case 35:console.error("login/v2/index.js","onLogin",e.t0),r.onLogin();case 37:case"end":return e.stop()}},e,null,[[4,29]])}))),(0,f.default)((0,l.default)(r),"getUA",(0,o.default)(i.mark(function e(){var t;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.state.isCommonUA)return t=O.UA_EKIBUN_BANGUMI_APP,r.userAgent=t,e.abrupt("return",t);e.next=5;break;case 5:return e.next=7,g.default.getWebViewUserAgentAsync();case 7:return t=e.sent,r.userAgent=k.STORYBOOK?t:t+" "+(0,x.getTimestamp)(),e.abrupt("return",t);case 10:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"getHeaders",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t={};return e.includes("User-Agent")&&(t[k.STORYBOOK?"X-User-Agent":"User-Agent"]=r.userAgent),e.includes("Cookie")&&(t[k.STORYBOOK?"X-Cookie":"Cookie"]=r.cookieString),e.includes("Content-Type")&&(t["Content-Type"]="application/x-www-form-urlencoded"),t}),(0,f.default)((0,l.default)(r),"getCookies",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r.updateCookie(k.STORYBOOK?null==e?void 0:e["x-set-cookie"]:null==e||null==(e=e["set-cookie"])?void 0:e[0])}),(0,f.default)((0,l.default)(r),"getFormHash",(0,o.default)(i.mark(function e(){var t,s,n;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.state.host,S.default.defaults.withCredentials=!1,e.next=4,(0,S.default)({method:"get",url:t+"/login",headers:r.getHeaders(["User-Agent"])});case 4:return t=e.sent,s=t.data,n=t.headers,r.getCookies(n),(n=s.match(/<input type="hidden" name="formhash" value="(.+?)">/))&&(r.formhash=n[1]),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"getCaptcha",(0,o.default)(i.mark(function e(){var t,s;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({base64:""}),t=r.state.host,S.default.defaults.withCredentials=!1,e.next=5,(0,S.default)({method:"get",url:t+"/signup/captcha?"+(0,x.getTimestamp)(),headers:r.getHeaders(["User-Agent","Cookie"]),responseType:"arraybuffer"});case 5:return t=e.sent,s=t.request,s=k.STORYBOOK?btoa(String.fromCharCode.apply(null,new Uint8Array(s.response))):s._response,r.setState({base64:"data:image/gif;base64,"+s,captcha:""}),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"login",(0,o.default)(i.mark(function e(){var t,s,n,o;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({loading:!0,info:T.default.login()+"请求中...(1/5)"}),t=r.state,s=t.host,n=t.email,o=t.password,t=t.captcha,S.default.defaults.withCredentials=!1,e.next=5,(0,S.default)({method:"post",url:s+"/FollowTheRabbit",headers:r.getHeaders(["User-Agent","Cookie","Content-Type"]),data:(0,x.urlStringify)({formhash:r.formhash,referer:"",dreferer:"",email:n,password:o,captcha_challenge_field:t,loginsubmit:"登录"})});case 5:return s=e.sent,n=s.data,o=s.headers,n.includes("分钟内您将不能登录本站")?(0,x.info)("累计 5 次错误尝试，15 分钟内您将不能"+T.default.login()+"本站。"):r.getCookies(o),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"oauth",(0,o.default)(i.mark(function e(){var t,s;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({info:"获取授权表单码...(2/5)"}),t=r.state.host,S.default.defaults.withCredentials=!1,e.next=5,(0,S.default)({method:"get",url:t+"/oauth/authorize?client_id="+k.APP_ID+"&response_type=code&redirect_uri="+k.URL_OAUTH_REDIRECT,headers:r.getHeaders(["User-Agent","Cookie"])});case 5:return t=e.sent,s=t.data,r.formhash=h.default.load(s)("input[name=formhash]").attr("value"),e.abrupt("return",!0);case 9:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"authorize",(0,o.default)(i.mark(function e(){var t,s;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({info:"授权中...(3/5)"}),t=r.state.host,S.default.defaults.withCredentials=!1,e.next=5,(0,S.default)({method:"post",maxRedirects:0,validateStatus:null,url:t+"/oauth/authorize?client_id="+k.APP_ID+"&response_type=code&redirect_uri="+k.URL_OAUTH_REDIRECT,headers:r.getHeaders(["User-Agent","Cookie","Content-Type"]),data:(0,x.urlStringify)({formhash:r.formhash,redirect_uri:"",client_id:k.APP_ID,submit:"授权"})});case 5:return t=e.sent,s=t.request,r.code=null==s||null==(s=s.responseURL)?void 0:s.split("=").slice(1).join("="),e.abrupt("return",!0);case 9:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"getAccessToken",(0,o.default)(i.mark(function e(){var t,s,n;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({info:"授权成功, 获取token中...(4/5)"}),t=r.state.host,S.default.defaults.withCredentials=!1,e.next=5,(0,S.default)({method:"post",maxRedirects:0,validateStatus:null,url:t+"/oauth/access_token",headers:r.getHeaders(["User-Agent","Content-Type"]),data:(0,x.urlStringify)({grant_type:"authorization_code",client_id:k.APP_ID,client_secret:k.APP_SECRET,code:r.code,redirect_uri:k.URL_OAUTH_REDIRECT,state:(0,x.getTimestamp)()})});case 5:if(t=e.sent,s=t.status,n=t.data,200!==s)throw new TypeError(s);e.next=10;break;case 10:return r.accessToken=n,e.abrupt("return",!0);case 12:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"updateCookie",function(){var s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";["__cfduid","chii_sid","chii_sec_id","chii_cookietime","chii_auth"].forEach(function(e){var t=new RegExp(e+"=(.+?);"),t=s.match(t);t&&(r.cookie[e]=t[1])})}),(0,f.default)((0,l.default)(r),"inStore",(0,o.default)(i.mark(function e(){var t;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.setState({info:T.default.login()+"成功, 正在请求个人信息...(5/5)"}),t=r.props.navigation,_.userStore.updateUserCookie({cookie:r.cookieString,userAgent:r.userAgent,v:0}),_.userStore.updateAccessToken(r.accessToken),(0,x.feedback)(),t.popToTop(),(0,v.t)("登陆.成功"),(0,v.queue)([function(){return _.userStore.fetchUserInfo()},function(){return _.userStore.fetchUsersInfo()},function(){return _.usersStore.fetchFriends()},function(){return _.rakuenStore.downloadFavorTopic()}],1);case 8:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"reset",(0,o.default)(i.mark(function e(){return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.cookie={},r.setState({base64:""}),r.retryCount=0,e.next=5,r.getUA();case 5:return e.next=7,r.getFormHash();case 7:return e.next=9,r.getCaptcha();case 9:case"end":return e.stop()}},e)}))),(0,f.default)((0,l.default)(r),"onFocus",function(){r.setState({focus:!0})}),(0,f.default)((0,l.default)(r),"onBlur",function(){r.setState({focus:!1})}),(0,f.default)((0,l.default)(r),"onChange",function(e,t){var s,e=e.nativeEvent.text;r.setState(((0,f.default)(s={},t,e),(0,f.default)(s,"info",""),s))}),(0,f.default)((0,l.default)(r),"onSelect",function(e){(0,x.setStorage)(O.NAMESPACE+"|host",e),r.setState({host:e},function(){(0,v.t)("登陆.切换域名",{host:e}),r.reset()})}),(0,f.default)((0,l.default)(r),"onUAChange",function(){var e=!r.state.isCommonUA;(0,x.setStorage)(O.NAMESPACE+"|isCommonUA",e),r.setState({isCommonUA:e}),r.reset()}),r}t.default=(0,b.ob)(s);try{v2.displayName="v2",v2.__docgenInfo={description:"",displayName:"v2",props:{navigation:{defaultValue:null,description:"",name:"navigation",required:!0,type:{name:"Navigation"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/v2/index.tsx#v2"]={docgenInfo:v2.__docgenInfo,name:"v2",path:"src/screens/login/v2/index.tsx#v2"})}catch(e){}},"./src/screens/login/v2/preview/index.tsx":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(s("./node_modules/react/index.js")),n(s("./node_modules/react-native-web/dist/exports/View/index.js"))),r=s("./src/components/index.ts"),i=s("./src/stores/index.ts"),a=s("./src/utils/index.ts"),l=s("./src/utils/decorators/index.ts"),d=s("./src/constants/index.ts"),u=n(s("./src/constants/i18n/index.ts")),c=s("./src/screens/login/v2/preview/styles.ts"),f=s("./node_modules/react/jsx-runtime.js");t.default=(0,l.ob)(function(e){var t=void 0===(t=e.onLogin)?function(){}:t,e=void 0===(e=e.onTour)?function(){}:e,s=d.STORYBOOK?r.Page:o.default;return(0,f.jsxs)(s,{style:i._.container.column,children:[(0,f.jsx)(r.Mesume,{}),(0,f.jsxs)(o.default,{style:c.styles.bottomContainer,children:[(0,f.jsxs)(r.Button,{type:"main",shadow:!0,onPress:t,children:[d.STORYBOOK?"":"账号",u.default.login()]}),(0,f.jsxs)(o.default,{style:i._.mt.md,children:[d.STORYBOOK?(0,f.jsx)(r.Button,{type:"plain",shadow:!0,onPress:function(){(0,a.open)(d.HOST+"/signup")},children:"注册"}):(0,f.jsx)(r.Button,{type:"plain",shadow:!0,onPress:e,children:"游客预览"}),(0,f.jsx)(r.Heatmap,{id:"登陆.游客访问"})]})]})]})});try{preview.displayName="preview",preview.__docgenInfo={description:"",displayName:"preview",props:{onLogin:{defaultValue:null,description:"",name:"onLogin",required:!1,type:{name:"() => void"}},onTour:{defaultValue:null,description:"",name:"onTour",required:!1,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/v2/preview/index.tsx#preview"]={docgenInfo:preview.__docgenInfo,name:"preview",path:"src/screens/login/v2/preview/index.tsx#preview"})}catch(e){}},"./src/screens/login/v2/preview/styles.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;s=s("./src/stores/index.ts");t.styles=s._.create({bottomContainer:{width:s._.r(300),height:400,marginTop:s._.lg}})},"./src/screens/login/v2/styles.ts":(e,t,s)=>{s("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.memoStyles=void 0;var n=s("./src/stores/index.ts");t.memoStyles=n._.memoStyles(function(){return{old:{position:"absolute",zIndex:1,bottom:n._.bottom,left:n._.wind,right:n._.wind,padding:n._.sm},ps:{position:"absolute",right:2*n._.wind,bottom:n._.bottom,left:2*n._.wind},border:{borderLeftWidth:1,borderColor:n._.colorBorder}}})}}]);