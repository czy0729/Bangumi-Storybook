(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3574],{"./src/screens/login/token/index.tsx":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.weak-map.js"),t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.string.iterator.js"),t("./node_modules/core-js/modules/es.array.iterator.js"),t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),t("./node_modules/core-js/modules/es.object.assign.js");var n=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o=n(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),c=n(t("./node_modules/@babel/runtime/helpers/slicedToArray.js")),i=function(e,s){if(!s&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=b(s);if(t&&t.has(e))return t.get(e);var r={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=n?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(r,o,c):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}(t("./node_modules/react/index.js")),d=n(t("./node_modules/react-native-web/dist/exports/View/index.js")),a=t("./node_modules/mobx-react/dist/mobxreact.esm.js"),l=t("./src/components/index.ts"),u=t("./src/stores/index.ts"),p=t("./src/utils/index.ts"),m=t("./src/utils/fetch.v0/index.ts"),j=t("./src/utils/hooks/index.ts"),f=t("./src/screens/login/token/styles.ts"),_=t("./node_modules/react/jsx-runtime.js");function b(e){if("function"!=typeof WeakMap)return null;var s=new WeakMap,t=new WeakMap;return(b=function(e){return e?t:s})(e)}s.default=function(){var e=(0,i.useState)(""),s=(0,c.default)(e,2),t=s[0],n=s[1],b=(0,i.useCallback)((0,o.default)(r.mark((function e(){var s,o,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return(0,p.info)("已清除鉴权信息"),u.userStore.updateAccessToken({access_token:"",expires_in:604800,token_type:"Bearer",scope:null,user_id:0,refresh_token:""}),e.abrupt("return");case 4:return s=Object.assign({},u.userStore.accessToken),o={access_token:t,expires_in:604800,token_type:"Bearer",scope:null,user_id:0,refresh_token:""},u.userStore.updateAccessToken(o),e.next=9,(0,m.fetchMeV0)();case 9:if(null==(c=e.sent)||!c.id||null==c||!c.username){e.next=16;break}return(0,p.info)("更新成功"),u.userStore.updateUserInfo(Object.assign({},c,{_loaded:(0,p.getTimestamp)()})),u.userStore.updateAccessToken(Object.assign({},o,{user_id:c.id})),u.collectionStore.clearState("_collectionStatusLastFetchMS"),e.abrupt("return");case 16:(0,p.info)("更新失败，请确保用户令牌可用"),u.userStore.updateAccessToken(s),n(s.access_token);case 19:case"end":return e.stop()}}),e)}))),[t]);return(0,j.useMount)((function(){n(u.userStore.accessToken.access_token)})),(0,a.useObserver)((function(){var e=u.userStore.userInfo,s=e.avatar,r=e.nickname,o=e.username;return(0,_.jsxs)(l.Component,{id:"screen-login-token",children:[(0,_.jsx)(l.Header,{title:" "}),(0,_.jsx)(l.Page,{children:(0,_.jsxs)(l.Flex,{style:f.styles.container,direction:"column",justify:"center",children:[null!=s&&s.large&&r?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(l.Avatar,{src:s.large,size:96,round:!0}),(0,_.jsxs)(l.Text,{style:u._.mt.sm,size:16,bold:!0,children:[r," @",o]})]}):(0,_.jsx)(l.Mesume,{}),(0,_.jsx)(d.default,{style:f.styles.item,children:(0,_.jsx)(l.Input,{style:f.styles.input,placeholder:"用户令牌，必填",value:t,onChangeText:n})}),(0,_.jsx)(l.Touchable,{style:u._.mt.md,onPress:b,children:(0,_.jsxs)(l.Flex,{children:[(0,_.jsx)(l.Text,{type:"sub",size:16,bold:!0,children:"更新"}),(0,_.jsx)(l.Flex,{style:f.styles.arrow,children:(0,_.jsx)(l.Iconfont,{name:"md-arrow-forward",size:14})})]})})]})})]})}))};try{token.displayName="token",token.__docgenInfo={description:"SPA 网页版更新授权",displayName:"token",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/login/token/index.tsx#token"]={docgenInfo:token.__docgenInfo,name:"token",path:"src/screens/login/token/index.tsx#token"})}catch(e){}},"./src/screens/login/token/styles.ts":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.assign.js"),Object.defineProperty(s,"__esModule",{value:!0}),s.styles=void 0;var r=t("./src/stores/index.ts");s.styles=r._.create({container:{minHeight:.72*r._.window.height,paddingHorizontal:48},item:{width:"100%"},input:Object.assign({height:40,marginTop:48,paddingVertical:0,textAlign:"center"},r._.fontSize14,{borderRadius:20}),arrow:{padding:2,marginLeft:r._.sm,borderWidth:2,borderColor:r._.colorIcon,borderRadius:20}})}}]);