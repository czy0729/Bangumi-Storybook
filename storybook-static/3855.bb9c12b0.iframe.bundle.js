(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3855],{"./src/screens/tinygrail/_/item-advance/index.tsx":(e,t,r)=>{r("./node_modules/core-js/modules/es.object.define-property.js"),r("./node_modules/core-js/modules/es.function.name.js"),r("./node_modules/core-js/modules/es.object.assign.js"),r("./node_modules/core-js/modules/es.array.flat.js"),r("./node_modules/core-js/modules/es.parse-int.js"),r("./node_modules/core-js/modules/es.number.to-fixed.js"),r("./node_modules/core-js/modules/es.number.constructor.js");var s=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;s(r("react"));var o=s(r("./node_modules/react-native-web/dist/exports/View/index.js")),n=r("./node_modules/mobx-react/dist/mobxreact.esm.js"),i=s(r("./node_modules/prop-types/index.js")),a=r("./src/components/index.ts"),l=r("./src/stores/index.ts"),c=r("./src/utils/index.ts"),d=r("./src/utils/app/index.ts"),u=r("./src/utils/fetch/index.ts"),p=r("./src/constants/index.ts"),m=s(r("./src/screens/tinygrail/_/rank/index.tsx")),f=r("./src/screens/tinygrail/_/utils.ts"),y=r("./src/screens/tinygrail/_/item-advance/styles.ts"),j=r("./node_modules/react/jsx-runtime.js");function v(e,t){var r=t.navigation,s=(0,y.memoStyles)(),n=e.event,i=void 0===n?p.EVENT:n,v=e.assets,h=e.index,b=e.id,x=e.name,g=e.icon,_=e.bonus,T=e.level,A=e.amount,O=e.current,w=e.firstAsks,P=e.firstBids,S=e.firstAmount,k=e.rate,L=e.rank,C=e.stars,M=e.mark,R=e.isAuctioning,D=i.id,I=i.data,z=!P&&!w,F=!!P,B=0===h;return(0,j.jsxs)(a.Flex,{style:s.container,align:"start",children:[(0,j.jsx)(o.default,{style:l._.mt.md,children:(0,j.jsx)(a.Avatar,{src:(0,d.tinygrailOSS)(g),name:x,borderColor:"transparent",skeletonType:"tinygrail",onPress:function(){(0,u.t)(D,Object.assign({to:"Mono",monoId:b},I)),r.push("Mono",{monoId:"character/"+b,_name:x})}})}),(0,j.jsx)(a.Flex.Item,{style:!B&&!l._.flat&&s.border,children:(0,j.jsx)(a.Touchable,{style:s.item,onPress:function(){if(z)return(0,u.t)(D,Object.assign({to:"TinygrailSacrifice",monoId:b},I)),void r.push("TinygrailSacrifice",{monoId:"character/"+b});(0,u.t)(D,Object.assign({to:"TinygrailDeal",monoId:b},I)),r.push("TinygrailDeal",{monoId:"character/"+b,type:F?"ask":"bid"})},children:(0,j.jsxs)(a.Flex,{children:[(0,j.jsxs)(a.Flex.Item,{children:[(0,j.jsxs)(a.Flex,{children:[(0,j.jsx)(m.default,{value:L}),(0,j.jsx)(a.Flex.Item,{children:(0,j.jsxs)(a.Text,{type:"tinygrailPlain",size:x.length>16?13:x.length>13?14:15,lineHeight:15,bold:!0,children:[h+1,". ",x,!!_&&(0,j.jsxs)(a.Text,{size:12,lineHeight:15,type:"warning",children:[" ","x",_]}),parseInt(T)>1&&(0,j.jsxs)(a.Text,{type:"ask",size:12,lineHeight:15,children:[" ","lv",T]})]})})]}),(0,j.jsxs)(a.Text,{style:l._.mt.xs,type:"tinygrailText",size:12,children:[!!A&&(0,j.jsxs)(a.Text,{type:"warning",size:12,bold:!0,children:[A,"股"]}),!!A&&" / ",!!S&&(0,j.jsxs)(a.Text,{type:F?"bid":"ask",size:12,bold:!0,children:[F&&"收",S,"股"]}),v&&(0,j.jsxs)(a.Text,{type:"bid",size:12,children:[v.state||"-"," (",v.sacrifices||"-",")"]}),v&&" / ",!!S&&" / ","₵",(0,c.toFixed)(w||P||O,2)," / +",(0,c.toFixed)(k,1)," (",Number((0,c.toFixed)((0,f.calculateRate)(k,L,C),1)),")"]})]}),R&&(0,j.jsxs)(a.Text,{style:l._.ml.sm,type:"bid",children:[" ","[竞拍中]"]}),(0,j.jsx)(a.Text,{style:l._.ml.md,type:"tinygrailPlain",size:16,children:M})]})})})]})}v.contextTypes={navigation:i.default.object};t.default=(0,n.observer)(v)},"./src/screens/tinygrail/_/item-advance/styles.ts":(e,t,r)=>{r("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"__esModule",{value:!0}),t.memoStyles=void 0;var s=r("./src/stores/index.ts");t.memoStyles=s._.memoStyles((function(){return{container:{paddingLeft:s._.wind,backgroundColor:s._.colorTinygrailContainer},active:{backgroundColor:s._.colorTinygrailActive},item:{paddingVertical:s._.md,paddingRight:s._.wind,paddingLeft:s._.sm},border:{borderTopColor:s._.colorTinygrailBorder,borderTopWidth:s._.hairlineWidth}}}))},"./src/screens/tinygrail/advance-auction/index.tsx":(e,t,r)=>{r("./node_modules/core-js/modules/es.object.define-property.js"),r("./node_modules/core-js/modules/es.weak-map.js"),r("./node_modules/core-js/modules/es.object.to-string.js"),r("./node_modules/core-js/modules/es.string.iterator.js"),r("./node_modules/core-js/modules/es.array.iterator.js"),r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),r("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("./node_modules/core-js/modules/es.reflect.construct.js"),r("./node_modules/core-js/modules/es.array.sort.js");var s=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),n=s(r("./node_modules/@babel/runtime/helpers/createClass.js")),i=s(r("./node_modules/@babel/runtime/helpers/inherits.js")),a=s(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),l=s(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),c=s(r("react")),d=r("./src/components/index.ts"),u=r("./src/screens/_/index.ts"),p=r("./src/stores/index.ts"),m=r("./src/utils/index.ts"),f=r("./src/utils/decorators/index.ts"),y=r("./src/utils/fetch/index.ts"),j=s(r("./src/screens/tinygrail/_/tool-bar/index.tsx")),v=s(r("./src/screens/tinygrail/advance-auction/list/index.tsx")),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=x(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(s,n,i):s[n]=e[n]}return s.default=e,r&&r.set(e,s),s}(r("./src/screens/tinygrail/advance-auction/store.ts")),b=r("./node_modules/react/jsx-runtime.js");function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(x=function(e){return e?r:t})(e)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,s=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(s,arguments,o)}else r=s.apply(this,arguments);return(0,a.default)(this,r)}}var _=function(e){(0,i.default)(r,e);var t=g(r);function r(){return(0,o.default)(this,r),t.apply(this,arguments)}return(0,n.default)(r,[{key:"componentDidMount",value:function(){this.context.$.init()}},{key:"render",value:function(){var e=this.context.$,t=e.state,r=t.level,s=t.sort;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Header,{title:"拍卖推荐",hm:["tinygrail/advance-auction","TinygrailAdvanceAuction"],statusBarEvents:!1,statusBarEventsType:"Tinygrail",headerRight:function(){return(0,b.jsx)(u.IconHeader,{name:"md-info-outline",color:p._.colorTinygrailPlain,onPress:function(){(0,y.t)("竞拍推荐.提示",{type:1}),(0,m.alert)("从英灵殿里面查找前 2000 条\n可竞拍数量 > 80, \n实时股息 / 竞拍底价 * 100 = 分数","当前计算方式")}})}}),(0,b.jsxs)(d.Page,{style:p._.container.tinygrail,children:[(0,b.jsx)(j.default,{level:r,levelMap:e.levelMap,data:h.sortDS,sort:s,direction:s?"down":void 0,onLevelSelect:e.onLevelSelect,onSortPress:e.onSortPress}),(0,b.jsx)(v.default,{})]})]})}}]),r}(c.default.Component);t.default=(0,f.inject)(h.default)((0,f.obc)(_))},"./src/screens/tinygrail/advance-auction/list/index.tsx":(e,t,r)=>{r("./node_modules/core-js/modules/es.object.define-property.js"),r("./node_modules/core-js/modules/es.object.assign.js");var s=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;s(r("react"));var o=r("./src/components/index.ts"),n=r("./src/stores/index.ts"),i=r("./src/utils/index.ts"),a=r("./src/utils/decorators/index.ts"),l=s(r("./src/screens/tinygrail/_/item-advance/index.tsx")),c=r("./node_modules/react/jsx-runtime.js");t.default=(0,a.obc)((function(e,t){var r=t.$;if(!r.computedList._loaded)return(0,c.jsx)(o.Loading,{style:n._.container.flex,color:n._.colorTinygrailText});var s={id:"竞拍推荐.跳转",data:{userId:r.myUserId,type:1}};return(0,c.jsx)(o.ListView,{style:n._.container.flex,contentContainerStyle:n._.container.bottom,keyExtractor:i.keyExtractor,refreshControlProps:{color:n._.colorTinygrailText},footerTextType:"tinygrailText",data:r.computedList,windowSize:6,initialNumToRender:24,maxToRenderPerBatch:24,updateCellsBatchingPeriod:24,lazy:24,scrollToTop:!0,renderItem:function(e){var t=e.item,o=e.index;return(0,c.jsx)(l.default,Object.assign({index:t._index||o,event:s,isAuctioning:r.auctioningMap[t.id],assets:r.myCharaAssetsMap[t.id]},t))},onHeaderRefresh:r.fetchAdvanceAuctionList})}))},"./src/screens/tinygrail/advance-auction/store.ts":(e,t,r)=>{var s=r("./node_modules/@babel/runtime/regenerator/index.js");r("./node_modules/core-js/modules/es.object.define-property.js"),r("./node_modules/core-js/modules/es.reflect.construct.js"),r("./node_modules/core-js/modules/es.array.concat.js"),r("./node_modules/core-js/modules/es.number.constructor.js"),r("./node_modules/core-js/modules/es.array.sort.js"),r("./node_modules/core-js/modules/es.object.assign.js"),r("./node_modules/core-js/modules/es.array.for-each.js"),r("./node_modules/core-js/modules/web.dom-collections.for-each.js"),r("./node_modules/core-js/modules/es.array.filter.js"),r("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var o=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.sortDS=t.default=void 0;var n,i=o(r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),a=o(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),l=o(r("./node_modules/@babel/runtime/helpers/createClass.js")),c=o(r("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),d=o(r("./node_modules/@babel/runtime/helpers/inherits.js")),u=o(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),p=o(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),m=o(r("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=o(r("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),y=r("./node_modules/mobx/dist/mobx.esm.js"),j=r("./src/stores/index.ts"),v=r("./src/utils/index.ts"),h=o(r("./src/utils/store/index.ts")),b=r("./src/constants/index.ts"),x=r("./src/screens/tinygrail/_/utils.ts");function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,s=(0,p.default)(e);if(t){var o=(0,p.default)(this).constructor;r=Reflect.construct(s,arguments,o)}else r=s.apply(this,arguments);return(0,u.default)(this,r)}}t.sortDS=[x.SORT_GF],t.default=(n=function(e){(0,d.default)(r,e);var t=g(r);function r(){var e;(0,a.default)(this,r);for(var o=arguments.length,n=new Array(o),l=0;l<o;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n)),(0,m.default)((0,c.default)(e),"state",(0,y.observable)({level:"",sort:"",_loaded:!1})),(0,m.default)((0,c.default)(e),"init",(0,i.default)(s.mark((function t(){var r;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.advanceAuctionList._loaded,j.tinygrailStore.fetchAuction(),r||e.fetchAdvanceAuctionList(!1),e.fetchCharaAll();case 4:case"end":return t.stop()}}),t)})))),(0,m.default)((0,c.default)(e),"fetchAdvanceAuctionList",(function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=e.advanceAuctionList._loaded;return r?!e.advance&&(0,v.getTimestamp)()-Number(r)<14400?(t&&(0,v.info)("普通用户4小时内只能刷新一次"),!0):!b.DEV&&e.advance&&(0,v.getTimestamp)()-Number(r)<60?(t&&(0,v.info)("为避免服务器压力, 1分钟后再刷新吧"),!0):(j.tinygrailStore.fetchAuction(),j.tinygrailStore.fetchAdvanceAuctionList()):j.tinygrailStore.fetchAdvanceAuctionList()})),(0,m.default)((0,c.default)(e),"fetchCharaAll",(function(){return j.tinygrailStore.fetchCharaAll()})),(0,m.default)((0,c.default)(e),"onLevelSelect",(function(t){e.setState({level:t})})),(0,m.default)((0,c.default)(e),"onSortPress",(function(t){var r=e.state.sort;e.setState({sort:t===r?"":t}),e.setStorage("ScreenTinygrailAdvanceAuction")})),e}return(0,l.default)(r,[{key:"myUserId",get:function(){return j.userStore.myUserId}},{key:"advance",get:function(){return j.systemStore.advance}},{key:"advanceAuctionList",get:function(){return j.tinygrailStore.advanceAuctionList}},{key:"computedList",get:function(){var e=this.state,t=e.level,r=e.sort,s=this.advanceAuctionList;if(!s._loaded)return s;var o=s;return t&&(o=Object.assign({},o,{list:(0,x.levelList)(t,o.list)})),r&&(o=Object.assign({},o,{list:(0,x.sortList)(r,"down",o.list)})),o}},{key:"levelMap",get:function(){var e=this.advanceAuctionList.list,t={};return e.forEach((function(e){return t[e.level]?t[e.level]+=1:t[e.level]=1})),t}},{key:"auctioningMap",get:function(){var e={};return j.tinygrailStore.list("auction").list.filter((function(e){return 0===e.state})).forEach((function(t){return e[t.monoId]=!0})),e}},{key:"myCharaAssetsMap",get:function(){var e={};return j.tinygrailStore.charaAll().list.forEach((function(t){e[t.id]={state:t.state||0,sacrifices:t.sacrifices||0}})),e}}]),r}(h.default),(0,f.default)(n.prototype,"myUserId",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"myUserId"),n.prototype),(0,f.default)(n.prototype,"advance",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"advance"),n.prototype),(0,f.default)(n.prototype,"advanceAuctionList",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"advanceAuctionList"),n.prototype),(0,f.default)(n.prototype,"computedList",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"computedList"),n.prototype),(0,f.default)(n.prototype,"levelMap",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"levelMap"),n.prototype),(0,f.default)(n.prototype,"auctioningMap",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"auctioningMap"),n.prototype),(0,f.default)(n.prototype,"myCharaAssetsMap",[y.computed],Object.getOwnPropertyDescriptor(n.prototype,"myCharaAssetsMap"),n.prototype),n)}}]);