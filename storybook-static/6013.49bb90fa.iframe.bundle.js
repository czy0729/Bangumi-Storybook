(self.webpackChunkweb=self.webpackChunkweb||[]).push([[6013],{"./src/screens/discovery/guess/extra.js":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var n,o=t("./src/components/index.ts"),i=t("./src/screens/_/index.ts"),u=t("./src/utils/fetch/index.ts"),d=t("./src/utils/decorators/index.ts"),a=r(t("./src/screens/discovery/guess/type.js")),l=t("./node_modules/react/jsx-runtime.js");s.default=(0,d.ob)((function(e){var s=e.$;s&&(n=s.state.like);var t=void 0===(null==s?void 0:s.state.like)?n:null==s?void 0:s.state.like;return(0,l.jsxs)(o.Flex,{children:[(0,l.jsx)(a.default,{like:t,onChange:null==s?void 0:s.toggleLike},void 0===t),(0,l.jsx)(i.IconHeader,{name:"md-refresh",onPress:function(){(0,u.t)("推荐.刷新"),null!=s&&s.getList&&s.getList()}})]})}))},"./src/screens/discovery/guess/header.js":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var n=t("./src/components/index.ts"),o=t("./src/utils/decorators/index.ts"),i=r(t("./src/screens/discovery/guess/extra.js")),u=t("./node_modules/react/jsx-runtime.js");s.default=(0,o.obc)((function(e,s){var t=s.$;return(0,u.jsx)(n.Header,{title:"推荐",hm:["guess","Guess"],headerRight:function(){return(0,u.jsx)(i.default,{$:t})}})}))},"./src/screens/discovery/guess/index.js":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var n=t("./src/components/index.ts"),o=t("./src/utils/decorators/index.ts"),i=t("./src/utils/hooks/index.ts"),u=r(t("./src/screens/discovery/guess/header.js")),d=r(t("./src/screens/discovery/guess/list.js")),a=r(t("./src/screens/discovery/guess/store.js")),l=t("./node_modules/react/jsx-runtime.js");s.default=(0,o.ic)(a.default,(function(e,s){var t=s.$;return(0,i.useRunAfter)((function(){t.init()})),(0,i.useObserver)((function(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.default,{}),(0,l.jsx)(n.Page,{children:(0,l.jsx)(d.default,{})})]})}))}))},"./src/screens/discovery/guess/item.js":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.string.split.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var n=r(t("./node_modules/react-native-web/dist/exports/StyleSheet/index.js")),o=r(t("./node_modules/react-native-web/dist/exports/View/index.js")),i=t("./node_modules/expo-linear-gradient/build/LinearGradient.js"),u=t("./src/components/index.ts"),d=t("./src/screens/_/index.ts"),a=t("./src/stores/index.ts"),l=t("./src/utils/index.ts"),c=t("./src/utils/decorators/index.ts"),m=t("./src/utils/app/index.ts"),p=t("./src/utils/fetch/index.ts"),f=t("./src/utils/ui/index.ts"),j=t("./src/constants/index.ts"),b=t("./node_modules/react/jsx-runtime.js"),h=["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.24)","rgba(0, 0, 0, 0.64)","rgba(0, 0, 0, 0.92)"];s.default=(0,c.obc)((function(e,s){var t=e.id,r=e.ageId,c=e.image,v=e.cn,_=e.jp,x=e.begin,y=e.ep,w=e.official,S=e.rate,k=s.$,T=s.navigation,C=g(),O=k.state.eps[t],R=c?"//lain.bgm.tv/pic/cover/l/"+c+".jpg":j.IMG_DEFAULT,P=function(){(0,p.t)("推荐.跳转",{id:t}),T.push("Subject",{subjectId:t,_cn:v,_image:R,_aid:r})};return(0,b.jsxs)(o.default,{style:C.item,children:[(0,b.jsx)(d.Cover,{src:R,size:C.cover.width,height:C.cover.height,radius:a._.radiusMd,onPress:P}),(0,b.jsx)(i.LinearGradient,{colors:h,pointerEvents:"none",style:n.default.absoluteFill}),(0,b.jsxs)(o.default,{style:C.desc,children:[(0,b.jsx)(u.Text,{style:[C.title,a._.mr.sm],size:22,type:a._.select("plain","title"),bold:!0,onPress:P,children:(0,m.cnjp)(v,_)}),(0,b.jsxs)(u.Text,{style:[a._.mt.xs,a._.mr.sm],size:13,type:a._.select("plain","title"),bold:!0,onPress:P,children:[x," / ",w," [",String(y).replace(/\(完结\)|第/g,""),"] / 推荐分"," ",S]}),!!O&&(0,b.jsx)(u.HorizontalList,{style:a._.mt.md,data:O.epsThumbs,initialRenderNums:4,renderItem:function(e,s){return(0,b.jsx)(u.Image,{style:(0,l.stl)(!!s&&a._.ml.sm,s===O.epsThumbs.length-1&&a._.mr.md),src:e,size:C.thumb.width,height:C.thumb.height,radius:!0,headers:O.epsThumbsHeader,onPress:function(){(0,f.showImageViewer)(O.epsThumbs.map((function(e){return{url:e.split("@")[0],headers:O.epsThumbsHeader}})),s)}},e)}})]})]})}));var g=a._.memoStyles((function(){var e=a._.windowSm.width-2*a._.windSm,s=a._.device(128,200);return{item:{marginTop:a._.space,marginHorizontal:a._.windSm,borderRadius:a._.radiusMd,overflow:"hidden"},cover:{width:e,height:1.38*e},thumb:{width:s,height:.56*s},desc:{position:"absolute",zIndex:1,right:0,bottom:a._.md,left:a._.md},title:{opacity:.88}}}))},"./src/screens/discovery/guess/list.js":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.object.assign.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var n=r(t("./node_modules/react-native-web/dist/exports/View/index.js")),o=t("./src/components/index.ts"),i=t("./src/stores/index.ts"),u=t("./src/utils/decorators/index.ts"),d=r(t("./src/screens/discovery/guess/item.js")),a=t("./node_modules/react/jsx-runtime.js");s.default=(0,u.obc)((function(e,s){var t=s.$,r=t.state,u=r.page;return r.rendered?(0,a.jsxs)(o.ScrollView,{style:i._.mt._sm,contentContainerStyle:i._.container.bottom,scrollToTop:!0,children:[(0,a.jsx)(n.default,{style:l.container,children:t.list.map((function(e){return(0,a.jsx)(d.default,Object.assign({},e),e.id)}))}),(0,a.jsx)(o.Pagination,{style:i._.mt.md,input:String(u),onPrev:t.prev,onNext:t.next,onChange:t.onChange})]}):null}));var l=i._.create({container:{minHeight:i._.window.height}})},"./src/screens/discovery/guess/store.js":(e,s,t)=>{var r=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.object.assign.js"),t("./node_modules/core-js/modules/web.timers.js"),t("./node_modules/core-js/modules/es.number.is-nan.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.parse-int.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.string.match.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.array.from.js"),t("./node_modules/core-js/modules/es.string.iterator.js"),t("./node_modules/core-js/modules/es.set.js"),t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.array.iterator.js"),t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var o,i=n(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),u=n(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),d=n(t("./node_modules/@babel/runtime/helpers/createClass.js")),a=n(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),l=n(t("./node_modules/@babel/runtime/helpers/inherits.js")),c=n(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),m=n(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=n(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=n(t("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),j=t("./node_modules/mobx/dist/mobx.esm.js"),b=t("./src/stores/index.ts"),h=n(t("./src/utils/store/index.ts")),g=t("./src/utils/index.ts"),v=t("./src/utils/fetch/index.ts"),_=t("./src/utils/protobuf/index.web.ts"),x=t("./src/utils/subject/anime/index.ts");function y(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=(0,m.default)(e);if(s){var n=(0,m.default)(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return(0,c.default)(this,t)}}var w="ScreenGuess",S={rendered:!0};s.default=(o=function(e){(0,l.default)(t,e);var s=y(t);function t(){var e,n;(0,u.default)(this,t);for(var o=arguments.length,d=new Array(o),l=0;l<o;l++)d[l]=arguments[l];return e=s.call.apply(s,[this].concat(d)),(0,p.default)((0,a.default)(e),"state",(0,j.observable)(Object.assign({list:[],page:1,like:!0,eps:{}},S))),(0,p.default)((0,a.default)(e),"init",(0,i.default)(r.mark((function s(){var t;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.getStorage(void 0,w);case 2:t=s.sent,e.setState(Object.assign({},t,S)),e.state.list.length||e.getList();case 6:case"end":return s.stop()}}),s)})))),(0,p.default)((0,a.default)(e),"getList",(0,i.default)(r.mark((function s(){var t=arguments;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!(t.length>0&&void 0!==t[0])||t[0])){s.next=4;break}return s.next=4,b.collectionStore.fetchUserCollectionsQueue(!0,"动画",!0);case 4:setTimeout((function(){var s=e.state.like,t=(0,x.guess)(e.userCollectionsMap,!s);e.setState({list:t,page:1}),e.setStorage(void 0,void 0,w),e.queueFetchEpsThumbs()}),80);case 5:case"end":return s.stop()}}),s)})))),(0,p.default)((0,a.default)(e),"prev",(function(){var s=e.state.page;1!==s&&(e.setState({page:s-1,rendered:!1}),e.queueFetchEpsThumbs(),setTimeout((function(){e.setStorage(void 0,void 0,w),e.setState({rendered:!0})}),80))})),(0,p.default)((0,a.default)(e),"next",(function(){var s=e.state.page;e.setState({page:s+1,rendered:!1}),e.queueFetchEpsThumbs(),setTimeout((function(){e.setStorage(void 0,void 0,w),e.setState({rendered:!0})}),80)})),(0,p.default)((0,a.default)(e),"onChange",(function(s){var t=s.nativeEvent.text;Number.isNaN(parseInt(t))||(e.setState({page:parseInt(t),rendered:!1}),setTimeout((function(){e.setStorage(void 0,void 0,w),e.setState({rendered:!0})}),80))})),(0,p.default)((0,a.default)(e),"queueFetchEpsThumbs",(0,i.default)(r.mark((function s(){var t;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.state.list,s.next=3,(0,v.queue)(t.map((function(s){return function(){return e.fetchEpsThumbs(s.id)}})),1);case 3:setTimeout((function(){e.toggleLike(),setTimeout((function(){e.toggleLike()}),80)}),240);case 4:case"end":return s.stop()}}),s)})))),(0,p.default)((0,a.default)(e),"toggleLike",(function(){var s=e.state.like;e.setState({like:!s}),e.setStorage(void 0,void 0,w),setTimeout((function(){(0,g.info)("loading..."),e.getList(!1)}),80)})),(0,p.default)((0,a.default)(e),"fetchEpsThumbs",(n=(0,i.default)(r.mark((function s(t){var n,o,i,u,d,a,l,c,m,f,j,b,h,x,y,w,S,k,T,C,O,R,P,M,q,L,D,I,H,z,E,F,G,A;return r.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(!e.state.eps[t]){s.next=3;break}return s.abrupt("return",!0);case 3:if(s.prev=3,(n=((0,_.get)("bangumi-data")||[]).find((function(e){return e.id==t})))&&(c=(0,g.unzipBangumiData)(n),o={sites:c.sites,type:c.type},i=(null==(a=o)||null==(l=a.sites)?void 0:l.find((function(e){return"bilibili"===e.site})))||null,i||(u=(null==(m=o)||null==(f=m.sites)?void 0:f.find((function(e){return"youku"===e.site})))||null),u||(d=(null==(j=o)||null==(b=j.sites)?void 0:b.find((function(e){return"iqiyi"===e.site})))||null)),!i){s.next=24;break}return h=(0,g.getBangumiUrl)(i),s.next=10,(0,v.xhrCustom)({url:h});case 10:if(x=s.sent,y=x._response,!(w=y.match(/"season_id":(\d+)/))){s.next=24;break}return k=w[1],s.next=17,(0,v.xhrCustom)({url:"https://api.bilibili.com/pgc/web/season/section?season_id="+k});case 17:if(T=s.sent,C=T._response,O=JSON.parse(C),R=O.message,P=O.result,"success"!==R||null==P||null==(S=P.main_section)||!S.episodes){s.next=24;break}return e.setState({eps:Object.assign({},e.state.eps,(0,p.default)({},t,{epsThumbs:Array.from(new Set(P.main_section.episodes.map((function(e){return e.cover+"@192w_120h_1c.jpg"})))).filter((function(e,s){return s<=5})),epsThumbsHeader:{Referer:"https://www.bilibili.com/"}}))}),e.setStorage(void 0,void 0,e.namespace),s.abrupt("return",!0);case 24:if(!u){s.next=40;break}return M=(0,g.getBangumiUrl)(u),s.next=28,(0,v.xhrCustom)({url:M});case 28:if(q=s.sent,L=q._response,!(D=L.match(/showid:"(\d+)"/))){s.next=40;break}return I=D[1],s.next=35,(0,v.xhrCustom)({url:"https://list.youku.com/show/module?id="+I+"&tab=point&callback=jQuery"});case 35:return H=s.sent,z=H._response,e.setState({eps:Object.assign({},e.state.eps,(0,p.default)({},t,{epsThumbs:Array.from(new Set((decodeURIComponent(z).replace(/\\\/>/g,"/>").replace(/(\\"|"\\)/g,'"').match(/<img.+?src=('|")?([^'"]+)('|")?(?:\s+|>)/gim)||[]).map((function(e){var s=e.match(/src="(.+?)"/);return s?s[1].replace(/\\\//g,"/"):""})).filter((function(e){return!!e})))),epsThumbsHeader:{Referer:"https://list.youku.com/"}}))}),e.setStorage(void 0,void 0,e.namespace),s.abrupt("return",!0);case 40:if(!d){s.next=51;break}return E=(0,g.getBangumiUrl)(e.iqiyiSite),s.next=44,(0,v.xhrCustom)({url:E});case 44:if(F=s.sent,G=F._response,!(A=(0,v.HTMLTrim)(G,!0).match(/data-jpg-img="(.+?)"/g))){s.next=51;break}return e.setState({eps:Object.assign({},e.state.eps,(0,p.default)({},t,{epsThumbs:Array.from(new Set(A.map((function(e){return"https:"+e.replace(/(data-jpg-img="|")/g,"")})).filter((function(e,s){return!!s})))),epsThumbsHeader:{Referer:"https://www.iqiyi.com/"}}))}),e.setStorage(void 0,void 0,e.namespace),s.abrupt("return",!0);case 51:return e.setState({eps:Object.assign({},e.state.eps,(0,p.default)({},t,null))}),s.abrupt("return",!1);case 55:return s.prev=55,s.t0=s.catch(3),warn("Guess","fetchEpsThumbs",s.t0),s.abrupt("return",!1);case 59:case"end":return s.stop()}}),s,null,[[3,55]])}))),function(e){return n.apply(this,arguments)})),e}return(0,d.default)(t,[{key:"userCollectionsMap",get:function(){return b.collectionStore.userCollectionsMap}},{key:"list",get:function(){var e=this.state,s=e.page;return e.list.slice(10*(s-1),10*s)}}]),t}(h.default),(0,f.default)(o.prototype,"userCollectionsMap",[j.computed],Object.getOwnPropertyDescriptor(o.prototype,"userCollectionsMap"),o.prototype),(0,f.default)(o.prototype,"list",[j.computed],Object.getOwnPropertyDescriptor(o.prototype,"list"),o.prototype),o)},"./src/screens/discovery/guess/type.js":(e,s,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var r=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;r(t("./node_modules/react/index.js"));var n=t("./src/components/index.ts"),o=t("./src/stores/index.ts"),i=t("./src/utils/decorators/index.ts"),u=t("./node_modules/react/jsx-runtime.js"),d=["相似","不同"];s.default=(0,i.ob)((function(e){var s=e.like,t=e.onChange,r=void 0===t?Function.prototype:t;return(0,u.jsx)(n.SegmentedControl,{style:a.segment,size:11,values:d,selectedIndex:s?0:1,onValueChange:r})}));var a=o._.create({segment:{width:o._.r(80),height:o._.r(22),marginRight:o._.xs}})}}]);