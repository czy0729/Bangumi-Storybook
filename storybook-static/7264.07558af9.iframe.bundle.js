(self.webpackChunkweb=self.webpackChunkweb||[]).push([[7264],{"./src/screens/home/preview/component/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT=void 0;var s=t("./src/utils/dev/index.ts"),o=t("./src/screens/home/preview/ds.ts");r.COMPONENT=(0,s.rc)(o.COMPONENT,"Component")},"./src/screens/home/preview/component/list/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT=void 0;var s=t("./src/utils/dev/index.ts"),o=t("./src/screens/home/preview/component/ds.ts");r.COMPONENT=(0,s.rc)(o.COMPONENT,"List")},"./src/screens/home/preview/component/list/index.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.string.split.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.object.assign.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=s(t("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),n=(s(t("react")),s(t("./node_modules/react-native-web/dist/exports/View/index.js"))),u=t("./src/components/index.ts"),c=t("./src/stores/index.ts"),d=t("./src/utils/index.ts"),i=t("./src/utils/decorators/index.ts"),a=t("./src/screens/home/preview/component/list/ds.ts"),l=t("./src/screens/home/preview/component/list/styles.tsx"),m=t("./node_modules/react/jsx-runtime.js");r.default=(0,i.obc)((function(e,r){var t=r.$,s=(0,l.memoStyles)(),i=t.state,a=i.epsThumbs,p=i.epsThumbsHeader,f=t.params,h=f.data,j=void 0===h?[]:h,b=f.headers,v=void 0===b?{}:b,_=a.length?a:j,x=a.length?p:v,y={};return null!=x&&x.Referer&&x.Referer.includes("douban")?(j.length&&j[0].includes("douban")&&(_=(0,o.default)(j)),a.forEach((function(e){_.includes(e)||_.push(e)})),y.autoSize=s.item.width,y.fallback=!0):(y.width=s.item.width,y.height=.56*s.item.width,y.fallback=!0),(0,m.jsx)(u.ScrollView,{contentContainerStyle:c._.container.bottom,scrollToTop:!0,children:_.map((function(e,r){return(0,m.jsx)(n.default,{style:s.item,children:(0,m.jsx)(u.Touchable,{withoutFeedback:!0,onPress:function(){(0,d.showImageViewer)(_.map((function(e){return{url:e.split("@")[0],headers:v}})),r)},children:(0,m.jsx)(u.Image,Object.assign({src:e},y,{shadow:!0,headers:v,errorToHide:!0}))})},e)}))})}),a.COMPONENT)},"./src/screens/home/preview/component/list/styles.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.memoStyles=void 0;var s=t("./src/stores/index.ts");r.memoStyles=s._.memoStyles((function(){return{item:{width:s._.window.width-(2*s._.wind-s._._wind),marginLeft:s._.sm,marginBottom:s._.md}}}))},"./src/screens/home/preview/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.STATE=r.NAMESPACE=r.COMPONENT=void 0;var s=r.COMPONENT="Preview";r.NAMESPACE="Screen"+s,r.STATE={epsThumbs:[],epsThumbsHeader:{},_loaded:!1}},"./src/screens/home/preview/header/ds.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT=void 0;var s=t("./src/utils/dev/index.ts"),o=t("./src/screens/home/preview/ds.ts");r.COMPONENT=(0,s.rc)(o.COMPONENT,"Header")},"./src/screens/home/preview/header/index.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;s(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/index.ts"),u=t("./src/utils/decorators/index.ts"),c=t("./src/screens/home/preview/header/ds.ts"),d=t("./src/screens/home/preview/header/styles.ts"),i=t("./node_modules/react/jsx-runtime.js");r.default=(0,u.obc)((function(e,r){var t,s,u=r.$,c=(0,n.cnjp)(null==(t=u.params)?void 0:t.cn,null==(s=u.params)?void 0:s.jp);return(0,i.jsx)(o.Header,{headerTitleStyle:d.styles.title,title:c?c+"的预览":"预览",alias:"预览",hm:[u.url,"Preview"]})}),c.COMPONENT)},"./src/screens/home/preview/header/styles.ts":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(r,"__esModule",{value:!0}),r.styles=void 0;var s=t("./src/stores/index.ts");r.styles=s._.create({title:{paddingLeft:s._.sm,paddingRight:s._.md}})},"./src/screens/home/preview/index.tsx":(e,r,t)=>{t("./node_modules/core-js/modules/es.object.define-property.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;s(t("react"));var o=t("./src/components/index.ts"),n=t("./src/utils/decorators/index.ts"),u=t("./src/utils/hooks/index.ts"),c=s(t("./src/screens/home/preview/component/list/index.tsx")),d=s(t("./src/screens/home/preview/header/index.tsx")),i=s(t("./src/screens/home/preview/store.ts")),a=t("./node_modules/react/jsx-runtime.js");r.default=(0,n.ic)(i.default,(function(e,r){var t=r.$;return(0,u.useRunAfter)((function(){t.init()})),(0,u.useObserver)((function(){return(0,a.jsxs)(o.Component,{id:"screen-preview",children:[(0,a.jsx)(d.default,{}),(0,a.jsx)(o.Page,{loaded:t.state._loaded,children:(0,a.jsx)(c.default,{})})]})}))}))},"./src/screens/home/preview/store.ts":(e,r,t)=>{var s=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.reflect.construct.js"),t("./node_modules/core-js/modules/es.array.concat.js"),t("./node_modules/core-js/modules/es.object.assign.js"),t("./node_modules/core-js/modules/es.string.search.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.reverse.js"),t("./node_modules/core-js/modules/es.array.slice.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,u=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),c=o(t("./node_modules/@babel/runtime/helpers/classCallCheck.js")),d=o(t("./node_modules/@babel/runtime/helpers/createClass.js")),i=o(t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),a=o(t("./node_modules/@babel/runtime/helpers/inherits.js")),l=o(t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),m=o(t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=o(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),f=o(t("./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js")),h=t("./node_modules/mobx/dist/mobx.esm.js"),j=t("./src/utils/douban/index.ts"),b=o(t("./src/utils/store/index.ts")),v=t("./src/constants/index.ts"),_=t("./src/screens/home/preview/ds.ts");function x(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,s=(0,m.default)(e);if(r){var o=(0,m.default)(this).constructor;t=Reflect.construct(s,arguments,o)}else t=s.apply(this,arguments);return(0,l.default)(this,t)}}r.default=(n=function(e){(0,a.default)(t,e);var r=x(t);function t(){var e;(0,c.default)(this,t);for(var o=arguments.length,n=new Array(o),d=0;d<o;d++)n[d]=arguments[d];return e=r.call.apply(r,[this].concat(n)),(0,p.default)((0,i.default)(e),"params",void 0),(0,p.default)((0,i.default)(e),"state",(0,h.observable)(_.STATE)),(0,p.default)((0,i.default)(e),"init",(0,u.default)(s.mark((function r(){return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=e,r.t1=Object,r.t2={},r.next=5,e.getStorage(e.namespace);case 5:r.t3=r.sent,r.t4={_loaded:!0},r.t5=r.t1.assign.call(r.t1,r.t2,r.t3,r.t4),r.t0.setState.call(r.t0,r.t5),e.state.epsThumbs.length||e.fetchMovieFromDouban();case 10:case"end":return r.stop()}}),r)})))),(0,p.default)((0,i.default)(e),"fetchMovieFromDouban",(0,u.default)(s.mark((function r(){var t,o,n,u,c,d,i;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.params,o=t.cn,n=t.jp,!(u=o||n)){r.next=11;break}return r.next=5,(0,j.search)(u);case 5:return c=r.sent,d=(0,j.matchMovie)(u,c,n),r.next=9,(0,j.getPreview)(d,void 0,40);case 9:(i=r.sent).data.length&&(e.setState({epsThumbs:i.data.slice().reverse(),epsThumbsHeader:{Referer:i.referer}}),e.setStorage(e.namespace));case 11:case"end":return r.stop()}}),r)})))),e}return(0,d.default)(t,[{key:"subjectId",get:function(){return this.params.subjectId}},{key:"namespace",get:function(){return _.NAMESPACE+"|"+this.subjectId}},{key:"url",get:function(){return v.HOST+"/preview/"+this.subjectId}}]),t}(b.default),(0,f.default)(n.prototype,"subjectId",[h.computed],Object.getOwnPropertyDescriptor(n.prototype,"subjectId"),n.prototype),(0,f.default)(n.prototype,"namespace",[h.computed],Object.getOwnPropertyDescriptor(n.prototype,"namespace"),n.prototype),(0,f.default)(n.prototype,"url",[h.computed],Object.getOwnPropertyDescriptor(n.prototype,"url"),n.prototype),n)},"./src/utils/douban/index.ts":(e,r,t)=>{var s=t("./node_modules/@babel/runtime/regenerator/index.js");t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.string.search.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.array.sort.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.string.trim.js"),t("./node_modules/core-js/modules/es.string.match.js"),t("./node_modules/core-js/modules/es.array.for-each.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.function.name.js"),t("./node_modules/core-js/modules/es.array.includes.js"),t("./node_modules/core-js/modules/es.string.includes.js"),t("./node_modules/core-js/modules/es.string.replace.js"),t("./node_modules/core-js/modules/es.string.split.js"),t("./node_modules/core-js/modules/es.number.constructor.js");var o=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:!0}),r.getPreview=function(e,r){return b.apply(this,arguments)},r.getTrailer=function(e){return v.apply(this,arguments)},r.getVideo=function(e,r){return _.apply(this,arguments)},r.matchGame=function(e,r){var t=x(e),s=!1;return r.forEach((function(e){s||(0,u.similar)(e.title,t)<.7&&!e.title.includes(t)||(s=e.id)})),r.forEach((function(e){s||e.desc.includes(t)&&(s=e.id)})),s},r.matchMovie=function(e,r,t,s){var o=x(e),n=!1;return r.forEach((function(e){e.name&&e.name===t&&(n=e.id)})),r.forEach((function(r){if(!n){if((0,u.similar)(r.title,o)<.7){if(!r.desc.includes("原名:"))return;if(s&&r.year&&s!=r.year)return;var c=r.desc.split(" / ")[0].replace("原名:","");if((0,u.similar)(c,t||e)<.7)return}n=r.id}})),n},r.search=function(e,r){return j.apply(this,arguments)};var n=o(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),u=t("./src/utils/utils/index.ts"),c=t("./src/utils/fetch/index.ts"),d=t("./src/utils/html/index.ts"),i="https://www.douban.com",a="https://movie.douban.com",l=function(e,r){return i+"/search?cat="+("game"===r?3114:1002)+"&q="+e},m=function(e){return a+"/subject/"+e},p=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"o",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return"game"===r?"https://www.douban.com/game/"+e+"/photos/?type=1&start=0&sortby=hot":m(e)+"/photos?type=S&start="+s+"&sortby=time&size=a&subtype="+t},f=function(e){return i+"/"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"subject")+"/"+e+"/videos"},h=function(e){return a+"/subject/"+e+"/trailer"};function j(){return(j=(0,n.default)(s.mark((function e(r,t){var o,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.xhrCustom)({url:l(r,t)});case 2:return o=e.sent,n=o._response,i=(0,d.cheerio)(n),e.prev=5,e.abrupt("return",(i(".result .content").map((function(e,r){var t,s,o,n=(0,d.cheerio)(r),u=n.find("h3 a"),c=x(n.find(".subject-cast").text().trim())||"";return{id:null==(t=u.attr("onclick").match(/sid: (\d+)/))?void 0:t[1],title:x(u.text().trim()),name:(null==(s=c.match(/原名:(.*?)\//))?void 0:s[1])||"",desc:x(n.find("p").text().trim()),year:(null==(o=c.match(/(\d{4})$/))?void 0:o[1])||""}})).get()||[]).filter((function(e){return e.id})).sort((function(e,t){return(0,u.desc)((0,u.similar)(r,e.title),(0,u.similar)(r,t.title))})));case 9:return e.prev=9,e.t0=e.catch(5),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[5,9]])})))).apply(this,arguments)}function b(){return b=(0,n.default)(s.mark((function e(r,t){var o,n,u,i,a,l,f,h,j,b,v,_,x=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=x.length>2&&void 0!==x[2]?x[2]:12,r){e.next=3;break}return e.abrupt("return",{data:[],referer:""});case 3:return n="game"===t,e.next=6,(0,c.xhrCustom)({url:p(r,t,n?void 0:"o")});case 6:if(i=e.sent,u=i._response,!n){e.next=11;break}e.next=26;break;case 11:if(a=(0,d.cheerio)(u)(".cover img"),!((l=a.length)>0&&l<12||0===l)){e.next=17;break}return e.next=15,(0,c.xhrCustom)({url:p(r,t,"a")});case 15:f=e.sent,u=f._response;case 17:if(0===l){e.next=26;break}if(h=u.match(/<span class="count">\(共(\d+)张\)<\/span>/),j=h?Number(h[1]):0,!(b=j>=100?j-50:j>=30?j-30:0)){e.next=26;break}return e.next=24,(0,c.xhrCustom)({url:p(r,t,"a",b)});case 24:v=e.sent,u=v._response;case 26:return _=(0,d.cheerio)(u),e.abrupt("return",{data:(_(n?".pholist img":".cover img").map((function(e,r){var t=(0,d.cheerio)(r).attr("src").replace("http://","https://");return n&&(t=t.replace("/photo/thumb/","/photo/photo/")),t})).get()||[]).filter((function(e,r){return r<o})),referer:m(r)});case 28:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function v(){return v=(0,n.default)(s.mark((function e(r){var t,o,n,u,i,a=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>1&&void 0!==a[1]?a[1]:2,r){e.next=3;break}return e.abrupt("return",{data:[],referer:""});case 3:return o=h(r),e.next=6,(0,c.xhrCustom)({url:o});case 6:return n=e.sent,u=n._response,i=(0,d.cheerio)(u),e.abrupt("return",{data:(i(".pr-video").map((function(e,r){var t=(0,d.cheerio)(r);return{cover:t.find("img").attr("src").replace("http://","https://"),title:t.text().trim(),href:t.attr("href")||""}})).get()||[]).filter((function(e,r){return r<t})),referer:o});case 10:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function _(){return _=(0,n.default)(s.mark((function e(r,t){var o,n,a,l,m,p,h,j,b,v,_=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=_.length>2&&void 0!==_[2]?_[2]:3,r){e.next=3;break}return e.abrupt("return",{data:[],referer:""});case 3:return n=f(r,t),e.next=6,(0,c.xhrCustom)({url:n});case 6:a=e.sent,l=a._response,m=(0,d.cheerio)(l),p=(m(".video-list li").map((function(e,r){var t,s=(0,d.cheerio)(r),o=s.find("p a");return{cover:s.find("img").attr("src").replace("http://","https://"),title:(null==(t=o.text().trim().split("_哔哩哔哩"))?void 0:t[0])||"",href:o.attr("href")||"",src:""}})).get()||[]).filter((function(e,r){return r<3})),h=0;case 11:if(!(h<p.length)){e.next=23;break}return e.next=14,(0,c.xhrCustom)({url:""+i+p[h].href});case 14:return j=e.sent,b=j._response,e.next=18,(0,u.sleep)(800);case 18:(v=(0,d.cheerio)(b)(".video-player-fallback").attr("href")||"").includes("www.bilibili.com")&&(p[h].src=v);case 20:h+=1,e.next=11;break;case 23:return e.abrupt("return",{data:p.filter((function(e){return e.src})).filter((function(e,r){return r<o})),referer:n});case 24:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function x(e){return String(e).replace(/ |(&amp;)|-|：|《|》|（|）|“|”|，|。|之/g,"")}}}]);